var E_LAYERLABEL=Object({current:"_current",mouse:"_mouse",grid:"_gris",prefrag:"_prefrag"});function callback_stub(){}function helper_get_classname(h){return"undefined"===typeof h?"undefined":null===h?"null":Object.prototype.toString.call(h).match(/^\[object\s(.*)\]$/)[1]}function helper_bound_value(h,f,j){h<=f?h=f:h>=j&&(h=j);return Math.floor(h)}var near_zero_tolerance=0.01;function near_zero(h){return h<near_zero_tolerance&&h>-near_zero_tolerance?!0:!1}
function helper_format_number_length(h,f){for(var j=""+h;j.length<f;)j="0"+j;return j}function getObjectClass(h){if("object"!=typeof h||null===h)return!1;console.log(h.constructor.toString());return/^function (\w+)\(/.exec(h.constructor.toString())[1]}
function cEach(h,f){this.ret=!1;this.run=!0;if(void 0==h)return console.error("Cannot iterate over null thing"),!1;if(!f||"function"!=typeof f)return console.error("No callback assigned to cEeach"),!1;if(h instanceof Array)for(var j=0;j<h.length&&this.run;j++)f.call(this,j,h[j]);else if(h instanceof Object)for(elm in console.log("Each array"),h){if(!this.run)break;h.hasOwnProperty(elm)&&f.call(this,elm,h[elm])}else this.exception("invalid_thing");return this.ret}
cEach.prototype.stop=function(h){console.log("stop",h);this.run=!1;this.ret=h};function Cenum(h){for(o in h)this[o]=h[o]}Cenum.prototype.key_by_value=function(h){for(label in this)if(this.hasOwnProperty(label)&&this[label]==h)return label;console.error("No enum found with value",h);return""};
function deleteAllCookies(h){for(var h=h||window.document,f=h.cookie.split(";"),j=0;j<f.length;j++){var i=f[j];console.log("Delete cookie",i);var d=i.indexOf("="),i=-1<d?i.substr(0,d):i;h.cookie=i+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"}(h=window.opener)&&deleteAllCookies(h.document)};(function(h,f,j){var i=10<f.debug?!0:!1,h=function(){this.prefix="shojs-";this.postfix="graphit";this.id=null;this.className="lib/uid"};h.prototype.init=function(){};h.prototype.__get_frag=function(){var d=Math.round(Math.random()*Date.now()/655350),d=parseInt((d+"").slice(0,5));return helper_format_number_length(d,5)};h.prototype.gen=function(){for(var d=this.prefix,e=0;2>e;e++)d+=this.__get_frag()+"-";return this.last_id=d+=this.postfix};h.prototype.__test=function(){var d=new (f.import("lib/uid"));
i&&(j.log(d),j.log("Testing uid",d.gen()));return!0};f.export("lib/uid",h)})(window,graphit,console);(function(h,f,j){var i=10<=f.debug?!0:!1,h=function(d){d=d||{};this.EXCEPTION={_ALL:{method_object_missing:"This object doesn't have the required method (See additional)"},Csurface:{invalid_width:"The specified width is invalid 0 < width < 1920",invalid_height:"The specified height is invalid 0 < height < 1920"},Ccanvas:{invalid_width:"The specified width is invalid 0 < width < 1920",invalid_height:"The specified height is invalid 0 < height < 1920",invalid_copy_source:"You're trying to copy something that is not a Ccanvas or who is null"},
Cmenu:{invalid_menu_entry:"Your are trying to add non Cmenu_entry object",label_already_present:"Label already set in this menu"},Ctool:{no_size_parameter:"Each tool require a size Cparameter"}};this.type="shojs-exception";this.className=d.className||"lib/exception";this.label=d.label;this.additional=d.additional;this.object=d.object;this.original=d.original;this.message=null;this.className in this.EXCEPTION&&this.label in this.EXCEPTION[this.className]&&(this.message=this.EXCEPTION[this.className][this.label]);
!this.message&&this.label in this.EXCEPTION._ALL&&(this.message=this.EXCEPTION._ALL[this.label])};h.prototype.__test=function(){var d=new (f.import("lib/exception"))("TEST_EXCEPTION");try{throw d;}catch(e){i&&j.log(e.to_s())}return!0};h.prototype.to_s=function(d){var e="\n";void 0!=d&&"format"in d&&"html"==d.format&&(e="<br>"+e);var d="["+this.type+"]"+e+e,a;for(a in this)this.hasOwnProperty(a)&&(d="object"==typeof this[a]&&this[a]?d+(a+": "+this[a].toString()+e):d+(a+": "+this[a]+e));return d};f.export("lib/exception",
h)})(window,graphit,console);(function(h,f,j,i){var d=f.debug,e=f.import("lib/uid"),a=function(a,e){e=e?e:[];a=a?a:{};a.className=a.className||"lib/object";a.label=a.label||"object";this.uid=null;if(a!=i){if(!(a instanceof Object))throw j.error("[Module/Constructor] Options must be hash aka Object",this),"[Module/Constructor] Options must be hash aka Object";this.parent=null;this.parameters={};this._class_init(a,e);try{this.init(a,e)}catch(d){throw j.error("Cannot init object << ",this," >> Exception <<< ",d," >>>"),d;}}};a.prototype._class_init=
function(a,d){this.uid=(new e).gen();this.callback={};this._parse_options(a,d);return this};a.prototype.init=function(){return!1};a.prototype.exception=function(a,e,d){a=new (f.import("lib/exception"))({className:this.className,label:a,additional:e,object:this});j.error(a.to_s());j.log("Options",d);d&&("dialog"in d&&d.dialog)&&widget_exception(a);throw a;};a.prototype._parse_options=function(a,e){if(a==i)j.warn("No << {} >> argument passed to new Module");else{for(var e=e||[],d=["className","label"],
m=0;m<d.length;m++)!(d[m]in a)&&!a[d[m]]?this.exception("missing_mandatory_parameter",d[m]):e.push(d[m]);for(m=0;m<e.length;m++){var f=e[m];f in a?this[f]=a[f]:10<=h.graphit.debug&&j.warn("Needed property <<",f,">> ")}this._permitted_keys=e;if("parameters"in a)for(var n in a.parameters)this.add_parameter(a.parameters[n]);d=/^callback_(.*)$/;for(f in a)(m=d.exec(f))&&(m[1]in this.callback?j.error("Callback",m[1],"already installed skipping..."):this.callback[m[1]]=a[f]);return!0}};a.prototype.install_callback=
function(a){(!a||!("name"in a)||!("callback"in a)||"function"!=typeof a.callback)&&this.exception("install_callback_bad_arguments",a);a.name in this.callback&&this.exception("install_callback_already_registered",a);this.callback[a.name]=a.callback};a.prototype.guid=function(a){return(""+this.className+"-"+this.uid+(a?"-"+a:"")).toLowerCase()};a.prototype.get_trigger_name=function(a){return this.guid(a)};a.prototype.send_trigger=function(a,d){var e=this.get_trigger_name(a);4<h.graphit.debug&&j.log("[trigger/send]",
e,d);$(document).trigger(e,d)};a.prototype.get_dom_id=function(a){var a=a?"-"+a:"",d=this.className.split("/"),d=d.join("-");return this.uid+"-"+d+a};a.prototype.get_dom_class=function(){name=name?"-"+name:"";var a=this.className.split("/");return a=a.join("-")};a.prototype.set=function(){throw"object_set_method_is_not_implemented";};a.prototype.bind_trigger=function(a,d,e){if(!a)return j.warn("Cannot bind to null object"),!1;a=a.get_trigger_name(d);4<h.graphit.debug&&j.debug("[trigger/bind]",d,this.className,
" => ",a);$(document).bind(a,function(a,d){e.call(this,a,d)});return!0};a.prototype.add_parameter=function(a){var d=f.import("lib/parameter/select"),e=f.import("lib/parameter/numeric"),m=f.import("lib/parameter/enum/type");"parent"in a||(a.parent=this);"label"in a||this.exception("parameter_need_label",a);!("type"in a)||a.type==m.numeric?this.parameters[a.label]=new e(a):a.type==m.select?this.parameters[a.label]=new d(a):this.exception("unknow_parameter_type");return!0};a.prototype.get_parameter=
function(a){(!("parameters"in this)||!(a in this.parameters))&&this.exception("accessing_unknow_parameter",a);return this.parameters[a].get()};a.prototype.callback_exists=function(a){return a in this.callback&&"function"==typeof this.callback[a]?this.callback[a]:null};a.prototype.dom_get=function(a){var a=a||{},d=this.rootElm;if("force"in a||!d)d=this.dom_build().rootElm;return d};a.prototype.add_widget=function(a,d){(!a||!d)&&this.exception("no_name_or_root_elm",{name:a,rootElm:d});"widgets"in this||
(this.widgets={});a in this.widgets&&this.exception("dialog_already_exist",a);this.widgets[a]=d;return this};a.prototype.to_s=function(a){var a=a||"\n",d="["+this.className+"]"+a,d=d+(" - uid: "+this.uid+a);return d+=" - trigger name: "+this.get_trigger_name()+a};a.prototype.get_widget=function(a){(!a||!(a in this.widgets))&&this.exception("no_widget_with_this_name",{name:a});return this.widgets[a]};a.prototype.__test=function(){d&&j.warn("__test() from base object");new (f.import("lib/object"))({parent:this,
label:"Test",className:"Test"});return!0};f.export("lib/object",a)})(window,graphit,console);(function(h,f,j){var i=10<=f.debug?!0:!1,d=function(){this.className="lib/localStorage";this.init()};d.prototype.init=function(){this.test_compatibility()?(this.store=h.localStorage,this.test_insert()||(this.store={})):this.store={}};d.prototype.test_compatibility=function(){if("localStorage"in h&&null!=h.localStorage)return!0;j.error("Your web browser doesn't support web storage");return!1};d.prototype.test_insert=function(){try{this.set("_____TEST_INSERT_VALUE_____","_____TEST_INSERT_VALUE_____")}catch(d){return!1}this.remove("_____TEST_INSERT_VALUE_____");
return!0};d.prototype.list=function(){return this.store};d.prototype.remove=function(d){i&&j.log("Removing key",d);if("removeItem"in this.store)return this.store.removeItem(d);delete this.store[d]};d.prototype.get=function(d){i&&j.log("Get key",key);return this.store&&d in this.store?this.store[d]:null};d.prototype.set=function(d,a){i&&j.log("Setting",d,"with",a,"into",this.store);this.store||j.error("Storage not set");try{"removeItem"in this.store&&this.store.removeItem(d),this.store[d]=a}catch(k){var l=
new Cexception_message({label:"store_new_value_failed",className:this.className,object:this,additional:"key: "+d+" / value: "+a,original:k});j.error(l.to_s(),k)}};d.prototype.__test=function(){var d=new (f.import("lib/localStorage"));d.set("__TEST__","__TEST__");var a=d.get("__TEST__");if("__TEST__"!=a)throw d.className+"_cannot_fetch_key";for(var k in d.list())a=d.get(k),i&&j.log(k,a);d.remove("__TEST__");for(k in d.list())a=d.get(k),i&&j.log(k,a);return!0};f.export("lib/localStorage",d)})(window,
graphit,console);(function(h,f,j){var i=10<f.debug?!0:!1,d=f.import("lib/object"),e=f.import("lib/exception"),h=function(a){this.PO=this.PO={en:{menu_new_surface:"New",menu_theme:"Theme",menu_about:"About",menu_toolbox:"Toolbox",menu_file:"File",menu_help:"Help",menu_edition:"Edition",menu_login:"Login",menu_logout:"Logout",foreground_color:"Foreground color",background_color:"Background color",layers:"Layers",switch_color:"Switch color",tool_pencil:"Pen",tool_paintbrush:"Brush",tool_eraser:"Eraser","tool_bucket-fill":"Fill",
"tool_color-picker":"Color picker",right_click_to_save:"Right click -> Save as",save_image:"Save image",save:"Save",open:"Open",load:"Load",load_image:"Load image (URL)",TEST_test:"TEST_test: Testing PO translation",widget_toolbox:"Toolbox"},fr:{menu_new_surface:"Nouveau",menu_theme:"Theme",menu_about:"A propos",menu_file:"Fichier",menu_help:"Aide",menu_edition:"Edition",menu_toolbox:"Outils",foreground_color:"Couleur principal",background_color:"Couleur de fond",layers:"Calques",switch_color:"Echange de couleur",
tool_pencil:"Crayon",tool_paintbrush:"Pinceau",tool_eraser:"Gomme","tool_bucket-fill":"Remplir","tool_color-picker":"Selection de couleur",right_click_to_save:"Clique droit -> Enregistrer l'image sous",save:"Sauver",open:"Ouvrir",load:"Charger",load_image:"Charger image (URL)",TEST_test:"TEST_test: TEST des traductions PO "}};this.label=null;this.def="en";a=a||{};a.className="lib/po";a.label="po";a.def="en";a.lang=a.lang||a.def;d.call(this,a,["lang","def"])};h.prototype=Object.create(d.prototype);
h.prototype.constructor=new d;h.prototype.get=function(a){a||this.exception("undefined_parameter","label");var d=this.def,l=this.lang||d,f=null;if(l in this.PO&&a in this.PO[l])f=this.PO[l];else if(d in this.PO&&a in this.PO[d])f=this.PO[d];else throw new e({className:this.className,label:"no_trad_and_no_def",object:this,additional:a});f[a]||this.exception("translation_fail",{label:a,lang:l});return f[a]};h.prototype.to_s=function(a){var a=a||{},a=a.nl||"\n",d="["+this.className+"]"+a,d=d+(" - label: "+
this.label+a),e;for(e in this.PO){var d=d+("--- LANG "+e+a),f;for(f in this.PO[e])d+=" - "+f+" => "+this.PO[e][f]+a}return d};h.prototype.set_lang=function(a){this.lang=a};h.prototype.__test=function(){var a=new (f.import("lib/po"))({lang:"en"}),d;for(d in a.PO){i&&j.log("Lang <<<",d,">>>");for(var e in a.PO[d]){var p=a.get(e);i&&(j.log("Label to translate: "+e),j.log(" - Translate",p))}}i&&j.log("Setting lang to","fr");a.set_lang("fr");i&&j.log(a.to_s());return!0};f.export("lib/po",h)})(window,graphit,
console);(function(h,f){f.export("lib/parameter/enum/type",{numeric:1,select:2,checkbox:3})})(window,graphit,console);(function(h,f,j,i){var d=f.import("lib/object"),e=f.import("lib/localStorage"),a=f.import("lib/parameter/enum/type"),k=function(a){a=a||{};a.className=a.className||"lib/parameter";a.autoSave="autoSave"in a&&a.autoSave?!0:!1;a.label=a.label||"parameter";"parameters"in a&&this.exception("no_parameter_for_me");d.call(this,a,["type","def","label","autoSave","parent"]);this.autoSave&&(this.store=new e);this.__post_init(a);return this};k.prototype=Object.create(d.prototype);k.prototype.constructor=new d;
k.prototype.__post_init=function(a){if(this.autoSave){var d=this.make_registry_key();0<h.graphit.debug&&j.log("Loading parameter",d);d=this.store.get(d);this.value=d!=i?this._set(d):this._set(this.def)}else this.value=this._set(this.def);this.rootElm=null;var d=/^callback_(.*)$/,e;for(e in a)d.exec(e)&&(a[e]&&"function"==typeof a[e])&&(10<h.graphit.debug&&j.log("Installing callback for parameter["+this.type+"]",e),this[e]=a[e])};k.prototype.set=function(a){if(this.value==a)return!1;this.value=this._set(a);
this.autoSave&&(a=this.make_registry_key(),this.store.set(a,this.value));return!0};k.prototype._set=function(a){return a};k.prototype.reset=function(){this.set(this.def);return this.get()};k.prototype.get=function(){return this._get(this.value)};k.prototype._get=function(a){return a};k.prototype.make_registry_key=function(){var a=this.parent.className||this.className,d=this.parent.label;a||this.exception("no_classname_in_parent");d||this.exception("no_label_in_parent");return(a+"-"+d+"-"+this.label).toLowerCase()};
k.prototype.to_s=function(a){a=a||{};nl=a.nl||"\n";a="["+this.className+"]"+nl;return a+=" - label: "+this.label+nl};k.prototype.__test=function(){(new (f.import("lib/parameter"))({autoSave:!0,parent:{className:"classTest",label:"labelTest"},def:"Test",type:a.numeric})).set("__TEST__","__TEST__");return!0};f.export("lib/parameter",k)})(window,graphit,console,void 0);(function(h,f,j){var i=5<f.debug?!0:!1,d=f.import("lib/parameter"),e=f.import("lib/parameter/enum/type"),h=function(a){a=a||{};a.className="lib/parameter/select";a.parent=a.parent||{className:"fakeClassName",label:"fakeLabel"};a.autoSave="autoSave"in a&&!a.autoSave?!1:!0;d.call(this,a,"autoSave def label type choices parent".split(" "));this.type=e.select};h.prototype=Object.create(d.prototype);h.prototype.constructor=new d;h.prototype.init=function(a){this.choices={};this.def=a.def;this.label=a.label;
this.type=a.type;for(var d in a.choices)this.choices[d]=a.choices[d]};h.prototype.dom_build=function(){this.rootElm=this.rootElm;this.label=this.label;this.choices=this.choices;var a=this,d=$('<div title="'+this.className+'">');d.addClass("selected parameter");d.append("<h6>"+this.label+"</h6>");var e=$("<select />"),f;for(f in this.choices){i&&j.log("Option",this.choices[f]);var m=$("<option/>");m.attr("value",this.choices[f]);this.value==this.choices[f]&&m.attr("selected","selected");m.append(document.createTextNode(this.choices[f]));
e.append(m)}e.change(function(){a.set(this.value);a.rootElm.find("option").each(function(){$(this)});"callback_change"in a&&a.callback_change.call(a,this.value)});d.append(e);this.rootElm=d;return this};h.prototype.__test=function(){var a=new (f.import("app/core/ui")),d=(new (f.import("lib/parameter/select"))({parent:{className:"lib/parameter/select",label:"lib/parameter/select"},label:"Test parameter select",def:"test01",choices:["test01","test02","test03"]})).dom_get();a.widget_factory(d);return!0};
f.export("lib/parameter/select",h)})(window,graphit,console);(function(h,f,j){var i=f.import("lib/localStorage"),h=function(d){this.className="app/core/themeInjector";this.key="cjquery-theme-chooser-name";this.name=d||"south-street";this.ls=new i;this.init(this.name);this.inject_script(this.name)};h.prototype.__test=function(){new (f.import("app/core/themeInjector"))};h.prototype.init=function(d){var e=this.ls.get(this.key);e?this.name=e:(this.ls.set(this.key,d),this.name=d)};h.prototype.inject_script=function(d){var e=document.getElementById("ui-theme"),d=
f.baseStaticContent+"js/plugin/jquery-ui/1.9.2/themes/"+d+"/jquery-ui.css";e?e.setAttribute("href",d):(e=document.createElement("link"),e.setAttribute("rel","stylesheet"),e.setAttribute("id","ui-theme"),e.setAttribute("href",d),j.log("[Injecting/css]",d),document.getElementsByTagName("head")[0].appendChild(e))};f.export("app/core/themeInjector",h)})(window,graphit,console);(function(h,f,j,i){function d(){var a=f.import("lib/parameter/select");this.className=e;this.label="chooser";this.key="shojs-jquery-theme";this.pTheme=this.pTheme=new a({parent:this,label:"name",choices:{base:"base",black_tie:"black-tie",blitzer:"blitzer",cupertino:"cupertino",dark_hive:"dark-hive",dot_luv:"dot-luv",eggplant:"eggplant",excite_bike:"excite-bike",flick:"flick",hot_sneaks:"hot-sneaks",humanity:"humanity",le_frog:"le-frog",mint_choc:"mint-choc",overcast:"overcast",pepper_grinder:"pepper-grinder",
redmond:"redmond",smoothness:"smoothness",south_street:"south-street",start:"start",sunny:"sunny",swanky_purse:"swanky-purse",trontastic:"trontastic",ui_darkness:"ui-darkness",ui_lightness:"ui-lightness",vader:"vader"},def:"base",callback_change:function(a){a=h.graphit.baseStaticContent+"js/plugin/jquery-ui/1.9.2/themes/"+a+"/jquery-ui.css";j.log("src",a);$("#ui-theme").attr("href",a)}});this.rootElm=null;return this}var e="app/core/theme";d.prototype.dom_build=function(){var a=$('<div title="Theme chooser"/>');
a.append(this.pTheme.dom_get());this.rootElm=a;return this};d.prototype.dom_get=function(a){return this.rootElm&&a!=i&&!a?this.rootElm:this.dom_build().rootElm};d.prototype.__test=function(){(new (f.import(e))).dom_get().dialog()};f.export(e,d)})(window,graphit,console);(function(h,f,j){function i(d){d=d||{};d.className=e;d.label="checkbox";d.autoSave="autoSave"in d&&!d.autoSave?!1:!0;a.call(this,d);this.type=k.checkbox}var d=10<f.debug?!0:!1,e="lib/parameter/checkbox",a=f.import("lib/parameter"),k=f.import("lib/parameter/enum/type");i.prototype=Object.create(a.prototype);i.prototype.constructor=new a;i.prototype.init=function(){this.choices={}};i.prototype._get=function(a){return"true"==a?!0:"false"==a?!1:a?!0:!1};i.prototype._set=function(a){(a="false"==a||!a?
!1:!0)?this.rootElm&&this.rootElm.find("input").attr("checked","checked"):(this.value=!1,this.rootElm&&this.rootElm.find("input").removeAttr("checked"));return a};i.prototype.dom_build=function(){var a=this,d=$("<div />");d.addClass("selectex parameter");d.append("<h6>"+this.label+"</h6>");var e=$("<input />");e.attr("type","checkbox");e.attr("title",label);this.value&&(e[0].checked="checked");e.change(function(){a.set(this.checked);"callback_change"in a&&a.callback_change.call(a,e[0].checked)});
d.append(e);this.rootElm=d;return a};i.prototype.__test=function(){d&&j.log("Overide Cparameter test ...")};f.export(e,i)})(window,graphit,console);(function(h,f,j,i){var d=f.import("lib/parameter"),e=f.import("lib/parameter/enum/type"),h=function(a){a.type=e.numeric;a.className="lib/parameter/numeric";a.autoSave="autoSave"in a&&!a.autoSave?!1:!0;d.call(this,a);return this};h.prototype=Object.create(d.prototype);h.prototype.constructor=new d;h.prototype.init=function(a){this.checks=Object({label:1,min:1,max:1,def:1,step:1});for(var d in this.checks){if(!(d in a)||a[d]===i)return j.error("Missing parameter key/value",a,d),null;this[d]="label"==
d?a[d]:parseFloat(a[d])}};h.prototype._get=function(a){return parseFloat(a)};h.prototype._set=function(a){return parseFloat(a)};h.prototype.dom_build=function(){var a=this,d=$("<div />");d.addClass("sliderex parameter "+this.label);d.attr("title",this.label);var e=$("<table />"),f=$("<tr />"),m=$("<td />");m.append("<h6>"+this.label+"</h6>");f.append(m);var j=$("<div />");j.addClass("slider");j.slider({min:this.min,max:this.max,value:this.value,step:this.step,slide:function(){var d=$(this),e=d.slider("option",
"value");a.set(e);d.parents(".sliderex").find("input.input").attr("value",e);"callback_slide"in a&&a.callback_slide.call(a,e)},change:function(){var d=$(this),e=d.slider("option","value");a.set(e);d.parents(".sliderex").find("input.input").attr("value",e);"callback_change"in a&&a.callback_change.call(a,e)}});m=$("<td />");m.append(j);f.append(m);j=$("<input />");j.addClass("input");j.attr("value",this.value);j.css("width: 2em");j.change(function(){var d=$(this),e=d.attr("value");d.parents(".sliderex").find(".slider").slider("option",
"value",e);a.set(e);"callback_change"in a&&a.callback_change.call(a,e)});j.spinner();m=$("<td />");m.append(j);f.append(m);e.append(f);d.append(e);this.rootElm=d;return this};f.export("lib/parameter/numeric",h)})(window,graphit,console);(function(h,f){f.export("lib/enum/loading",{none:1,loading:2,fail:3,ok:4})})(window,graphit,console);(function(h,f){f.export("lib/enum/cardinal",{nw:7,n:0,ne:1,w:6,e:2,sw:5,s:4,se:3})})(window,graphit,console);(function(h,f,j,i,d){function e(d){d=d||{};d.className=a;d.label=d.label||"image";k.call(this,d,["parent","src","width","height","title"]);this.options=d;this.data=null;this.status=l.none;this.errorMsg="";this.last_update=null;this.src||i.warn(this.className+" constructed without src argument");this.dom_get()}var a="lib/image",k=f.import("lib/object"),l=f.import("lib/enum/loading");e.prototype=Object.create(k.prototype);e.prototype.constructor=new k;e.prototype.dom_build=function(){var a=this,e=j("<img />");
e.attr("data-po_label",this.label);e.addClass(this.get_dom_class());e.on("load",function(){return a.__callback_onload.call(a)});e.on("error",function(){return a.__callback_onerror.call(a)});e.on("click",function(d){d.stopPropagation();a.__callback_click.call(a);return!1});"label"in this&&this.label!=d&&(e.attr("alt",this.label),e.attr("title",this.label));"width"in this&&this.width!=d&&e.attr("width",this.width);"height"in this&&this.height!=d&&e.attr("height",this.height);"src"in this&&this.src&&
e.attr("src",this.src);this.rootElm=e;return this};e.prototype.__callback_onload=function(){i.log("Image loaded");this.status=l.ok;this.last_update=Date.now();if("replace_id"in this.options&&this.options.replace_id){var a=document.getElementById(this.options.replace_id);a?("label"in this.options&&a.setAttribute("alt"),a.width=this.data.width,a.height=this.data.height,a.src=this.data.src):(this.errorMsg="Replacing image failed",ret=!1)}return(a=this.callback_exists("success"))?a.call(this):!0};e.prototype.__callback_onerror=
function(){this.status=l.fail;this.last_update=null;var a=this.callback_exists("error");return a?a.call(this):!0};e.prototype.__callback_click=function(){i.log("Callback click",this.label);var a=this.callback_exists("click");return a?a.call(this):!0};e.prototype.__test=function(){i.log("Overide Cobject.__test");return!0};f.export(a,e)})(window,graphit,jQuery,console);(function(h,f,j){function i(a){a=a||{};a.className=d;a.size=a.size||22;a.type=a.type||"gimp";a.format=a.format||"png";a.label=a.label||"icon";a.path=a.path?"/"+a.path+"/":"/";a.name=a.name||"icon";a.src=this._build_src_path(a);e.call(this,a,["name","format","size","path"])}var d="lib/icon",e=f.import("lib/image");i.prototype=Object.create(e.prototype);i.prototype.constructor=new e;i.prototype._build_src_path=function(a){var d=h.graphit.baseStaticContent;a.name||this.exception("mandatory_parameter_missing",
"name",this);return d+"/images/"+a.type+a.path+a.name+"-"+a.size+"."+a.format};i.prototype.__test=function(){j.log("overide Cobject.__test");return!0};f.export(d,i)})(window,graphit,console);(function(h,f,j,i){function d(a){a=a||{};a.className="Module";a.label="color";"r"in a||(a.r=0);"g"in a||(a.g=0);"b"in a||(a.b=0);"a"in a||(a.a=0);e.call(this,a,["r","g","b","a","callback_change"])}var e=f.import("lib/object");d.prototype=Object.create(e.prototype);d.prototype.constructor=new e;d.prototype.to_rgba=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"};d.prototype.set_rgb=function(a){this.r=a.r;this.g=a.g;this.b=a.b;this.a=1;(callback=this.callback_exists("change"))&&
callback.call(this);return this};d.prototype.set=function(a,e){callback=this.callback_exists("change");if(a instanceof d)return this.r=a.r,this.g=a.g,this.b=a.b,this.a=a.a,callback&&callback.call(this),this;if(a&&e!=i){if(a in this)return this[a]=e,callback&&callback.call(this),this;this.exception("invalid_color_key",a)}this.exception("invalid_set_value",{key:a,value:e})};d.prototype.from_rgba=function(a){var d=RegExp(/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+(\.\d+)?)\s*\)$/).exec(a);if(!d)return j.error("Invalid rgba expression: "+
a),this;this.r=d[1];this.g=d[2];this.b=d[3];this.a=d[4];return this};d.prototype.inverse=function(){var a=1/255;this.r=Math.round(255*(1-this.r*a));this.g=Math.round(255*(1-this.g*a));this.b=Math.round(255*(1-this.b*a));return this};d.prototype.from_pixel=function(a,d){if(a==i||d==i)throw"invalid_argument";var e=d.y*4*a.width+4*d.x,f=a.data;this.r=f[e];this.g=f[e+1];this.b=f[e+2];this.a=f[e+3];this.a=Math.round(100*(this.a/255))/100;return this};d.prototype.clone=function(){return new d(this)};d.prototype.equal=
function(a,d){for(var e=d||["a","r","g","b"],f,m=0;m<e.length;m++)if(f=e[m],this[f]!=a[f])return!1;return!0};d.prototype.magnitude=function(){return Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b)};d.prototype.normalize=function(){var a=this.magnitude();this.r/=a;this.b/=b;this.g/=g;return this};d.prototype.to_s=function(){return this.className+"("+this.r+", "+this.g+", "+this.b+", "+this.a+")\n"};f.export("lib/color",d)})(window,graphit,console);(function(h,f,j,i){function d(a){a=a||{};a.className="Module";a.label="Module";e.call(this,a,["source_points","image_data"])}var e=f.import("lib/object"),a=f.import("lib/color");f.import("lib/enum/cardinal");d.prototype=Object.create(e.prototype);d.prototype.constructor=new e;d.prototype.get_cardinal_pixel=function(a,d,e){var f=d.x,d=d.y,j=a.width,h=j*a.height,q=[],a=function(a,d){var f=d*j+a;e[f]==i&&0<=f&&f<h&&q.push({x:a,y:d,index:f})};a(f,d-1);a(f+1,d-1);a(f+1,d);a(f+1,d+1);a(f,d+1);a(f-1,d+1);
a(f-1,d);a(f-1,d-1);return q};d.prototype.select_adjacent_pixel=function(a,d,e,f){a=this.get_cardinal_pixel(a,d,e);for(d=0;d<a.length;d++)f.call(this,a[d])};d.prototype.adjacent_by_color=function(d,e){for(var f=[],j=[],h=d.width*d.height,i=0;i<h;i++)f[i]=null;j.push({x:e.x,y:e.y,index:e.y*d.width+e.x});for(var q=0,h=0,r=(new a).from_pixel(d,e);0<j.length;)i=j.pop(),h++,this.select_adjacent_pixel(d,i,f,function(e){var h;h=(new a).from_pixel(d,e);h=r.equal(h,["r","g","b"])?!0:!1;h?(q++,f[e.index]=1,
j.push(e)):f[e.index]=0});return f};f.export("lib/image/analyse",d)})(window,graphit,console);(function(h,f){function j(e){e=e||{};e.className=i;e.label=e.label||"menu";e.type=e.type||"jquery";this.entries={};this.num_child=0;d.call(this,e,["type","parent","cssClass"])}var i="lib/menu",d=f.import("lib/object");j.prototype=Object.create(d.prototype);j.prototype.constructor=new d;j.prototype.init=function(d){for(var a in d.entries)d.entries[a].parent=this,d.entries[a].type=this.type,this.add(new j(d.entries[a]))};j.prototype.exists=function(d){return d.label in this.entries?!0:!1};j.prototype.add=
function(d){(!d||!(d instanceof j))&&this.exception("invalid_menu_entry",d);this.exists(d)&&this.exception("label_already_present",d.label);this.entries[d.label]=d;this.num_child++};j.prototype.dom_build=function(){var d;d=parent in this&&this.parent instanceof j?this.parent.rootElm:$("<ul />");for(var a in this.entries){var f=this.entries[a],h=$('<a href="#" title=""/>');h.attr("label",a);"click"in f.callback&&f.install_callback(h);var i=$("<li />"),m=$("<span>"+a+"</span>");m.addClass("menu-entry");
this.cssClass&&m.addClass(this.cssClass);h.append(m);i.append(h);f.has_child()&&(f=f.dom_get({noHeader:!0}),i.append(f));d.append(i)}if("jquery"==this.type&&(!this.parent||!(this.parent instanceof j)))d.menu({role:"listbox"}),d.menu("enable");if(!this.parent||!(this.parent instanceof j))a=$("<div />"),a.append(d),d=a;this.rootElm=d;return this};j.prototype.has_child=function(){return 0<this.num_child?!0:!1};j.prototype.install_callback=function(d){var a=this;d.click(function(){a.callback.click()})};
j.prototype.count_childs=function(){var d=0;for(c in this.entries)d++;return d};f.export(i,j)})(window,graphit,console);(function(h,f,j,i){function d(d){d=d||{};d.className=e;d.label="canvas";a.call(this,d,["width","height","bg_color","src"]);this.bg_color=this.bg_color||new k;(!this.width||0>this.width||1920<this.width)&&this.exception("invalid_width",this.width);(!this.height||0>this.height||1280<this.height)&&this.exception("invalid_height",this.height);this.data=document.createElement("canvas");this.data.setAttribute("width",this.width);this.data.setAttribute("height",this.height);this.ctx=this.data.getContext("2d");
this.clear(this.bg_color);this.src&&this.load(this.src)}var e="lib/canvas",a=f.import("lib/object"),k=f.import("lib/color");d.prototype=Object.create(a.prototype);d.prototype.constructor=new a;d.prototype.clone=function(){var a=new d({width:this.width,height:this.height,bg_color:this.bg_color});a.copy({src:this});return a};d.prototype.get_width=function(){return this.data.width};d.prototype.get_height=function(){return this.data.height};d.prototype.getImageData=function(a,d,e,f){return this.data.getContext("2d").getImageData(a,
d,e,f)};d.prototype.copy=function(a){!a.src&&(!(a.src instanceof d)||!(a.src instanceof Cimage))&&this.exception("invalid_copy_source");var e=null,f,k,h,q=null;f=this.get_width();k=this.get_height();a.src instanceof d?(e=a.src.data,h=a.src.get_width(),q=a.src.get_height()):(e=a.src,h=e.width,q=e.height,j.log("sw, dw",h,q));a.resize=a.resize!=i?a.resize:!1;var r=this.data.getContext("2d");r.save();"undefined"!=a.resize&&a.resize?r.drawImage(e,0,0,h,q,0,0,f,k):a.keepRatio?(e=this.data.width,k=a.src.get_width()/
a.src.get_height()/e,k*=this.data.height,r.drawImage(a.src.data,0,0,a.src.get_width(),a.src.get_height(),0,0,e,k)):(a=h>f?f:h,q=q>k?k:q,f=f>a?(f-a)/2:0,k=k>q?(k-q)/2:0,f=k=0,r.drawImage(e,0,0,a,q,f,k,a,q));r.restore()};d.prototype.get_pixel_color=function(a,d,e,f){return a.data[d*4*a.width+4*e+f]};d.prototype.getCanvas=function(){return this.data};d.prototype.getContext=function(a){a=a||"2d";if("data"in this)return this.data.getContext(a);j.error("Cannot return context for this object... no cCanvas");
return null};d.prototype.clear=function(a){var a=a||new k,d=this.getContext();0==a.a?d.clearRect(0,0,this.data.width,this.data.height):(d.save(),d.fillStyle=a.to_rgba(),d.fillRect(0,0,this.data.width,this.data.height),d.restore())};d.prototype.save=function(){var a=this.data.toDataURL("image/png");h.open(a)||(document.location.href=a)};d.prototype.load=function(a){var d=this;this.image_loading=new Cimage({src:a,callback_onload:function(){j.log("Image loaded",this);var a=cMath.clamp(1,this.rootElm.width,
d.data.width),e=cMath.clamp(1,this.rootElm.height,d.data.height);d.data.getContext("2d").drawImage(this.rootElm,0,0,a,e);d.image_loading=null},callback_onerror:function(){j.log("Failed to load image",this);d.image_loading=null}})};d.prototype.dom_build=function(){this.rootElm=this.data;return this};f.export(e,d)})(window,graphit,console);(function(h,f,j){function i(e){e=e||{};e.className="Module";e.label="Module";e.position=e.position||new Cpoint({x:0,y:0});e.width=e.width||0;e.height=e.height||0;d.call(this,e,["position","width","height"])}var d=f.import("lib/object");i.prototype=Object.create(d.prototype);i.prototype.constructor=new d;i.prototype.add_point=function(d){var a=d.x-this.position.x;a>this.width&&(this.width=a);d=d.y-this.position.y;d>this.height&&(this.height=d);j.log("Bounding",this)};f.export("lib/bounding/rectangle",
i)})(window,graphit,console);(function(h,f,j,i){h=function(d){if(d!=i&&(!("x"in d)||!("y"in d)))throw new Cexception_message({className:"lib/math/point2d",error:"invalid_component",additional:d});d=d||{x:0,y:0};Object.defineProperty(this,"x",{value:d.x,writable:!0,enumerable:!0,configurable:!1});Object.defineProperty(this,"y",{value:d.y,writable:!0,enumerable:!0,configurable:!1})};h.prototype.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y)};f.export("lib/math/point2d",h)})(window,graphit,console);(function(h,f){function j(e){this.className=i;d.call(this,e)}var i="lib/math/vector2d",d=f.import("lib/math/point2d");j.prototype=Object.create(d.prototype);j.prototype.constructor=new d;j.prototype.magnitude=function(){return 0==this.x&&0==this.y?0:Math.sqrt(this.x*this.x+this.y*this.y)};j.prototype.normalize=function(){var d=this.magnitude();if(0==d)return this;this.x/=d;this.y/=d;return this};j.prototype.from_point=function(d,a){this.x=a.x-d.x;this.y=a.y-d.y;return this};j.prototype.smul=function(d){this.x*=
d;this.y*=d;return this};j.prototype.vadd=function(d){this.x+=d.x;this.y+=d.y;return this};j.prototype.clone=function(){return new j(this)};f.export(i,j)})(window,graphit,console);(function(h,f,j,i){var d=function(d){this.className="lib/math/matrix33";m11=0;m12=1;m13=2;m21=3;m22=4;m23=5;m31=6;m32=7;m33=8;this.data=[];d=d!=i?d:[1,0,0,0,1,0,0,0,1];this.set(d)};d.prototype.init=function(){};d.prototype.clone=function(){return new d(this)};d.prototype._is_valid_array=function(d){return 9==d.length?!0:!1};d.prototype.translate=function(e){e=new d([1,0,0,0,1,0,e.x,e.y,1]);this.mul(e);return this};d.prototype.scale=function(e){e=new d([e.x,0,0,0,e.y,0,0,0,1]);this.mul(e);return this};
d.prototype.rotate=function(e){var a=Math.cos(e),e=Math.sin(e),a=new d([a,e,0,-e,a,0,0,0,1]);this.mul(a);return this};d.prototype.set=function(e){j.log(e);if(e==i)return this;if(e instanceof Array){if(!this._is_valid_array(e))throw"matrix33_invalid_array";for(var a=0;a<=m33;a++)this.data[a]=e[a]}else if(e instanceof d)for(a=0;a<=m33;a++)this.data[a]=e.data[a];else if("number"==typeof e){e=parseFloat(e);for(a=0;a<=m33;a++)this.data[a]=e}else throw"matrix33_invalid_value";return this};d.prototype.add=
function(e){if(!e)return this;if(e instanceof Array){if(!this._is_valid_array(e))throw"matrix33_invalid_array";for(var a=0;a<=m33;a++)this.data[a]+=e[a]}else if(e instanceof d)for(a=0;a<=m33;a++)this.data[a]+=e.data[a];else if("number"==typeof e){e=parseFloat(e);for(a=0;a<=m33;a++)this.data[a]+=e}else throw"matrix33_invalid_value";return this};d.prototype.round=function(){for(var d=0;d<=m33;d++)this.data[d]=Math.round(this.data[d]);return this};d.prototype.floor=function(){for(var d=0;d<=m33;d++)this.data[d]=
Math.floor(this.data[d]);return this};d.prototype.random=function(d){for(var d=d||1,a=0;a<=m33;a++)this.data[a]=Math.random(d);return this};d.prototype.identity=function(){this.data=[1,0,0,0,1,0,0,0,1];return this};d.prototype.mul=function(e){j.log(e);if(!e)return this;if(e instanceof d||e instanceof Array&&9==e.length){var a=this.data,f=[],h=null,h=e instanceof d?e.data:e;j.log(a,h);f[m11]=a[m11]*h[m11]+a[m12]*h[m21]+a[m13]*h[m31];f[m12]=a[m11]*h[m12]+a[m12]*h[m22]+a[m13]*h[m32];f[m13]=a[m11]*h[m13]+
a[m12]*h[m23]+a[m13]*h[m33];f[m21]=a[m21]*h[m11]+a[m22]*h[m21]+a[m23]*h[m31];f[m22]=a[m21]*h[m12]+a[m22]*h[m22]+a[m23]*h[m32];f[m23]=a[m21]*h[m13]+a[m22]*h[m23]+a[m23]*h[m33];f[m31]=a[m31]*h[m11]+a[m32]*h[m21]+a[m33]*h[m31];f[m32]=a[m31]*h[m12]+a[m32]*h[m22]+a[m33]*h[m32];f[m33]=a[m31]*h[m13]+a[m32]*h[m23]+a[m33]*h[m33];j.log("m",f);this.data=f}else if("number"==typeof e){j.log(typeof e);e=parseFloat(e);for(a=0;a<=m33;a++)this.data[a]*=e}else throw"matrix33_invalid_value";return this};d.prototype.minor=
function(){var d=[],a=this.data;d[m11]=a[m22]*a[m33]-a[m32]*a[m23];d[m12]=a[m21]*a[m33]-a[m31]*a[m23];d[m13]=a[m21]*a[m32]-a[m31]*a[m22];d[m21]=a[m12]*a[m33]-a[m32]*a[m13];d[m22]=a[m11]*a[m33]-a[m31]*a[m13];d[m23]=a[m11]*a[m32]-a[m31]*a[m12];d[m31]=a[m12]*a[m23]-a[m22]*a[m13];d[m32]=a[m11]*a[m23]-a[m21]*a[m13];d[m33]=a[m11]*a[m22]-a[m21]*a[m12];this.data=d;return this};d.prototype.to_s=function(d){var a="\n";d&&("format"in d&&"html"==d.format)&&(a="<br>\n");for(var d="Module"+a+" ",f=0;f<=m33;f++)d+=
this.data[f]+",",0==(f+1)%3&&(d+=a+" ");return d};f.export("lib/math/matrix33",d)})(window,graphit,console);(function(){var h=graphit.import("lib/math/vector2d"),f=graphit.import("lib/math/point2d");graphit.export("lib/math",{className:"lib/math",distance:function(f,h){var d=h.x-f.x,e=h.y-f.y;return Math.sqrt(d*d)+e*e},isint:function(f){return"number"===typeof f&&0==f%1},linear_interpolation:function(j,i,d){var d=1,e=[],a=new h;a.from_point(j,i);var k=a.magnitude();if(0==k)return e;a.normalize();var l=j.clone();a.smul(d);e.push(j);for(j=0;j<=k;j+=d)l.vadd(a),e.push(new f(l));e.push(i);return e},clamp:function(f,
h,d){return f<h?h:f>d?d:f}})})(window,graphit,console);(function(h,f){function j(f){f=f||{};f.className=i;f.label=i;d.call(this,f,[]);this.matrix=new e;this.matrix.identity();this.position=new a;this.u=new a;this.v=new a}var i="lib/transform/2d",d=f.import("lib/object"),e=f.import("lib/math/matrix33"),a=f.import("lib/math/vector2d");j.prototype=Object.create(d.prototype);j.prototype.constructor=new d;j.prototype.translate=function(a){(!("x"in a)||!1 in a)&&this.exception("camel_camouflage_failed");this.matrix.translate(a)};j.prototype.rotate=function(a){(!("x"in
a)||!1 in a)&&this.exception("camel_camouflage_failed");this.matrix.translate(a)};j.prototype.translate=function(a){a||this.exception("camel_camouflage_failed");this.matrix.translate(point)};f.export(i,j)})(window,graphit,console);(function(h,f,j,i){function d(a,d){this.min=a;this.max=d;this.last=null}function e(a){l.call(this,a);this.time=Date.now()}function a(a){a.className="Module";a.label="mousetracker";k.call(this,a,["parent","callback_move","callback_track"]);this.y=this.x=0;this.cMinmaxX=new d(0,this.parent.width);this.cMinmaxY=new d(0,this.parent.height);this.minmax=Object({minx:0,maxx:this.parent.width,miny:0,maxy:this.parent.height});this.minx=this.minmax.maxx;this.maxx=0;this.miny=this.minmax.maxy;this.maxy=0;this.pushed=
null;this.paused=!1;this.interval=null;this.points=[];this.rootElm=null;return this}var k=f.import("lib/object"),l=f.import("lib/math/vector2d"),p=f.import("lib/math");d.prototype.init=function(a){this.min=this.max=this.last=a};d.prototype.cmp=function(a){if(a==i)return j.warn("MinMax: Comparing with null value"),!1;a<this.min&&(this.min=a);a>max&&(this.max=a);this.last=a;return!0};e.prototype=Object.create(l.prototype);e.prototype.constructor=new l({x:0,y:0});a.prototype=Object.create(k.prototype);
a.prototype.constructor=new k;a.prototype.reset=function(){this.minx=this.minmax.maxx;this.maxx=0;this.miny=this.minmax.maxy;this.maxy=0;this.points=[]};a.prototype.move=function(a,d){a=p.clamp(Math.round(a),this.minmax.minx,this.minmax.maxx);d=p.clamp(Math.round(d),this.minmax.miny,this.minmax.maxy);this.x=a;this.y=d;var e=this.callback_exists("track");e&&e.call(this,a,d);return this};a.prototype.push=function(){this.pushed=Date.now();var a=this;this.interval=setInterval(function(){if(!a.is_pushed())return clearInterval(a.interval),
null;if(this.paused)return null;var d=new e(a);a.points.push(d);a.minx=Math.min(a.minx,d.x);a.maxx=Math.max(a.maxx,d.x);a.miny=Math.min(a.miny,d.y);a.maxy=Math.max(a.maxy,d.y)},1E3/120);this.func_push&&this.func_push(this)};a.prototype.dom_build=function(){var a=$("<div />");a.attr("title","Mouse tracker");a.addClass("mousetracker");var d=document.createElement("div"),d=$(d);d.addClass("ui-widget-content");d.append('<div class="hold-var"><h6>x:&nbsp;</h6><span class="var-x">'+this.x+"</span></div>");
d.append('<div class="hold-var"><h6>y:&nbsp;</h6><span class="var-y">'+this.y+"</span></div>");a.append(d);this.rootElm=a;return this};a.prototype.release=function(){this.pushed=null;this.func_release&&this.func_release(this);this.reset()};a.prototype.is_pushed=function(){return this.pushed};a.prototype.to_s=function(){return"Module: "+this.x+" / "+this.y};f.export("lib/mouse/tracker",a)})(window,graphit,console);(function(h,f){f.export("app/enum/compositeOperation",{"source-over":"source-over","source-in":"source-in","source-out":"source-out","source-atop":"source-atop",lighter:"lighter",xor:"xor","destination-over":"destination-over","destination-in":"destination-in","destination-out":"destination-out","destination-atop":"destination-atop",darker:"darker"})})(window,graphit,console);(function(h,f,j){var i=f.import("lib/object"),d=f.import("lib/icon"),e=f.import("lib/canvas");new (f.import("lib/po"));h=function(a){var d=this,a=a||{};a.className="app/tool";a.label=a.label||"tool";this.cCanvas=this.brush=null;this.need_update=!0;this.optElm=this.rootElm=null;this.changeCursor=!0;for(var e in a.parameters)a.parameters[e].parent=this;i.call(this,a,"parent brush label _pregraph _graph _postgraph _update compositeOperation".split(" "));for(e in this.parameters)this.bind_trigger(this.parameters[e],
"update",function(){d.update()});return this};h.prototype=Object.create(i.prototype);h.prototype.constructor=new i;h.prototype.canvas_create=function(a,d){if(!a||0>a||1920<a)return j.error("Width not in range",a),null;if(!d||0>d||1080<d)return j.error("Height not in range",d),null;this.set_parameter("width",a);this.set_parameter("height",d)};h.prototype.set_options=function(a){if(!a.brush)return j.error("No brush in Module options"),!1};h.prototype.update=function(){this.need_update=!0;if(!this.need_update)return j.log("Doesn't need update"),
!1;var a=this.get_parameter("size");a||this.exception("no_size_parameter",this.label);this.cCanvas=new e({width:a,height:a});this.ctx=this.cCanvas.getContext("2d");a=this.parent.brush_manager.selected.cCanvas.data;this.ctx.drawImage(a,0,0,a.width,a.height,0,0,this.cCanvas.get_width(),this.cCanvas.get_height());this.need_update=!1;this.send_trigger("update")};h.prototype.drawImage=function(a,d,e){var f=a.getContext("2d"),h=this.cCanvas.canvas;if(!f)return j.error("Cannot acquire context"),!1;if(d>
a.width||0>d)return j.error("x not in canvas destination range",d),!1;if(e>a.height||0>e)return j.error("y not in canvas destination range",e),!1;f.drawImage(h,0,0,h.width,h.height,d,e,h.width,h.height);return!0};h.prototype.onclick=function(){"callback_onclick"in this.options&&"function"===typeof this.options.callback_onclick&&this.options.callback_onclick(this)};h.prototype.dom_build=function(){this.rootElm=this.dom_build_tool();return this};h.prototype.dom_build_tool=function(){var a=this;return(new d({path:"tools",
name:"stock-tool-"+this.label,callback_click:function(){j.log("sending trigger");a.parent.send_trigger("tool_selected",a)},label:"tool_"+this.label})).dom_get().addClass("group "+this.get_dom_class())};h.prototype.dom_build_options=function(){if(this.optElm)return this.optElm;var a=$(document.createElement("div"));a.addClass("not-draggable");for(var d in this.parameters)a.append(this.parameters[d].dom_get());return this.optElm=a};h.prototype.callback_click=function(){this.parent&&this.parent.select_tool(this)};
h.prototype.graph=function(){this.exceptions("method_must_be_overidden")};h.prototype.pre_graph=function(){};h.prototype.post_graph=function(){};f.export("app/tool",h)})(window,graphit,console);(function(h,f){function j(a){a=a||{};a.className=i;a.label="pencil";a.parameters={size:{label:"size",min:1,max:100,def:20,step:1},opacity:{label:"opacity",min:0,max:1,def:1,step:0.01},linecap:{type:e.select,label:"linecap",choices:{round:"round",butt:"butt",square:"square"},def:"round"}};d.call(this,a,[])}var i="app/tool/pencil",d=f.import("app/tool"),e=f.import("lib/parameter/enum/type");j.prototype=Object.create(d.prototype);j.prototype.constructor=new d;j.prototype.graph=function(a){var d=a.cSurface.layer_manager.special_layers.prefrag.cCanvas.data.getContext("2d");
d.save();d.lineWidth=Math.round(this.parameters.size.value);var e=a.fgColor.color.clone();e.a=this.parameters.opacity.value;d.strokeStyle=e.to_rgba();d.lineCap=this.parameters.linecap.value;d.beginPath();d.moveTo(a.A.x,a.A.y);d.lineTo(a.B.x,a.B.y);d.stroke();d.closePath();d.restore();return!0};f.export(i,j)})(window,graphit,console);(function(h,f){function j(a){a=a||{};a.className=i;a.label="paintbrush";a.parameters={size:{label:"size",min:1,max:100,def:20,step:1},opacity:{label:"opacity",min:0,max:1,def:1,step:0.01},pression:{label:"pression",min:0.1,max:100,def:100,step:0.01}};d.call(this,a,[])}var i="app/tool/paintbrush",d=f.import("app/tool"),e=f.import("lib/math");j.prototype=Object.create(d.prototype);j.prototype.constructor=new d;j.prototype.graph=function(a){var d=a.cSurface.layer_manager.special_layers.prefrag.cCanvas.data.getContext("2d"),
f=this.cCanvas.data,h=f.width/2,j=f.height/2,i=this.get_parameter("pression"),a=e.linear_interpolation(a.A,a.B,100/i);if(0>=a.length)return!1;for(i=0;i<a.length;i++)d.save(),a[i].round(),d.translate(a[i].x-h,a[i].y-j),d.drawImage(f,0,0,f.width,f.height),d.restore();return!0};f.export(i,j)})(window,graphit,console);(function(h,f){function j(a){a=a||{};a.className=i;a.label="eraser";a.compositeOperation=e.xor;a.parameters={size:{label:"size",min:1,max:100,def:20,step:1},pression:{label:"pression",min:0.1,max:100,def:100,step:0.01}};d.call(this,a,[])}var i="app/tool/eraser",d=f.import("app/tool"),e=f.import("app/enum/compositeOperation"),a=f.import("lib/math");j.prototype=Object.create(d.prototype);j.prototype.constructor=new d;j.prototype.pre_graph=function(a){var d=a.cSurface.layer_manager.special_layers.prefrag.cCanvas.data.getContext("2d"),
a=a.cSurface.layer_manager,e;a.special_layers.stack_down&&(e=a.special_layers.stack_down.cCanvas.data,d.drawImage(e,0,0,e.width,e.height));e=a.selected.cCanvas.data;d.drawImage(e,0,0,e.width,e.height)};j.prototype.post_graph=function(a,d,e,f,h){var j=a.cSurface.layer_manager.selected,a=a.cSurface.layer_manager.special_layers.prefrag,i=a.clone(),r=i.cCanvas.getContext("2d");r.save();r.clearRect(0,0,i.cCanvas.data.width,i.cCanvas.data.height);r.globalCompositeOption="xor";r.drawImage(a.cCanvas.data,
0,0,a.cCanvas.data.width,a.cCanvas.data.height);j.drawImage(i.cCanvas.data,d,e,f,h,0,0,"source-in");r.restore()};j.prototype.graph=function(d){var f=d.cSurface.layer_manager.special_layers.prefrag.cCanvas.data.getContext("2d");d.cSurface.layer_manager.special_layers.prefrag.down_composite_operation=e["source-in"];f.globalCompositeOperation=e["destination-out"];for(var h=this.cCanvas.data,j=h.width/2,i=h.height/2,n=this.get_parameter("pression")||100,d=a.linear_interpolation(d.A,d.B,100/n),n=0;n<d.length;n++)f.save(),
f.translate(d[n].x-j,d[n].y-i),f.drawImage(h,0,0,h.width,h.height),f.restore();f.restore();return!0};f.export(i,j)})(window,graphit,console);(function(h,f,j){function i(a){a=a||{};a.className=d;a.label="bucket-fill";a.parameters={};e.call(this,a,[])}var d="app/tool/fill",e=f.import("app/tool"),a=f.import("lib/image/analyse");i.prototype=Object.create(e.prototype);i.prototype.constructor=new e;i.prototype.graph=function(d){var e=d.cSurface.layer_manager.special_layers.prefrag.cCanvas.data.getContext("2d"),f=d.cSurface.layer_manager.get();if(!f)return j.error("No layer selected"),!1;for(var f=f.getImageData(0,0,f.get_width(),f.get_height()),
h=(new a).adjacent_by_color(f,d.A),i=d.cToolbox.fg_color.color,n=0;n<h.length;n++)if(1==h[n]){var q=4*n;f.data[q]=i.r;f.data[q+1]=i.g;f.data[q+2]=i.b;f.data[q+3]=255}d.cMouse.minx=0;d.cMouse.miny=0;d.cMouse.maxx=f.width;d.cMouse.maxy=f.height;e.putImageData(f,0,0);d.cGrapher.stop();return!0};f.export(d,i)})(window,graphit,console);(function(h,f,j){function i(f){f=f||{};f.className=d;f.label="color-picker";f.compositeOperation=a.xor;f.parameters={};e.call(this,f,[])}var d="app/tool/colorPicker",e=f.import("app/tool"),a=f.import("app/enum/compositeOperation"),k=f.import("lib/color");i.prototype=Object.create(e.prototype);i.prototype.constructor=new e;i.prototype.graph=function(a){var d=a.cSurface.layer_manager.get();d||this.exception("no_layer_selected");d=d.getImageData(0,0,d.get_width(),d.get_height());d=(new k).from_pixel(d,
a.A);j.log("Selected color",d.to_s());a.cToolbox.fg_color.color.set(d);a.cGrapher.stop();return!0};f.export(d,i)})(window,graphit,console);(function(h,f,j){function i(d){d=d||{};d.className="graphit/message";d.label="message";a.call(this,d,"cSurface cMouse cTool cToolbox points fgColor bgColor cGrapher index".split(" "))}function d(d){d=d||{};d.className=e;d.label="grapher";a.call(this,d,["parent"])}var e="app/grapher",a=f.import("lib/object");i.prototype=Object.create(a.prototype);i.prototype.constructor=new a;f.export("graphit/message",i);d.prototype=Object.create(a.prototype);d.prototype.constructor=new a;d.prototype.init=function(){this.parent||
this.exception("no_parent_argument");this.reset_index();this.timer=null;this.mode=1};d.prototype.reset_index=function(){this.index=0};d.prototype._graph=function(a){var d=a.points.length;if(2>=d||this.index>=d-1)return!1;d=a.points[this.index+1];a.A=a.points[this.index];a.B=d;a.index=this.index;if(a.cTool.graph(a)&&(!this.last_redraw||Date.now()-this.last_redraw>1E3/60))this.last_redraw=Date.now(),a.cSurface.redraw(!0);this.index++};d.prototype.stop=function(){var a=f.import("app/layer");try{if(!this.timer)return j.warn("Grapher is not started"),
!1;clearInterval(this.timer);this.timer=null;var d=this.parent.selected,e=d.cMouse,h=d.layer_manager.selected,s=d.layer_manager.special_layers.prefrag,n=h.cCanvas.data,q=this.parent.cToolbox.selected,r=this.parent.cToolbox.selected.parameters.size.value,x=r/2,u=e.maxx-e.minx+r,v=e.maxy-e.miny+r,t=e.minx-x;0>t&&(t=0);t+u>n.width&&(u=n.width-t);var w=e.miny-x;0>w&&(w=0);w+v>n.height&&(v=n.height-w);var z=new i({cSurface:d,cMouse:d.cMouse});q.post_graph(z,t,w,u,v,0,0,u,v)||h.drawImage(s.cCanvas.data,
t,w,u,v,0,0);d.layer_manager.special_layers.prefrag=new a({parent:d.layer_manager,label:"_prefrag",width:d.get_width(),height:d.get_height()});this.index=0;return!0}catch(A){return j.error(A),!1}};d.prototype.start=function(){if(this.timer)return j.error("Grapher already started"),!1;var a=this;if(!this.parent.cToolbox||!this.parent.cToolbox.selected)return this.send_trigger("error","no-tool-selectionned"),j.error("No tool selectionned!"),!1;var d=this.parent,e=new i({cSurface:d.selected,cMouse:d.selected.cMouse,
cTool:d.cToolbox.selected,cToolbox:d.cToolbox,points:d.selected.cMouse.points,fgColor:d.cToolbox.fg_color,bgColor:d.cToolbox.bg_color,cGrapher:this,index:this.index});e.cTool.pre_graph(e);this.timer=h.setInterval(function(){a._graph(e)},5);return!0};d.prototype.__test=function(){j.log("Overide Cobject.__test");return!0};f.export(e,d)})(window,graphit,console);(function(h,f,j){function i(){this.className=d;this.logo=h.graphit.baseStaticContent+"images/badge-gplv3-32.png";this.text="license-gpl3.txt";this.rootElm=null;this.dialog_options={width:400}}var d="app/license";i.prototype.dom_build=function(){if(this.rootElm)return this;var d=$('<div title="License"/>');d.addClass("about ");var a=$("<div />");a.addClass("group-license");var f=$("<img />");f[0].src=this.logo;a.append(f);a.append('<p>Source code: <a href="#code" onclick="window.open(\'http://github.com/shojs/graphit/\'); return false;">github</a></p>');
a.append('<p>Documentation: <a href="#doc" onclick="window.open(\'http://github.com/shojs/graphit/wiki\');return false;">Wiki</a></p>');a.append('<p><img src="'+h.graphit.baseStaticContent+'images/gimp/stock-wilber-eek-64.png">&nbsp;All icons comes from the <a href="http://www.gimp.org">Gimp</a> project.</p>');a.append("<h6>License</h6>");f=$("<p />");f.addClass("text");f.append("                    GNU GENERAL PUBLIC LICENSE                       Version 3, 29 June 2007\n\n Copyright (C) 2007 Free Software Foundation, Inc. <http://fsf.org/> Everyone is permitted to copy and distribute verbatim copies of this license document, but changing it is not allowed.");
a.append(f);try{f.load(this.text)}catch(i){throw j.error("Cannot load full license",i),i;}f=document.createElement("button");$(f).append("Close");$(f).button();$(f).click(function(){d.dialog("close")});a.append(f);d.append(a);this.rootElm=d;return this};i.prototype.dom_get=function(){return this.dom_build().rootElm};f.export(d,i)})(window,graphit,console);(function(h,f,j){function i(f){f.className=d;f.label="frag";e.call(this,f,["parent","position","width","height","color"]);this.color||(this.color=new a);this.cCanvas=new k({width:this.width,height:this.height,bg_color:this.color});(!this.position||!(this.position instanceof l))&&this.exception("invalid_position")}var d="app/frag",e=f.import("lib/object"),a=f.import("lib/color"),k=f.import("lib/canvas"),l=f.import("lib/math/vector2d");i.prototype=Object.create(e.prototype);i.prototype.constructor=
new e;i.prototype.drawImage=function(a,d,e,f,h){var i=this.cCanvas.data,k=this.cCanvas.data.getContext("2d");try{k.drawImage(a,d,e,f,h,0,0,i.width,i.height)}catch(l){return j.error("Cannot draw to fragment",l),!1}return!0};f.export(d,i)})(window,graphit,console);(function(h,f,j,i){function d(d){d=d||{};d.className=e;d.label=d.label||"layer";d.position=d.position||new k({x:0,y:0});d.composite_operation=d.composite_operation||l["source-over"];d.visible=d.visible!=i?d.visible:!1;d.need_redraw=!0;a.call(this,d,"parent width height composite_operation need_redraw visible".split(" "))}var e="app/layer",a=f.import("lib/object"),k=f.import("lib/math/vector2d"),l=f.import("app/enum/compositeOperation"),p=f.import("lib/canvas"),m=f.import("lib/icon"),s=f.import("lib/image"),
n=f.import("app/frag");d.prototype=Object.create(a.prototype);d.prototype.constructor=new a;d.prototype.init=function(){var a=this;if(!this.width||0>this.width||1920<this.width)j.error("gabou",this),this.exception("invalid_width",this.width);(!this.height||0>this.height||1280<this.height)&&this.exception("invalid_height",this.height);this.frags=[];this.cCanvas=new p({width:this.width,height:this.height});this.bind_trigger(this,"redraw_preview",function(d){4<h.graphit.debug&&j.debug("[Trigger/received]",
d.type);a.redraw_preview()})};d.prototype.get_width=function(){return this.cCanvas.get_width()};d.prototype.get_height=function(){return this.cCanvas.get_height()};d.prototype.getImageData=function(a,d,e,f){return this.cCanvas.getImageData(a,d,e,f)};d.prototype.clone=function(){var a=this.cCanvas.data,e=new d({parent:this.parent,label:this.label,composite_operation:this.composite_operation,width:this.width,height:this.height});e.visible=this.visible;e.cCanvas.getContext().drawImage(a,0,0,a.width,
a.height);e.need_redraw=!1;e.rootElm=this.rootElm;return e};d.prototype.discard_frag=function(){this.need_redraw=!0;return this.frags.pop()};d.prototype.dom_get=function(){this.dom_build();return this.rootElm};d.prototype.set_visibility=function(a){this.visibility=a?!0:!1};d.prototype.toggle_visibility=function(){return!0==this.visibility?this.set_visibility(!1):this.set_visibility(!0)};d.prototype.dom_build=function(){if(this.rootElm)return this;var a=this,d=document.createElement("li"),e=$(d);e.attr("id",
this.uid);e.addClass("layer");d=$("<div/>");d.attr("id",this.uid);var f=$("<ul />");f.append('<li><a href="#'+this.guid(1)+'">layer</a></li>');f.append('<li><a href="#'+this.guid(2)+'">option</a></li>');f.append('<li><a href="#'+this.guid(3)+'">stats</a></li>');d.append(f);var f=$('<div id="'+this.guid(1)+'"/>'),i=new m({name:"stock-eye",size:20,callback_click:function(){a.toggle_visibility();a.send_trigger("update")}}),k=document.createElement("table"),k=$(k),p=$(document.createElement("tr")),l=
$(document.createElement("td"));l.append(i.dom_get());p.append(l);l=$(document.createElement("td"));i="<span>Layer - "+this.label+"</span>";l.css("width","100px");l.css("text-overflow","ellipsis");l.append(i);l.editInPlace({callback:function(d,e){return a.label=e}});l.addClass("label");p.append(l);l=$(document.createElement("td"));l.addClass("preview");this.canvas_preview=i=document.createElement("canvas");var n=100*(this.cCanvas.data.height/this.cCanvas.data.width);i.width=100;i.height=n;i=$(i);
l.click(function(){$(this).parents(".group-layers").find(".layer").removeClass("selected");$(this).parents(".layer").addClass("selected");a.parent.select(a)});l.append(i);p.append(l);l=$(document.createElement("td"));i=h.graphit.baseStaticContent+"/";n=new m({name:"stock-gravity-north",size:24,width:16,height:16,callback_click:function(){a.parent.move_up(a.uid)}});l.append(n.dom_get());n=new m({name:"stock-gravity-south",size:24,width:16,height:16,callback_click:function(){a.parent.move_down(a.uid)}});
l.append(n.dom_get());i=new s({src:i+"images/16x16_trash.png",width:16,height:16,callback_click:function(){$(this).parents("li.layer")?(e.remove(),a.parent.remove(a)):j.error("Cannot remove layer element")}});p.append(l);l=$(document.createElement("td"));l.addClass("options");l.append(i.dom_get());p.append(l);k.append(p);f.append(k);d.append(f);f=$('<div id="'+this.guid(2)+'"/>');f.append("<p>Layer option</p>");d.append(f);var y=$('<div id="'+this.guid(3)+'"/>');y.append('<p>Total fragment: <span id="'+
this.guid("total-fragment")+'">'+this.frags.length+"</span></p>");this.bind_trigger(this,"redraw_preview",function(){y.find("span").empty().append(a.frags.length)});d.append(y);e.append(d);d.tabs();this.rootElm=e;return this};d.prototype.redraw_preview=function(){var a=this.canvas_preview.getContext("2d"),d=this.cCanvas.data;a.clearRect(0,0,d.width,d.height);a.drawImage(d,0,0,d.width,d.height,0,0,this.canvas_preview.width,this.canvas_preview.height)};d.prototype.redraw=function(a){"boolean"===typeof a&&
(this.need_redraw=a);if(!this.need_redraw)return!1;a=this.cCanvas.getContext();a.clearRect(0,0,this.cCanvas.data.width,this.cCanvas.data.height);"compositeOperation"in this&&(a.compositeOperation=this.compositeOperation);for(var d=this.cCanvas.data.width,e=this.cCanvas.data.height,f=0;f<this.frags.length;f++){var h=this.frags[f],j=h.cCanvas.data,i=j.height,m=j.width,k=h.position.x;0>k?k=0:k+m>d&&(m=d-k);var p=h.position.y;0>p?p=0:p+i>e&&(i=e-p);a.save();a.beginPath();a.rect(k,p,m,i);a.clip();a.globalCompositeOperation=
h.downCompositeOperation?h.downCompositeOperation:"source-over";a.drawImage(j,0,0,m,i,k,p,m,i);a.restore()}this.send_trigger("redraw_preview");this.need_redraw=!1;return!0};d.prototype.clear=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.frags=[]};d.prototype.drawImage=function(a,d,e,f,h,j,i,m){j=new n({parent:this,position:new k({x:d,y:e}),width:f,height:h});j.drawImage(a,d,e,f,h,0,0);this.frags.push(j);m&&(j.downCompositeOperation=m)};d.prototype.copy=function(a){this.drawImage(a.src,
0,0,a.src.width,a.src.height,0,0)};d.prototype.to_json=function(){return{label:this.data,data:this.cCanvas.data.toDataURL()}};f.export(e,d)})(window,graphit,console);(function(h,f,j,i){function d(d){var f=this,d=d||{};d.className=e;d.label="layermanager";a.call(this,d,["parent"]);this.parent||this.exception("no_parent_parameter");this.layers=[];this.special_layers={};this.selected=null;this.dom_build();this.bind_trigger(this,"update",function(){f.redraw()});var d=this.parent.get_width(),h=this.parent.get_height();this.add(new l({parent:this,label:"_stack_up",width:d,height:h}));this.add(new l({parent:this,label:"_stack_down",width:d,height:h}));this.add(new l({parent:this,
label:"_grid",width:d,height:h}));this.add(new l({parent:this,label:"background",width:d,height:h}))}var e="app/layer/manager",a=f.import("lib/object"),k=f.import("lib/icon"),l=f.import("app/layer"),p=f.import("lib/math");d.prototype=Object.create(a.prototype);d.prototype.constructor=new a;d.prototype.build_layer_stack=function(a){this.special_layers.stack_down=this.layer_stack(0,a-1);this.special_layers.stack_up=this.layer_stack(a+1,this.layers.length-1)};d.prototype.add=function(a){a.parent=this;
var d=this;if(!(a instanceof l))return j.error("Layer manager need Clayer object"),null;var e=RegExp(/^_(.*)/).exec(a.label);e?(a.label="layer-"+e[1],this.special_layers[e[1]]=a):this.layers.push(a);if(!e&&this.rootElm){var e=this.rootElm.find(".group-layers"),f=$(a.dom_get(this.layers.length-1));e.prepend(f)}this.selected||(this.selected=a);this.bind_trigger(a,"update",function(){d.redraw()});this.send_trigger("update");return a};d.prototype.layer_stack=function(a,d){if(a>d)return null;for(var e=
this.parent.get_width(),f=this.parent.get_height(),e=new l({parent:this,label:"stack",width:e,height:f}),f=e.cCanvas.getContext(),h,j=a;j<=d;j++)h=this.layers[j].cCanvas.data,f.drawImage(h,0,0,h.width,h.height);return e};d.prototype.exists=function(a){for(var d=0,e=!1,d=0;d<this.layers.length;d++)if(this.layers[d]==a){e=!0;break}return e?d:null};d.prototype.remove=function(a){var d=this.selected,e=this.exists(a);d==a&&1<e&&(d=this.layers[e-1]);e===i&&j.error("Cannot remove undefined element");this.layers.splice(e,
1);this.select(d);this.parent.redraw(!0)};d.prototype.get=function(a){return!a||"__selected__"==a?this.selected:p.isint(a)?this.layers[a]:this.special_layers[a]};d.prototype.get_index_by_uid=function(a){for(var d=0;d<this.layers.length;d++)if(this.layers[d].uid==a)return d;return null};d.prototype.move_down=function(a){a=this.get_index_by_uid(a);if(a===i||1>=this.layers.length||1>a)return j.error("Can't move layer up"),!1;var d=this.layers[a-1];this.layers[a-1]=this.layers[a];this.layers[a]=d;this.select(this.selected);
this._build_layer_preview(".group-layers");this.send_trigger("update");return!0};d.prototype.move_up=function(a){if(1==this.layers.length)return!1;a=this.get_index_by_uid(a);if(a===i||a>=this.layers.length-1||1>=this.layers.length)return j.error("Can't move layer up"),!1;var d=this.layers[a+1];this.layers[a+1]=this.layers[a];this.layers[a]=d;this.select(this.selected);this._build_layer_preview(".group-layers");this.send_trigger("update");return!0};d.prototype.select=function(a){a=this.exists(a);if(a===
i||0>a||a>this.layers.length)return j.error("Layer index out of range: "+a),!1;this.build_layer_stack(a);this.selected=this.layers[a];this.send_trigger("update");return!0};d.prototype.dom_build=function(){var a=this,d=$("<div />");d.attr("title","Layer manager");var e=$("<div />");$("<div />");var f=new k({name:"stock-layer",size:24,width:16,height:16,title:"Create new layer",callback_click:function(){a.add(new l({parent:a,width:a.parent.get_width(),height:a.parent.get_height()}))}});d.append(f.dom_get());
f=$("<ul />");f.addClass("group-layers ui-widget-content");d.append(f);d.append(e);this.rootElm=d;return this};d.prototype._build_layer_preview=function(a){a=$(a);a.find(".layer").detach();for(var d=this.layers.length-1;0<=d;d--)this.layers[d].redraw(!0),a.append(this.layers[d].dom_get(1))};d.prototype.dom_exists=function(a){var d=!1,e;for(e=0;e<this.layers.length;e++)if(this.layers[e].rootElm=a){d=!0;break}return d?e:null};d.prototype.redraw=function(a){for(var d=0;d<this.layers.length;d++)this.layers[d].redraw(a)};
f.export(e,d)})(window,graphit,console);(function(h,f){function j(a){a.className=i;a.label="grid";d.call(this,a,["parent","callback_slide","callback_change","label"])}var i="app/grid",d=f.import("lib/object"),e=f.import("lib/color"),a=f.import("lib/parameter/numeric"),k=f.import("lib/parameter/checkbox"),l=f.import("lib/parameter/enum/type");j.prototype=Object.create(d.prototype);j.prototype.constructor=new d;j.prototype.init=function(){this.color=this.color||new e({a:1});this.isVisible=this.isVisible||!0;var d=this,f=function(){d.send_trigger("update")};
this.parameters={width:new a({parent:this,label:"width",min:1,max:100,def:100,step:1,callback_change:f,callback_slide:f}),height:new a({parent:this,label:"height",min:1,max:100,def:100,step:1,callback_change:f,callback_slide:f}),lineWidth:new a({parent:this,label:"lineWidth",min:1,max:10,def:1,step:1,callback_change:f,callback_slide:f}),visibility:new k({parent:this,type:l.checkbox,label:"visibility",def:!1,callback_change:f})};this.label="grid";this.rootElm=null};j.prototype.draw=function(a,d,e,
f,h){d=a.getContext("2d");d.save();d.beginPath();f=this.get_parameter("width");h=this.get_parameter("height");for(e=f+1;e<a.width;e+=f)d.moveTo(e,0),d.lineTo(e,a.height);for(f=h+1;f<a.height;f+=h)d.moveTo(0,f),d.lineTo(a.width,f);d.closePath();d.strokeStyle=this.color.to_rgba();d.lineWidth=this.get_parameter("lineWidth");d.stroke();d.restore()};j.prototype.dom_build=function(){var a=$("<div />");a.attr("title",this.label);a.addClass("grid");var d=$("<div />");d.addClass("ui-widget-content");for(label in this.parameters)a.append(this.parameters[label].dom_get());
a.append(d);this.rootElm=a;return this};f.export(i,j)})(window,graphit,console);(function(h,f,j,i){function d(d){var f=this,d=d||{};d.className=e;d.label="surface";d.parameters={zoom:{label:"zoom",min:-100,max:100,def:0,step:1,autoSave:!1,callback_slide:function(){j.log("sliding",this)}}};a.call(this,d,["width","height","label"]);d=this.width||0;d=k.clamp(1,d,1920);this.width!=d&&this.exception("invalid_width",this.width);d=this.height||0;d=k.clamp(1,this.height,1920);this.height!=d&&this.exception("invalid_height",this.height);this.need_redraw=!1;this.cCanvas=new l({width:this.width,
height:this.height});this.cCanvas.clear(new p);this.layer_manager=new m({parent:this});this.layer_manager.add(new s({parent:this.layer_manager,label:E_LAYERLABEL.mouse,width:this.width,height:this.height}));this.layer_manager.add(new s({parent:this.layer_manager,label:E_LAYERLABEL.prefrag,width:this.width,height:this.height}));this.layer_manager.add(new s({parent:this.layer_manager,width:this.width,height:this.height}));this.layer_manager.select(this.layer_manager.layers[0]);this.bind_trigger(this.layer_manager,
"update",function(a){4<h.graphit.debug&&j.log("[Trigger/received]",a.type);f.redraw(1)});this.cMouse=new n({parent:this,callback_move:function(){j.log("mouse move")},callback_track:function(a,d){$(f.cMouse.rootElm).find(".var-x").empty().append(a);$(f.cMouse.rootElm).find(".var-y").empty().append(d)}});this.cGrid=new q({parent:this,callback_slide:function(a){this.set(a);j.log("slide");this.send_trigger("update")},callback_change:function(a){this.set(a);j.log("Change");this.send_trigger("update")}});
this.bind_trigger(this.cGrid,"update",function(a){4<h.graphit.debug&&j.log("[Trigger/received]",a.type);f.update_grid()});this.bind_trigger(this,"update",function(){f.redraw(1)});this.bind_trigger(this,"show",function(a,d){d||widget_factory(f.dom_get(),{width:f.cCanvas.get_width()+100,zIndex:0,stack:!0}).show()});this.update_grid();return this}var e="app/surface",a=f.import("lib/object"),k=f.import("lib/math"),l=f.import("lib/canvas"),p=f.import("lib/color"),m=f.import("app/layer/manager"),s=f.import("app/layer"),
n=f.import("lib/mouse/tracker"),q=f.import("app/grid");d.prototype=Object.create(a.prototype);d.prototype.constructor=new a;d.prototype.set_current_layer=function(a){this.layer_manager.select(a)};d.prototype.update_grid=function(){var a=this.layer_manager.get("grid");a.cCanvas.getContext().clearRect(0,0,a.cCanvas.data.width,a.cCanvas.data.height);this.cGrid.get_parameter("visibility")&&this.cGrid.draw(a.cCanvas.data,0,0,this.cCanvas.data.width,this.cCanvas.data.height);this.need_redraw=!0;this.send_trigger("update")};
d.prototype.dom_build=function(){var a=this,d=$('<div title="(Ctrl-z) Undo"/>');d.addClass("surface");var e=$("<div/>"),f=$(this.cCanvas.data);f.width=this.width;f.height=this.height;f.addClass("canvas");f.attr("tabindex",0);f.mousedown(function(d){a.callback_mousedown(d,a)});f.mouseup(function(d){a.callback_mouseup(d,a)});f.mousemove(function(d){a.callback_mousemove(d,a)});f.mouseout(function(){a.cMouse.is_pushed()&&(a.cMouse.paused=!0)});f.mouseover(function(){a.cMouse.is_pushed()&&(a.cMouse.paused=
!1)});f.mouseenter(function(){a.send_trigger("surface_selected",a)});e.append(f);d.append(e);d.append(e);this.rootElm=d;return this};d.prototype.undo=function(){this.layer_manager.selected.discard_frag();this.layer_manager.selected.redraw();this.redraw(!0)};d.prototype.redraw=function(a){if(!this.need_redraw&&!a)return!1;if(!this.layer_manager.get())return j.warn("No layer selected"),!1;var d=this.cCanvas.data,e=d.getContext("2d");e.save();var f=this.get_parameter("zoom");0!=f&&(e.translate(d.width/
2,d.height/2),e.scale(f,f));e.clearRect(0,0,d.width,d.height);this.layer_manager.special_layers.stack_down!=i&&e.drawImage(this.layer_manager.special_layers.stack_down.cCanvas.data,0,0,d.width,d.height);this.layer_manager.selected.redraw(a);e.drawImage(this.layer_manager.selected.cCanvas.data,0,0,d.width,d.height);"down_composite_operation"in this.layer_manager.special_layers.prefrag&&(e.globalCompositeOperation=this.layer_manager.special_layers.prefrag.down_composite_operation);e.drawImage(this.layer_manager.special_layers.prefrag.cCanvas.data,
0,0,d.width,d.height);"down_composite_operation"in this.layer_manager.special_layers.prefrag&&(e.globalCompositeOperation="source-over");this.layer_manager.special_layers.stack_up!=i&&e.drawImage(this.layer_manager.special_layers.stack_up.cCanvas.data,0,0,d.width,d.height);"cGrid"in this&&this.cGrid.isVisible&&e.drawImage(this.layer_manager.special_layers.grid.cCanvas.data,0,0,d.width,d.height);e.restore();this.send_trigger("redraw_preview",this);this.need_redraw=!1;return!0};d.prototype.clear=function(){for(var a=
0;a<this.layer_manager.layers.length;a++)this.layer_manager.layers[a].clear();this.need_redraw=!0;this.send_trigger("update")};d.prototype.get_width=function(){return this.cCanvas.data.width};d.prototype.get_height=function(){return this.cCanvas.data.height};d.prototype.callback_mousedown=function(){if(this.cMouse.is_pushed())return j.warn("Mouse already pushed"),!1;this.cMouse.push();this.cGraphit.cGrapher.start();return!0};d.prototype.callback_mouseup=function(){if(!this.cMouse.is_pushed())return j.warn("Mouse not pushed"),
!1;this.cGraphit.cGrapher.stop();this.redraw(!0);this.cMouse.release();return!0};d.prototype.callback_mousemove=function(a,d){var e=$(d.cCanvas.data).offset();this.cMouse.move(a.pageX-e.left,a.pageY-e.top)};d.prototype.attach_graphit=function(a){var d=f.import("app/graphit");if(!a||!(a instanceof d))return j.error("Can't attach null or none Ctoolbox instance"),!1;this.cGraphit=a};d.prototype.save_as_json=function(){h.open(this.cCanvas.data.toDataURL());return data};f.export(e,d)})(window,graphit,
console);(function(h,f,j){function i(a){a=a||{};a.className=d;a.label="Workspace";e.call(this,a,[])}var d="app/surface/workspace",e=f.import("lib/object"),a=f.import("app/surface"),k=f.import("lib/icon"),l=new (f.import("lib/po"));i.prototype=Object.create(e.prototype);i.prototype.constructor=new e;i.prototype.init=function(d){var e=this;try{this.cSurface=new a(d)}catch(f){throw j.error("Cannot create surface"),f;}this.bind_trigger(this,"show",function(){e.show()})};i.prototype.dom_build=function(){this.cSurface||
this.exception("surface_is_null");var a=this,d=$('<div class="graphit-workspace"/>'),e=$('<div class="navbar"/>');e.append((new k({name:"stock-layers",size:24,width:32,height:32,label:l.get("layers"),callback_click:function(){a.cSurface.layer_manager.dom_get().dialog({autoOpen:!0});return!1}})).dom_get());e.append((new k({name:"stock-image",size:24,width:32,height:32,label:l.get("save"),callback_click:function(){a.__save_dialog();return!1}})).dom_get());"auth"in h.graphit&&!h.graphit.auth.is_disable()&&
e.append((new k({path:"preferences",name:"folders",width:32,height:32,label:l.get("open"),callback_click:function(){a.__load_dialog();return!1}})).dom_get());d.append(e);d.append(this.cSurface.dom_get());e=$("<div />");d.append(e);this.rootElm=d;return this};i.prototype.__save_dialog=function(){$("<div />").attr("title","save");var a=this.cSurface.cCanvas.clone(),d=h.open(null,"graphit-save","resizable=yes, scrollbars=yes, titlebar=yes, width=300, height=300 top=10, left=10",!1),e=$(d.document.head);
0==e.find("title").length&&e.append("<title>GraphIt - "+l.get("save_image")+"</title>");var f=$('<link id="id-graphit-css" type="text/css" rel="stylesheet" href="css/style.css"/>');0==e.find("#id-graphit-css").length&&e.append(f);d=$(d.document.body);d.empty();e=$('<div class="graphit-window group" />');e.append("<h3>"+l.get("right_click_to_save")+"<h3/>");f=new $("<img />");f.attr("src",a.data.toDataURL());f.attr("width",200);f.attr("title","graphit-image");f.attr("alt","graphit-image");f.css("background-image",
'url("img/grid-40x40.png")');e.append(f);d.append(e)};i.prototype.__load_dialog=function(){var a=this;try{return this.get_widget("load").dialog("open")}catch(d){j.warn("Can't get <<load>> widget")}var e=$("<div />"),i=$('<input type="url" width="200" value="http://1.bp.blogspot.com/_cmrGYcwOHPE/TLXcloz0rFI/AAAAAAAAAas/Tv98tJD7qO0/s1600/plop1.gif"/>'),k=$("<button>"+l.get("load")+"</button>");k.click(function(){$(this).parent().dialog("close");var d=$(this).parent().find("input");loc=h.location;var e=
loc.pathname.split("/"),e=e.slice(0,e.length-1).join("/"),e=loc.protocol+"//"+loc.hostname+"/"+e+"php/DataURL/";j.log("server",e);try{f.auth.get("verifiedEmail"),$.getImageData({url:d.attr("value"),server:e,callback:"?",success:function(d){var e=new Clayer({width:a.cSurface.cCanvas.data.width,height:a.cSurface.cCanvas.data.height,label:"Web Image"});e.copy({src:d});a.cSurface.layer_manager.add(e)},error:function(e,f){j.error("Cannot load image",d.attr("value"));a.exception("cannot_load_image",f,{dialog:!0})}})}catch(i){widget_exception(i)}});
e.append(i);e.append(k);e.attr("title",l.get("load_image"));this.add_widget("load",e);e.dialog()};i.prototype.show=function(){this.dom_get()};f.export(d,i)})(window,graphit,console);(function(h,f,j){h=function(){var f={js:1,gbr:2},d;for(d in f)this[d]=f[d]};h.prototype.key_by_value=function(f){for(var d in this["enum"])if(this["enum"][d]==f)return d;return null};j.log("app/brush/enum/type",h);f.export("app/brush/enum/type",new h)})(window,graphit,console);(function(h,f,j){var i=f.import("lib/canvas"),d=f.import("lib/color");f.export("app/brush/tools",{circle:{width:100,height:100,callback_update:function(){var e=f.import("app/toolbox"),a=this.parent.parent;if(!(a instanceof e))return j.error("Brush parent of parent must be a toolbox"),!1;e=a.fg_color.color.clone();a=a.selected;"opacity"in a.parameters&&(e.a=a.parameters.opacity.value);a=this.cCanvas.data.width/2;this.cCursor=new i({width:this.cCanvas.width,height:this.cCanvas.height});cDraw.circle({dcanvas:this.cCursor.data,
x:a,y:a,r:a,fillStyle:new d({r:255,a:1}),strokeStyle:new d({r:255,a:1}),lineWidth:1});cDraw.circle({dcanvas:this.cCanvas.data,x:a,y:a,r:a,fillStyle:e})}},scircle:{width:100,height:100,callback_update:function(){var e=this.parent.parent;if(!(e instanceof Ctoolbox))return j.error("Brush parent of parent must be a toolbox"),!1;var a=e.fg_color.color.clone();if((e=e.selected)&&"opacity"in e.parameters)a.a=e.parameters.opacity.value;e=this.cCanvas.data.width/2;this.cCursor=new i({width:this.cCanvas.width,
height:this.cCanvas.height});cDraw.circle({dcanvas:this.cCursor.data,x:e,y:e,r:e,fillStyle:new d({r:255,a:1}),strokeStyle:new d({r:255,a:1}),lineWidth:1});cDraw.circle({dcanvas:this.cCanvas.data,x:e,y:e,r:e,strokeStyle:a})}},rectangle:{width:100,height:100,callback_update:function(){var d=this.parent.parent;if(!(d instanceof Ctoolbox))return j.error("Brush parent of parent must be a toolbox"),!1;var a=d.fg_color.color.clone();if((d=d.selected)&&"opacity"in d.parameters)a.a=d.parameters.opacity.value;
d=this.cCanvas.data.width;this.cCursor=new i({width:this.cCanvas.width,height:this.cCanvas.height});var f=this.cCursor.getContext();f.save();f.clearRect(0,0,d,d);f.strokeStyle=a.to_rgba();f.strokeRect(0,0,d,d);f.restore();f=this.cCanvas.getContext();f.save();f.clearRect(0,0,d,d);f.fillStyle=a.to_rgba();f.fillRect(0,0,d,d);f.restore()}}})})(window,graphit,console);(function(h,f,j){function i(a){a.className=d;a.label="brush";e.call(this,a,["parent","name","type"])}var d="app/brush",e=f.import("lib/object"),a=f.import("app/brush/enum/type"),k=f.import("lib/canvas"),l=f.import("lib/color");i.prototype=Object.create(e.prototype);i.prototype.constructor=new e;i.prototype.init=function(d){if(!this.type||!this.name)return j.error("Module need <<type>> and <<name>> parameter"),!1;if(this.type==a.js)this._load_js(d);else if(this.type==a.gbr)j.log("Parsing Gimp Brush"),
this._load_gbr(d);else return thix.exception("unknown_brush_type",this.type),!1;return this.init_canvas(d)};i.prototype.init_canvas=function(a){a=new k({width:a.data.width,height:a.data.height});a.clear(new l);this.cCanvas=a};i.prototype.update=function(){this.callback.update.call(this,this.parent)};i.prototype._load_js=function(a){if(!("callback_update"in a.data))return j.error("Javascript brush must contain a callback_update function"),!1;this.callback.update=a.data.callback_update;return!("width"in
a.data)||!("height"in a.data)?(j.error("Javascript brush need width and height property"),!1):!0};i.prototype._load_gbr=function(){};i.prototype.dom_build=function(){var d=this,e=$("<div />"),f=$("<div />");f.addClass("group-brush group");f.append("<label>"+a.key_by_value(this.type)+" / "+this.name+"</label>");j.log("Ccanvas",this.cCanvas);f.append(this.cCanvas.dom_get());e.append(f);e.click(function(){d.send_trigger("brush_selected",d);$(this).parents(".group-brushmanager").find(".group-brush").removeClass("selected");
$(this).children(".group-brush").addClass("selected")});this.rootElm=e;return this};f.export(d,i)})(window,graphit,console);(function(h,f,j){function i(a){a=a||{};a.className=d;a.label="brushmanager";this.brushes=[];this.selected=null;e.call(this,a,["parent"])}var d="app/brush/manager",e=f.import("lib/object"),a=f.import("app/brush"),k=f.import("app/brush/enum/type"),l=f.import("app/brush/tools");i.prototype=Object.create(e.prototype);i.prototype.constructor=new e;i.prototype.init=function(){this.add(new a({parent:this,type:k.js,name:"circle",data:l.circle}));this.add(new a({parent:this,type:k.js,name:"rectangle",data:l.rectangle}));
this.add(new a({parent:this,type:k.js,name:"scircle",data:l.scircle}))};i.prototype.dom_build=function(){var a=this,d=$("<div />");d.attr("id",this.guid());d.attr("title",this.label);var e=$("<div />");cEach(this.brushes,function(d,f){var h=f.dom_get();a.selected==f&&h.find(".group-brush").addClass("selected");e.append(h)});d.append(e);this.rootElm=d;return this};i.prototype.add=function(d){var e=this;if(this.exists(d))return j.error("This brush is already present"),!1;this.selected||(this.selected=
d);this.bind_trigger(d,"brush_selected",function(d,f){if(!(f instanceof a))return j.error("Trigger brush_selected must reture a brush",d,f),!1;e.selected=f;e.selected.update();e.send_trigger("update")});this.brushes.push(d);this.send_trigger("update");return!0};i.prototype.exists=function(a){cEach(this.brushes,function(d){if(d.type==a.type&&d.name==a.name)return!0});return!1};f.export(d,i)})(window,graphit,console);(function(h,f,j){function i(a){var f=this;a.className=d;a.label="toolboxpreview";e.call(this,a,["parent"]);this.bind_trigger(this,"update",function(a){4<h.graphit.debug&&j.log("[Trigger/received]",a.type);a=f.parent.fg_color.color.clone().inverse();a.a=1;f.cCanvas.clear(a);a=f.cCanvas.getContext();f.cCanvas.clear();var d=f.parent.brush_manager.selected.cCanvas.data,e=f.parent.selected.get_parameter("size"),i=e>f.cCanvas.get_width()?f.cCanvas.get_width():e,k=e>f.cCanvas.get_height()?f.cCanvas.get_height():
e,e=(f.cCanvas.get_width()-e)/2;a.drawImage(d,0,0,d.width,d.height,e,e,i,k)})}var d="app/toolbox/preview",e=f.import("lib/object"),a=f.import("lib/canvas");i.prototype=Object.create(e.prototype);i.prototype.constructor=new e;i.prototype.init=function(){this.cCanvas=new a({parent:this,width:100,height:100})};i.prototype.dom_build=function(){var a=$("<div />");a.addClass("toolbox-preview");var d=$("<div />");d.append(this.cCanvas.dom_get());a.append(d);this.rootElm=a;return this};f.export(d,i)})(window,
graphit,console);(function(h,f,j){function i(f,h){var i=this;h.className=d;h.label=h.label||"toolbox_colorpicker";e.call(this,h,["parent","label","callback_onchange"]);if(f&&!(f instanceof a))return j.error("color parameter is not an instance of Ccolor"),null;this.color=f?f:new a;this.color.install_callback({name:"change",callback:function(){i.update()}});this.rootElm=null;this.cCanvas=new k({width:32,height:32});this.ctx=this.cCanvas.getContext();this.clear(this.color)}var d="app/toolbox/colorPicker",e=f.import("lib/object"),
a=f.import("lib/color"),k=f.import("lib/canvas");i.prototype=Object.create(e.prototype);i.prototype.constructor=new e;i.prototype.clear=function(a){this.cCanvas.clear(a)};i.prototype.to_rgba=function(){return this.color.to_rgba()};i.prototype.update=function(){this.clear(this.color);this.elmImage.getContext("2d").drawImage(this.cCanvas.data,0,0,this.cCanvas.get_width(),this.cCanvas.get_height());this.send_trigger("color_selected")};i.prototype.dom_build=function(){var a=this;if(this.rootElm)return this;
var d=document.createElement("div"),d=$(d),e=document.createElement("canvas");e.setAttribute("width",32);e.setAttribute("height",32);e.setAttribute("alt",this.label);e.setAttribute("title",this.label);this.elmImage=e;d.append(e);var f=e.getContext("2d"),h=this.cCanvas.data;f.drawImage(h,0,0,h.width,h.height);$(e).ColorPicker({onChange:function(d,e,f){a.color.set_rgb(f)},onSubmit:function(d,e,f){a.color.set_rgb(f)},zIndex:10});this.rootElm=d;return this};f.export(d,i)})(window,graphit,console);(function(h,f,j,i){function d(d){var f=this;d.className=e;d.label="toolbox";a.call(this,d,["parent"]);this.elmOptions=this.elmPreview=null;this.dialog_options={modal:!1,width:250,position:"right top",stack:!0};this.bind_trigger(this.fg_color,"color_selected",function(a){4<h.graphit.debug&&j.log("[Trigger/received]",a.type);f.update()});this.bind_trigger(this.bg_color,"color_selected",function(a){4<h.graphit.debug&&j.log("[Trigger/received]",a.type);f.update()});this.bind_trigger(this,"switch_color",
function(){f.switch_color()})}var e="app/toolbox",a=f.import("lib/object"),k=f.import("app/toolbox/preview"),l=f.import("app/toolbox/colorPicker"),p=f.import("app/tool"),m=f.import("app/tool/pencil"),s=f.import("app/tool/paintbrush"),n=f.import("app/tool/fill"),q=f.import("app/tool/eraser"),r=f.import("app/tool/colorPicker"),x=f.import("lib/color"),u=f.import("app/brush/manager"),v=f.import("lib/icon"),t=new (f.import("lib/po"));d.prototype=Object.create(a.prototype);d.prototype.constructor=new a;
d.prototype.init=function(){var a=this;this.selected=null;this.tools=[];this.preview=new k({parent:this});this.fg_color=new l(new x({r:255,g:255,b:255,a:1}),{parent:this,callback_onchange:function(){this.send_trigger("update",a)},label:t.get("foreground_color")});this.bind_trigger(this.fg_color,"update",function(){a.update()});this.bg_color=new l(new x({r:0,g:0,b:0,a:1}),{parent:this,callback_onchange:function(){this.send_trigger("update",a)},label:t.get("background_color")});this.bind_trigger(this.bg_color,
"update",function(){a.update()});this.brush_manager=new u({parent:this});this.bind_trigger(this.brush_manager,"update",function(){a.update()});this.load(this.olist);this.dom_build()};d.prototype.select_tool_by_name=function(a){var d=this;return cEach(this.tools,function(e,f){f.label==a&&(d.select_tool(f),this.stop(),this.ret=!0);return!1})};d.prototype.load=function(){var a=this,d=function(d){a.bind_trigger(d,"update",function(){a.preview.send_trigger("update")});a.tools.push(d)},e=new m({parent:this});
d.call(this,e);this.selected=e;e=new s({parent:this});d.call(this,e);e=new q({parent:this});d.call(this,e);e=new n({parent:this});d.call(this,e);e=new r({parent:this});d.call(this,e)};d.prototype.update=function(){this.brush_manager.selected.callback.update.call(this.brush_manager.selected);this.selected.update();this.preview.send_trigger("update")};d.prototype.select_tool=function(a){if(a==i)return j.warn("Can't select undefined tool"),!1;var d=$(a.rootElm);d.parents(".group-tools").find(".tool").removeClass("selected");
d.children(".tool").addClass("selected");d=d.parents(".toolbox").find(".group-options");d.children("div").detach();d.append(a.dom_build_options());this.selected=a;this.update();return!0};d.prototype.switch_color=function(){var a=this.fg_color;this.fg_color=this.bg_color;this.bg_color=a;a=this.rootElm.find(".colorpicker-colors");a.children(".colorpicker").detach();this.dom_build_colorpickers(a);this.send_trigger("update_foreground_color")};d.prototype.dom_build_colorpickers=function(a){a.append(this.fg_color.dom_get());
a.append(this.bg_color.dom_get())};d.prototype.dom_build=function(){var a=this,d=$('<div title="Toolbox"/>');d.addClass("toolbox");var e=$("<div />");e.addClass("group group-tools ui-widget-content");for(var f=0;f<this.tools.length;f++){var h=this.tools[f];h.bind_trigger(h,"tool_selected",function(d,e){if(!(e instanceof p))return j.error("Trigger tool_selected must pass a Ctool argument"),!1;a.select_tool(e);return!0});var i=h.dom_get();this.selected==h&&h.rootElm.children(".tool").addClass("selected");
e.append(i)}d.append(e);e=$("<div/>");e.addClass("ui-widget-content group-colorpicker");f=$("<div/>");f.addClass("ui-widget-content colorpicker-colors");this.dom_build_colorpickers(f);e.append(f);e.append($((new v({name:"stock-default-colors",size:12,callback_click:function(){a.send_trigger("switch_color");a.update()},label:t.get("switch_color")})).dom_get().addClass("switch")));d.append(e);e=$("<div/>");e.addClass("group-preview ui-widget-content");e.append(this.preview.dom_get());d.append(e);e=
$("<div />");e.addClass("group-options ui-widget-content");d.append(e);e=$("<div />");e.addClass("group-brushmanager ui-widget-content");e.append(this.brush_manager.dom_get());d.append(e);this.rootElm=d;return this};f.export(e,d)})(window,graphit,console);(function(h,f,j){function i(a){a=a||{};a.className=d;a.label="binaryfile";this.headers=[];this.FH={};e.call(this,a,["src","callback_success","callback_error","responseType"]);this.responseType=this.responseType||"arraybuffer";this.response=null;this.loaded=!1;this.error="";this.src&&this.load(this.src)}var d="lib/binaryFile",e=f.import("lib/object");i.prototype=Object.create(e.prototype);i.prototype.constructor=new e;i.prototype.set_src=function(){};i.prototype.load=function(a){if(!a)return j.error("Trying to load undefined src"),
null;4<h.graphit.debug&&j.log("Loading file: "+a);this.src=a;var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="arraybuffer";var e=this;d.onload=function(){e.response=this;"success"in e.callback&&e.callback.success.call(e,this)};d.onerror=function(){j.error(this.className+" failed to load file",this.src);"error"in e.callback&&e.callback.error(e,this)};d.send()};i.prototype.header=function(a){return!(a in this.FH)?(j.error("No property <<",a,">> in header"),""):this.headers[this.FH[a]].value};
f.export(d,i)})(window,graphit,console);(function(h,f,j){function i(a){this.className=d;this.label="GBR file";e.call(this,a);"success"in this.callback&&(this.callback._success=this.callback.success);"error"in this.callback&&(this.callback._error=this.callback.error);this.callback.success=this._success;this.callback.error=this._error}var d="lib/binaryFile/GBR",e=f.import("lib/binaryFile");i.prototype=Object.create(e.prototype);i.prototype.constructor=new e;i.prototype.init=function(){this.loaded=!1;this.magic_number=1195986256;this.cCanvas=
null;this.headers=[{type:"uint32",label:"header_size"},{type:"uint32",label:"version"},{type:"uint32",label:"width"},{type:"uint32",label:"height"},{type:"uint32",label:"bytes"},{type:"uint32",label:"magic_number"},{type:"uint32",label:"spacing"}];this.FH={header_size:0,version:1,width:2,height:3,bytes:4,magic_number:5,spacing:6}};i.prototype._success=function(a){this.loaded=!1;if(this.parse_response(a))return this.loaded=!0,"_success"in this.callback&&this.callback._success.call(this,a),!0;this.init();
return!1};i.prototype.parse_response=function(a){var d=this.FH;10<h.graphit.debug&&j.log("[File/GBR] Parsing header",this.src);for(var a=new DataView(a.response,0),e=0,f=0;f<this.headers.length;f++)this.headers[f].value=a.getInt32(e),10<h.graphit.debug&&j.log(this.headers[f].label,this.headers[f].value),e+=4;if(this.headers[d.magic_number].value!=this.magic_number)return j.error("Trying to load file that is not a GIMP GBR (Brush)"),!1;for(var f=this.headers[d.header_size].value,i="",s=0;s<f;s++)i+=
String.fromCharCode(a.getInt8(e)),e+=1;this.name=i;f=null;f=this.headers[d.bytes].value;if(4==f)label_type="RGBA",f=this._canvas_store_rgba;else if(1==f)label_type="GRAYSCALE",f=this._canvas_store_grayscale;else return j.log("Dunnot know how parsing format with bytes => ",f),!1;d=new Ccanvas({width:this.headers[d.width].value,height:this.headers[d.height].value});d.clear(new Ccolor({a:1}));for(var i=d.getContext("2d"),s=i.getImageData(0,0,d.width,d.height),n=0;e<a.byteLength;e++)n+=f(s,a,n,e);i.putImageData(s,
0,0);this.cCanvas=d;return!0};i.prototype._canvas_store_rgba=function(a,d,e,f){a.data[e]=d.getUint8(f);return 1};i.prototype._canvas_store_grayscale=function(a,d,e,f){a.data[e]=d.getUint8(f);a.data[e+1]=d.getUint8(f);a.data[e+2]=d.getUint8(f);a.data[e+3]=255;return 4};i.prototype.dom_build=function(){var a=$("<div />");this.loaded?a.append(this.cCanvas.dom_get()):a.append("<p>Failed to load Gimp gbr file: "+this.src+"</p>");this.rootElm=a;return this};i.prototype._error=function(){this.init();"_error"in
this.callback&&this.callback._error.call(this)};f.export(d,i)})(window,graphit,console);(function(h,f,j){var i=f.import("lib/object"),d=f.import("lib/menu"),e=f.import("app/toolbox"),a=f.import("app/core/theme"),k=f.import("app/license"),l=f.import("app/grapher"),p=f.import("lib/parameter/numeric"),m=f.import("app/surface/workspace"),s=f.import("app/surface"),n=f.import("lib/canvas"),q=new (f.import("lib/po")),r=function(a){a=a||{};a.className="app/graphit";a.label="graphit";a.widgets={};this.surfaces=[];this.selected=null;i.call(this,a,["widgets"]);this.dialog_options={position:"right top"};
this.dom_get();this.surface_create({parent:this,width:400,height:400})};r.prototype=Object.create(i.prototype);r.prototype.constructor=new i;r.prototype.init=function(){var f=this;this.bind_trigger(this,"create_surface",function(a,d){f.surface_create(d)});this.bind_trigger(this,"display_new_surface",function(){f.dialog_new_surface().dialog("open").dialog("moveToTop")});this.bind_trigger(this,"display_widget",function(a,d){f.get_widget(d).dialog("open").dialog("moveToTop")});this.wJquerytheme=new a;
this.wAbout=new k;this.wLogin=h.graphit.auth;var i=h.graphit.baseRestContent,m={cssClass:"disable",label:q.get("menu_login"),callback_click:function(){var a="",a=h.graphit.auth?i+"gi/login":h.graphit.baseStaticContent+"pages/no-authentication.htm";try{h.open(a,"graphit_oauth","width=900,height=600").focus()}catch(d){this.exception("cant_talk_to_opener",d)}}};this.cMenu=new d({parent:null,type:"jquery",label:"graphit_menu",entries:{files:{label:q.get("menu_file"),entries:{new_surface:{label:q.get("menu_new_surface"),
callback_click:function(){f.send_trigger("display_new_surface")}}}},edition:{label:q.get("menu_edition"),entries:{toolbox:{label:q.get("menu_toolbox"),callback_click:function(){f.send_trigger("display_widget",f.cToolbox)}}}},login:m,help:{label:q.get("menu_help"),entries:{theme:{label:q.get("menu_theme"),callback_click:function(){f.send_trigger("display_widget",f.wJquerytheme)}},about:{label:q.get("menu_about"),callback_click:function(){f.send_trigger("display_widget",f.wAbout)}}}}}});this.cToolbox=
new e({parent:this});this.bind_trigger(this.cToolbox,"update",function(){});this.cGrapher=new l({parent:this});this.bind_trigger(this.cGrapher,"update",function(){});this.keybindings={n:{label:"pen",callback:function(){f.cToolbox.select_tool_by_name("pen");return!1}},p:{label:"brush",callback:function(){f.cToolbox.select_tool_by_name("brush");return!1}},"Shift+e":{label:"eraser",callback:function(){f.cToolbox.select_tool_by_name("eraser");return!1}},"Ctrl+z":{label:"undo",callback:function(a){a.preventDefault();
a.stopPropagation();a.stopImmediatePropagation();if(!f.selected)return j.warn("No surface selected to call undo"),!1;f.selected.undo();return!1}}};for(var p in this.keybindings)$(document).bind("keydown",p,this.keybindings[p].callback);this.send_trigger("display_widget",this.cToolbox)};r.prototype.get_widget=function(a){"dom_get"in a||this.exception("method_object_missing","dom_get");if(a.label in this.widgets)return this.widgets[a.label];var d={closeOnEscape:!0,modal:!0};if("dialog_options"in a)for(var e in a.dialog_options)d[e]=
a.dialog_options[e];d=a.dom_get().dialog(d);return this.widgets[a.label]=d};r.prototype.dialog_new_surface=function(){if("new_surface"in this.widgets)return this.widgets.new_surface;var a=this,d=$("<div />").attr("title","New Csurface"),e=$("<div />").addClass("group group-new-surface"),f=new p({label:"width",bAutosave:!1,parent:this,min:1,max:1920,step:1,def:400}),h=new p({label:"height",parent:this,bAutosave:!1,min:1,max:1280,step:1,def:400});e.append(f.dom_get(),h.dom_get());d.append(e);d.dialog({modal:!1,
closeOnEscape:!0,stack:!0,zIndex:10,buttons:{Ok:function(){var d=$(this).parent();a.send_trigger("create_surface",{width:d.find(".width input").attr("value"),height:d.find(".height input").attr("value")})},Cancel:function(){$(this).dialog("close")}}});return this.widgets.new_surface=d};r.prototype.surface_create=function(a){var d=this;a.parent=this;var e=null;try{e=new m(a)}catch(h){return j.error("Cannot create surface, Exception <<< ",h," >>>"),!1}if(!e)return!1;this.bind_trigger(e.cSurface,"surface_selected",
function(a,e){e instanceof s||d.exception("invalid_surface_selected_parameter");e.attach_graphit(d);d.selected=e});f.ui.widget_factory(e.dom_get(),{width:parseInt(a.width)+100});this.surfaces.push(e);this.selected||(this.selected=e);this.dom_build_add_surface(e);return!0};r.prototype.dom_build_add_surface=function(a){var d=this,e=$('<div class="group group-graphit-surface" />'),f=new n({width:50,height:50}),h=a.cSurface;h.canvas_preview=f;f.copy({src:h.cCanvas});e.append(f.dom_get());this.rootElm.find(".group-graphit-surfaces").append(e);
h.bind_trigger(h,"redraw_preview",function(a,d){h.canvas_preview.copy({src:d.cCanvas,resize:!0})});e.click(function(){h.send_trigger("surface_selected",h);cEach(d.surfaces,function(a,d){d.cSurface==h&&d.rootElm.parent().dialog("open").dialog("moveToTop")});$(this).parent().find(".group-graphit-surface").removeClass("selected");$(this).addClass("selected")});return this};r.prototype.dom_build=function(){var a=$("<div />"),d=$('<div class="group group-menu" />');d.append(this.cMenu.dom_get());a.append(d);
d=$('<div class="group group-graphit-surfaces"/>');cEach(this.surfaces,function(a,e){var f=$('<div class="graphit-surface" />'),h=new n({width:50,height:50});h.copy(e.cCanvas,!0);f.append(h.dom_get());d.append(f)});a.append(d);for(var e=h.graphit.baseStaticContent+"/",f=$('<div class="group group-badge">'),i=["html5","vcss","zf2","gplv3"],j=0;j<i.length;j++){var k=$('<img class="badge" />');k.attr("width",32);k.attr("src",e+"images/badge-"+i[j]+"-32.png");f.append(k)}a.append(f);this.rootElm=a;return this};
r.prototype.list=function(a){for(var d=0;d<this.surfaces.length;d++)a.call(this,d,this.surfaces[d]);return this.surfaces.length};f.export("app/graphit",r)})(window,graphit,console);(function(h,f,j,i){var d=f.import("lib/object"),e=function(a){var e=this,a=a||{};a.className="app/auth";a.label="app/auth";a.disable=a.disable!=i?a.disable:!1;this.selected=null;a.dialog_options=a.dialog_options||{modal:!1,width:200};this.__init_singleton(a);d.call(this,a,["dialog_options"]);this.hasValidAccount();this.bind_trigger(this,"update",function(){e.update()})};e.prototype=Object.create(d.prototype);e.prototype.constructor=new d;e.prototype.hasValidAccount=function(){var a=h.graphit;if(!("storage"in
a))return null;a=a.storage.get("chooserAccounts");return!a?null:a=JSON.parse(a)};e.prototype.__init_singleton=function(a){"__data"in e||(e.__data={});"__disable"in e||(e.__disable=a.disable)};e.prototype.copy=function(a){for(key in a.get_data())j.log("Copy",key),this.set(key,a.get(key))};e.prototype.get_data=function(){return e.__data};e.prototype.is_logged=function(){return this.get("verifiedEmail")};e.prototype.is_disable=function(){return e.__disable};e.prototype.set=function(a,d){j.log("Auth",
a,d);e.__data[a]=d};e.prototype.get=function(a){return!(a in e.__data)?(j.warn("key doesn't exists",a),null):e.__data[a]};e.prototype.each=function(a){if(!a||"function"!=typeof a)throw"invalid_callback";for(var d in e.__data)a.call(e.__data,d,this.get(d))};e.prototype.dom_get=function(a){return this.rootElm&&(a==i||!a)?this.rootElm:this.dom_build().rootElm};e.prototype.__replace_accounts=function(){var a=this,d=this.rootElm.children(".group-graphit-authentication").empty(),e=this.hasValidAccount();
cEach(e,function(e,f){var h=$("<div />"),i=$("<img />");i.addClass("photoUrl");i.attr("src",f.photoUrl);i.attr("alt","photoUrl");h.append(i);h.append('<b class="displayName">'+f.displayName+"</b>");h.append('<b class="email">'+f.email);a.ajax_is_logged({email:f.email,callback_error:function(){j.warn("removing email",f.email)}});d.append(h)});if(e&&0<e.length){var e=$('<div class="logout" />'),f=$("<button />");f.append(T("menu_logout"));f.button({});f.click(function(){h.graphit.storage.remove("chooserAccounts");
deleteAllCookies();a.ajax_logout({email:"",callback_success:function(){j.log("logout");d.empty()}});a.send_trigger("update")});e.append(f);d.append(e)}};e.prototype.update=function(){this.__replace_accounts()};e.prototype.dom_build=function(){var a=$('<div title="Graphit Authentication"/>'),d=$("<div  />");d.addClass("group group-graphit-authentication");a.append(d);this.rootElm=a;this.__replace_accounts();return this};e.prototype.ajax_is_logged=function(a){var d=this,e=$.ajax({type:"POST",url:h.graphit.baseRestContent+
"gi/logged",data:{email:a.email}});"callback_succces"in a?e.done(function(e){a.callback_succes.call(d,e)}):"callback_error"in a&&e.error(function(e,f){a.callback_error.call(d,e,f)})};e.prototype.ajax_logout=function(a){var d=this,e=$.ajax({type:"POST",url:h.graphit.baseRestContent+"gi/logout",data:{email:a.email}});"callback_success"in a?e.done(function(e){a.callback_success.call(d,e)}):"callback_error"in a&&e.error(function(e,f){a.callback_error.call(d,e,f)})};f.export("app/auth",e)})(window,graphit,
console);(function(h,f,j){var i=f.debug,d=f.import("lib/object"),e=function(a){a=a||{};a.className="app/browser";a.label="app/browser";d.call(this,a,[])};e.prototype=Object.create(d.prototype);e.prototype.constructor=new d;e.prototype.get_language=function(){var a=navigator.language?navigator.language:navigator.userLanguage,d=/^\s*([^-]*)-([^\s]*)\s*$/.exec(a);return d?d[1]:a};e.prototype.is_file_supported=function(){if(h.File&&h.FileReader&&h.FileList&&h.Blob)return!0;j.error("The File APIs are not fully supported in this browser.");
return!1};e.prototype.is_canvas_supported=function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))};e.prototype.__test=function(){var a=new (f.import("app/browser")),d="File supported: ",d=a.is_file_supported()?d+"yes":d+"no",d=d+"\nCanvas supported: ",d=a.is_canvas_supported()?d+"yes":d+"no";i&&j.log(d);return!0};f.export("app/browser",e)})(window,graphit,console);(function(h,f,j){var i=f.import("lib/object"),h=function(d){d=d||{};d.className="app/core/object";d.label="app/core/object";i.call(this,d,[])};h.prototype=Object.create(i.prototype);h.prototype.constructor=new i;h.prototype.add_component=function(d,e){var a=(d+"").split("/"),f=a.pop();j.log("root/xpath",f,a);if(0==a.length)this[f]=e;else{if(!this[f])throw"invalid_component_path__"+d+"-"+f;this[f].add_component(a.join("/"),e)}};h.prototype.__test=function(){new (f.import("app/core/object"))};f.add_component=
h.add_component;f.export("app/core/object",h)})(window,graphit,console);(function(h,f,j){var i=f.import("app/core/object"),h=function(d){d=d||{};d.className="app/core/ui";d.label="app/core/ui";i.call(this,d,[])};h.prototype=Object.create(i.prototype);h.prototype.constructor=new i;h.prototype.widget_factory=function(d,e){e=e||{};if(!d)throw"func_widget_factory_need_dom";j.log("Widget factory",d,e);var a={autoOpen:!0,resizable:!0,draggable:!0,width:250,zIndex:10,dialogClass:"shojs-dialog",stack:!0},f;for(f in a)f in e||(e[f]=a[f]);d.dialog(e);return d};h.prototype.widget_exception=
function(d){var e=graphit.import("lib/exception");j.error("Widget",d);var a=d,f="[Error] ";d instanceof e&&(a=d.to_s({format:"html"}),f=f+d.className+"/"+d.label);e=$('<div title="'+f+'" />');e.append($("<p>"+a+"<p/>"));e.dialog({modal:!0});throw d;};h.prototype.__test=function(){new (f.import("app/core/ui"))};f.export("app/core/ui",h)})(window,graphit,console);(function(h,f,j){var i=f.import("lib/object"),h=function(d){d=d||{};d.className="lib/ui/content";d.parent=d.parent||null;i.call(this,d,["label","parent"]);this.content=null;this.is_visible=!0;this.childs=[];this.dom_get()};h.prototype=Object.create(i.prototype);h.prototype.constructor=new i;h.prototype.visible=function(){if(0==arguments.length)return this.is_visible;this.is_visible=arguments[0]?!0:!1;return this};h.prototype.set_content=function(d){j.log("Setting content",d);this.content=d;return this};
h.prototype.get_content=function(){return this.content};h.prototype.refresh=function(){this.rootElm.detach();if(!this.visible)return j.log("Hidden content",this.label),this;var d=this.get_content();this.rootElm.append(d);for(d=0;d<this.childs.length;d++){var e=this.childs[d];e.visible()&&(e.refresh(),this.rootElm.append(e.dom_get()))}return this};h.prototype.empty=function(){this.rootElm.empty();return this};h.prototype.add_child=function(d){d.parent=this;this.childs.push(d);return d};h.prototype.get_child=
function(d){d||this.exception("empty_options");for(var e=0;e<this.childs.length;e++){var a=this.childs[e];if(d.index&&a.index==d.index||d.label&&a.label==d.label)return a}return null};h.prototype.set_index=function(d){this.index=d;return this};h.prototype.get_index=function(){return this.index};h.prototype.dom_build=function(){var d=$("<span />");d.attr("id",this.get_dom_id());d.addClass(this.get_dom_class());this.rootElm=d;this.refresh();return this};h.prototype.to_s=function(){var d="["+this.className+
"]\n",e=this.get_content();"object"===typeof e&&"to_s"in e&&(e=e.to_s());d=d+("Content: "+e+"\n")+"Childs:\n";for(e=0;e<this.childs.length;e++)d+=" - "+this.childs[e].to_s()+"\n";return d};h.prototype.__test=function(){new (f.import("lib/ui/content"))};f.export("lib/ui/content",h)})(window,graphit,console);(function(h,f,j){var i=f.import("lib/ui/content"),h=function(d){var e=this,d=d||{};d.className="lib/ui/rollout";i.call(this,d,[]);this.bind_trigger(this,"graphit-refresh-ui",function(){e.refresh()});this.dom_get()};h.prototype=Object.create(i.prototype);h.prototype.constructor=new i;h.prototype.__test=function(){var d=new (f.import("lib/ui/rollout"))({label:"TEST_test"}),e=f.import("lib/ui/content"),a=new e({label:"content01"});a.set_content("Content 01");var h=new e({label:"content02"});h.set_content("Content 02");
var i=new e({label:"content03"});i.set_content("Content 03");e=new e({label:"refresh-button"});e.get_content=function(){var a=$("<button >Refresh</button>").button();a.click(function(){j.log("PLOP");d.send_trigger("graphit-refresh-ui")});return a};d.add_child(a);d.add_child(h);d.add_child(i);d.add_child(e);d.dom_get().dialog();a.set_content("Content 01 Modified")};f.export("lib/ui/rollout",h)})(window,graphit,console);(function(h,f,j){var i=f.import("lib/object"),d=new (graphit.import("lib/po")),e={autoOpen:1,buttons:1,closeOnEscape:1,closeText:1,dialogClass:1,draggable:1,height:1,hide:1,maxHeight:1,maxWidth:1,minHeight:1,minWidth:1,modal:1,position:1,resizable:1,show:1,stack:1,title:1,width:1,zIndex:1},h=function(a){a=a?a:{};a.className=a.className||"lib/widget";a.label=a.label||"lib/widget";a.options={};a.content=new (f.import("lib/ui/content"))({label:"main_content"});i.call(this,a,["label","content","options"]);
this.dom_get()};h.prototype=Object.create(i.prototype);h.prototype.constructor=new i;h.prototype.init=function(){this.dom_get({force:!0})};h.prototype.set=function(a,d){a in e||this.exception("unauthorized_key",a);this.options[a]=d};h.prototype.get=function(a){a in e||this.exception("unauthorized_key",a);return this.options[a]};h.prototype.dom_build=function(){var a=$("<div />");a.attr("id",this.get_dom_id());a.attr("title",this.label);var d=$("<span />");d&&(d.addClass("group group-widget-content"),
a.append(d));this.rootElm=a;return this};h.prototype.add_content=function(a){this.content.add_child(a);this.refresh()};h.prototype.refresh=function(){j.log("Refreshing ",this.label);var a=this.rootElm.find(".group-widget-content");a.empty();this.content.refresh();a.append(this.content.dom_get());return this};h.prototype.show=function(a){a=a||this.options;j.log("Options",a);this._dialog=this.dom_get().dialog(this.options).dialog("open")};h.prototype.hide=function(){if(!this._dialog)return!1;this._dialog.dialog("close");
return!0};h.prototype.__test=function(){j.log("Testing widget");var a=new (f.import("lib/widget"))({label:"TEST_test"});a.set("autoOpen",!0);a.set("width",200);a.set("height",200);a.set_content("Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec ac felis dui, sodales mattis urna. In eros quam, tristique et varius at, faucibus ac sapien. Aenean vel augue eu tortor pretium sollicitudin. In tristique ipsum volutpat lectus tempor ut pulvinar massa ultrices. Donec tincidunt dui vitae leo fringilla tristique. Nulla tempor enim in lacus faucibus non laoreet elit pretium. Donec eget dapibus diam. Vivamus adipiscing iaculis mauris ultrices convallis. Nunc ultrices nibh euismod arcu fringilla a semper nulla sollicitudin. Curabitur commodo libero felis. Vivamus facilisis leo id felis molestie varius tempus erat dignissim. Praesent aliquam, urna ac dictum commodo, augue est rhoncus nisi, eu ultricies diam purus vitae mauris. Curabitur in lectus enim.");
d.set_lang("fr");a.refresh();a.show()};f.export("lib/widget",h)})(window,graphit,console);(function(h,f,j){var i=f.import("lib/widget"),h=function(d){var e=this,d=d||{};d.className="app/ui/toolbox";d.label="widget_toolbox";i.call(this,d);this.bind_trigger(this,"tool_selected",function(a,d){j.log("Tool selected",a,d,e);e.select_tool(d,a)})};h.prototype=Object.create(i.prototype);h.prototype.constructor=new i;h.prototype.init=function(d){this.set("width",200);var d=f.import("lib/ui/content"),e=new d({label:"toolbox_tools"});this.__populate_tools(e);this.content.add_child(e);e=new d({label:"toolbox_preview"});
e.set_content($("<h4>Toolbox preview</h4>"));e.visible(!0);this.content.add_child(e);e=new d({label:"toolbox_colors"});e.set_content($("<h4>Toolbox color</h4>"));this.content.add_child(e);d=new d({label:"toolbox_options"});d.set_content($("<h4>Toolbox options</h4>"));this.content.add_child(d);this.dom_get();this.refresh();j.log("Toolbox",this)};h.prototype.refresh=function(){var d=this.content.get_child({label:"toolbox_options"}),d=this.rootElm.find("#"+d.get_dom_id());d.children().detach();d=this.content.get_child({label:"toolbox_preview"});
d=this.rootElm.find("#"+d.get_dom_id());d.children().detach();d=this.content.get_child({label:"toolbox_colors"});d=this.rootElm.find("#"+d.get_dom_id());d.children().detach();j.log("Refreshing ",this.label);d=this.rootElm.find(".group-widget-content");this.content.refresh();d.append(this.content.dom_get());return this};h.prototype.__populate_tools=function(d){this.tools=[];for(var e=$("<span />"),a=f.find("app/tool/(.*)"),h=0;h<a.length;h++){var i=new a[h]({parent:this}),j=i.dom_get();d.rootElm.append(j);
this.tools.push(i)}d.set_content(e)};h.prototype.get=function(d){return this.content.get(d)};h.prototype.__populate_options=function(d){j.log("Populate options");var e=0,a=$("<span />"),f=this.content.get_child({label:"toolbox_options"}),h;for(h in d.parameters)a.append(d.parameters[h].dom_get()),j.log("Label",h),e++;0<e?(f.set_content(a),f.visible(!0)):(f.set_content($("<span />")),f.visible(!1));this.refresh()};h.prototype.__populate_preview=function(){};h.prototype.__populate_colors=function(){};
h.prototype.select_tool=function(d){j.log("Toolbox selecting tool",d.label);this.__populate_preview(d);this.__populate_colors(d);this.__populate_options(d)};h.prototype.__test=function(){(new (f.import("app/ui/toolbox"))).show()};f.export("app/ui/toolbox",h)})(window,graphit,console);(function(h,f,j){var i=f.import("lib/object"),h=function(d){d=d||{};d.className="lib/widget/manager";d.label="lib/widget/manager";i.call(this,d,[])};h.prototype=Object.create(i.prototype);h.prototype.constructor=new i;h.prototype.init=function(){this.widgets=[]};h.prototype.add=function(d){var e=f.import("lib/widget");d instanceof e||this.exception("add_unknow_type",d);this.widgets.push(d)};h.prototype.get=function(d){for(var e=0;e<this.widgets.length;e++){var a=this.widgets[e];j.log(a);if("id"in
d&&a.uid==d.uid||"label"in d&&a.label==d.label)return a}return null};h.prototype.list=function(d){(!d||"function"!=typeof d)&&this.exception("need_callback_parameter");for(var e=0;e<this.widgets.length;e++)d.call(this,e,this.widgets[e])};h.prototype.__test=function(){new (f.import("lib/widget/manager"))};f.export("lib/widget/manager",h)})(window,graphit,console);(function(h,f,j){h=function(){j.log("[ Starting ]");var h=0,d=0,e;for(e in f.egg){h++;var a=null,k="[ Testing ] "+h+" / "+e+" / ",l=f.egg[e].prototype;if(l){var p=!1;if("__test"in l){try{f.import(e),p=l.__test.call(this),p=!0,d++}catch(m){a={original:m,message:m.message},"object"===typeof m&&"to_s"in m&&(a.to_s=m.to_s())}p?j.log(k+"Ok"):(j.log(k+"Fail"),j.error("Error in <<< ",e," >>>"),j.error(a,a.original),"shojs-exception"==a.original.type&&widget_exception(a.original))}else j.log(k+" NO TEST"),
d++}else j.log(k,f.egg[e]),d++}j.log("Test ",d," / ",h)};h.prototype.__test=function(){return!0};f.export("app/boot/test",h)})(window,graphit,console);(function(h,f){var j=function(){var h=new (f.import("app/core/ui"));f.add_component=h.add_component;f.add_component("ui",h);f.add_component("widget",new (f.import("lib/widget/manager")));h=new (f.import("app/ui/toolbox"));f.widget.add(h);f.widget.get({label:"widget_toolbox"}).show()};j.prototype.__test=function(){return!0};f.export("app/boot",j)})(window,graphit,console);
