var E_LAYERLABEL=Object({current:"_current",mouse:"_mouse",grid:"_gris",prefrag:"_prefrag"});function callback_stub(){}function helper_get_classname(f){return"undefined"===typeof f?"undefined":null===f?"null":Object.prototype.toString.call(f).match(/^\[object\s(.*)\]$/)[1]}function helper_bound_value(f,h,i){f<=h?f=h:f>=i&&(f=i);return Math.floor(f)}var near_zero_tolerance=0.01;function near_zero(f){return f<near_zero_tolerance&&f>-near_zero_tolerance?!0:!1}
function helper_format_number_length(f,h){for(var i=""+f;i.length<h;)i="0"+i;return i}function getObjectClass(f){if("object"!=typeof f||null===f)return!1;console.log(f.constructor.toString());return/^function (\w+)\(/.exec(f.constructor.toString())[1]}
function cEach(f,h){this.ret=!1;this.run=!0;if(void 0==f)return console.error("Cannot iterate over null thing"),!1;if(!h||"function"!=typeof h)return console.error("No callback assigned to cEeach"),!1;if(f instanceof Array)for(var i=0;i<f.length&&this.run;i++)h.call(this,i,f[i]);else if(f instanceof Object)for(elm in console.log("Each array"),f){if(!this.run)break;f.hasOwnProperty(elm)&&h.call(this,elm,f[elm])}else this.exception("invalid_thing");return this.ret}
cEach.prototype.stop=function(f){console.log("stop",f);this.run=!1;this.ret=f};function Cenum(f){for(o in f)this[o]=f[o]}Cenum.prototype.key_by_value=function(f){for(label in this)if(this.hasOwnProperty(label)&&this[label]==f)return label;console.error("No enum found with value",f);return""};
function deleteAllCookies(f){for(var f=f||window.document,h=f.cookie.split(";"),i=0;i<h.length;i++){var j=h[i];console.log("Delete cookie",j);var e=j.indexOf("="),j=-1<e?j.substr(0,e):j;f.cookie=j+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"}(f=window.opener)&&deleteAllCookies(f.document)};(function(f,h,i){var j=10<h.debug?!0:!1,f=function(){this.prefix="shojs-";this.postfix="graphit";this.id=null;this.className="lib/uid"};f.prototype.init=function(){};f.prototype.init=f.prototype.init;f.prototype.__get_frag=function(){var e=Math.round(Math.random()*Date.now()/655350),e=parseInt((e+"").slice(0,5));return helper_format_number_length(e,5)};f.prototype.__get_frag=f.prototype.__get_frag;f.prototype.gen=function(){for(var e=this.prefix,d=0;2>d;d++)e+=this.__get_frag()+"-";return this.last_id=
e+=this.postfix};f.prototype.gen=f.prototype.gen;f.prototype.__test=function(){var e=new (h.import("lib/uid"));j&&(i.log(e),i.log("Testing uid",e.gen()));return!0};f.prototype.__test=f.prototype.__test;h.export("lib/uid",f)})(window,graphit,console);(function(f,h,i){var j=10<=h.debug?!0:!1,f=function(e){e=e||{};this.EXCEPTION={_ALL:{method_object_missing:"This object doesn't have the required method (See additional)"},Csurface:{invalid_width:"The specified width is invalid 0 < width < 1920",invalid_height:"The specified height is invalid 0 < height < 1920"},Ccanvas:{invalid_width:"The specified width is invalid 0 < width < 1920",invalid_height:"The specified height is invalid 0 < height < 1920",invalid_copy_source:"You're trying to copy something that is not a Ccanvas or who is null"},
Cmenu:{invalid_menu_entry:"Your are trying to add non Cmenu_entry object",label_already_present:"Label already set in this menu"},Ctool:{no_size_parameter:"Each tool require a size Cparameter"}};this.type="shojs-exception";this.className=e.className||"lib/exception";this.label=e.label;this.additional=e.additional;this.object=e.object;this.original=e.original;this.message=null;this.className in this.EXCEPTION&&this.label in this.EXCEPTION[this.className]&&(this.message=this.EXCEPTION[this.className][this.label]);
!this.message&&this.label in this.EXCEPTION._ALL&&(this.message=this.EXCEPTION._ALL[this.label])};f.prototype.__test=function(){var e=new (h.import("lib/exception"))("TEST_EXCEPTION");try{throw e;}catch(d){j&&i.log(d.to_s())}return!0};f.prototype.__test=f.prototype.__test;f.prototype.to_s=function(e){var d="\n";void 0!=e&&"format"in e&&"html"==e.format&&(d="<br>"+d);e="["+this.type+"]"+d+d;for(label in this)this.hasOwnProperty(label)&&(e="object"==typeof this[label]&&this[label]?e+(label+": "+this[label].toString()+
d):e+(label+": "+this[label]+d));return e};f.prototype.to_s=f.prototype.to_s;h.export("lib/exception",f)})(window,graphit,console);(function(f,h,i,j){var e=h.debug,d=h.import("lib/uid"),a=function(a,l){l=l?l:[];a=a?a:{};a.className=a.className||"lib/object";a.label=a.label||"object";this.uid=null;if(a!=j){if(!(a instanceof Object))throw i.error("[Module/Constructor] Options must be hash aka Object",this),"[Module/Constructor] Options must be hash aka Object";this.parent=null;this.parameters={};this._class_init(a,l);try{this.init(a,l)}catch(d){throw i.error("Cannot init object << ",this," >> Exception <<< ",d," >>>"),d;}}};a.prototype._class_init=
function(a,l){this.uid=(new d).gen();this.callback={};this._parse_options(a,l);return this};a.prototype._class_init=a.prototype._class_init;a.prototype.init=function(){return!1};a.prototype.init=a.prototype.init;a.prototype.exception=function(a,d,e){a=new (h.import("lib/exception"))({className:this.className,label:a,additional:d,object:this});i.error(a.to_s());i.log("Options",e);e&&("dialog"in e&&e.dialog)&&widget_exception(a);throw a;};a.prototype.exception=a.prototype.exception;a.prototype._parse_options=
function(a,d){if(a==j)i.warn("No << {} >> argument passed to new Module");else{for(var d=d||[],e=["className","label"],m=0;m<e.length;m++)!(e[m]in a)&&!a[e[m]]?this.exception("missing_mandatory_parameter",e[m]):d.push(e[m]);for(m=0;m<d.length;m++){var h=d[m];h in a?this[h]=a[h]:10<=f.graphit.debug&&i.warn("Needed property <<",h,">> ")}this._permitted_keys=d;if("parameters"in a)for(var n in a.parameters)this.add_parameter(a.parameters[n]);e=/^callback_(.*)$/;for(h in a)(m=e.exec(h))&&(m[1]in this.callback?
i.error("Callback",m[1],"already installed skipping..."):this.callback[m[1]]=a[h]);return!0}};a.prototype._parse_options=a.prototype._parse_options;a.prototype.install_callback=function(a){(!a||!("name"in a)||!("callback"in a)||"function"!=typeof a.callback)&&this.exception("install_callback_bad_arguments",a);a.name in this.callback&&this.exception("install_callback_already_registered",a);this.callback[a.name]=a.callback};a.prototype.install_callback=a.prototype.install_callback;a.prototype.guid=
function(a){return(""+this.className+"-"+this.uid+(a?"-"+a:"")).toLowerCase()};a.prototype.guid=a.prototype.guid;a.prototype.get_trigger_name=function(a){return this.guid(a)};a.prototype.get_trigger_name=a.prototype.get_trigger_name;a.prototype.send_trigger=function(a,d){var e=this.get_trigger_name(a);4<f.graphit.debug&&i.log("[trigger/send]",e,d);$(document).trigger(e,d)};a.prototype.send_trigger=a.prototype.send_trigger;a.prototype.get_dom_id=function(a){var a=a?"-"+a:"",d=this.className.split("/");
cEach(d,function(a,k){k.toLowerCase()});d=d.join("-");i.log("XCN",d);return this.uid+"-"+d+a};a.prototype.get_dom_id=a.prototype.get_dom_id;a.prototype.get_dom_class=function(){name=name?"-"+name:"";var a=this.className.split("/");cEach(a,function(a,k){k.toLowerCase()});a=a.join("-");i.log("XCN",a);return a};a.prototype.get_dom_class=a.prototype.get_dom_class;a.prototype.set=function(){throw"object_set_method_is_not_implemented";};a.prototype.set=a.prototype.set;a.prototype.bind_trigger=function(a,
d,e){if(!a)return i.warn("Cannot bind to null object"),!1;a=a.get_trigger_name(d);4<f.graphit.debug&&i.debug("[trigger/bind]",d,this.className," => ",a);$(document).bind(a,function(a,k){e.call(this,a,k)});return!0};a.prototype.bind_trigger=a.prototype.bind_trigger;a.prototype.add_parameter=function(a){var d=h.import("lib/parameter/select"),e=h.import("lib/parameter/numeric"),f=h.import("lib/parameter/enum/type");"parent"in a||(a.parent=this);"label"in a||this.exception("parameter_need_label",a);!("type"in
a)||a.type==f.numeric?this.parameters[a.label]=new e(a):a.type==f.select?this.parameters[a.label]=new d(a):this.exception("unknow_parameter_type");return!0};a.prototype.add_parameter=a.prototype.add_parameter;a.prototype.get_parameter=function(a){(!("parameters"in this)||!(a in this.parameters))&&this.exception("accessing_unknow_parameter",a);return this.parameters[a].get()};a.prototype.get_parameter=a.prototype.get_parameter;a.prototype.callback_exists=function(a){return a in this.callback&&"function"==
typeof this.callback[a]?this.callback[a]:null};a.prototype.callback_exists=a.prototype.callback_exists;a.prototype.dom_get=function(a){a=a||{};a.force=!1;var d=this.rootElm;if(a.force||!d)d=this.dom_build().rootElm;if("noHeader"in a&&a.noHeader)return d;a=$("<div />");a.attr("id",this.uid);a.attr("title",this.label);a.addClass((this.className+"-"+this.label).toLowerCase());a.append(d);return a};a.prototype.dom_get=a.prototype.dom_get;a.prototype.add_widget=function(a,d){(!a||!d)&&this.exception("no_name_or_root_elm",
{name:a,rootElm:d});"widgets"in this||(this.widgets={});a in this.widgets&&this.exception("dialog_already_exist",a);this.widgets[a]=d;return this};a.prototype.add_widget=a.prototype.add_widget;a.prototype.to_s=function(a){var a=a||"\n",d="["+this.className+"]"+a,d=d+(" - uid: "+this.uid+a);return d+=" - trigger name: "+this.get_trigger_name()+a};a.prototype.to_s=a.prototype.to_s;a.prototype.get_widget=function(a){(!a||!(a in this.widgets))&&this.exception("no_widget_with_this_name",{name:a});return this.widgets[a]};
a.prototype.get_widget=a.prototype.get_widget;a.prototype.__test=function(){e&&i.warn("__test() from base object");new (h.import("lib/object"))({parent:this,label:"Test",className:"Test"});return!0};a.prototype.__test=a.prototype.__test;h.export("lib/object",a)})(window,graphit,console);(function(f,h,i){var j=10<=h.debug?!0:!1,e=function(){this.className="lib/localStorage";this.init()};e.prototype.init=function(){this.test_compatibility()?(this.store=f.localStorage,this.test_insert()||(this.store={})):this.store={}};e.prototype.first_install=e.prototype.first_install;e.prototype.test_compatibility=function(){if("localStorage"in f&&null!=f.localStorage)return!0;i.error("Your web browser doesn't support web storage");return!1};e.prototype.test_compatibility=e.prototype.test_compatibility;
e.prototype.test_insert=function(){try{this.set("_____TEST_INSERT_VALUE_____","_____TEST_INSERT_VALUE_____")}catch(d){return!1}this.remove("_____TEST_INSERT_VALUE_____");return!0};e.prototype.test_insert=e.prototype.test_insert;e.prototype.list=function(){return this.store};e.prototype.list=e.prototype.list;e.prototype.remove=function(d){j&&i.log("Removing key",d);if("removeItem"in this.store)return this.store.removeItem(d);delete this.store[d]};e.prototype.remove=e.prototype.remove;e.prototype.get=
function(d){j&&i.log("Get key",key);return this.store&&d in this.store?this.store[d]:null};e.prototype.get=e.prototype.get;e.prototype.set=function(d,a){j&&i.log("Setting",d,"with",a,"into",this.store);this.store||i.error("Storage not set");try{"removeItem"in this.store&&this.store.removeItem(d),this.store[d]=a}catch(k){var e=new Cexception_message({label:"store_new_value_failed",className:this.className,object:this,additional:"key: "+d+" / value: "+a,original:k});i.error(e.to_s(),k)}};e.prototype.set=
e.prototype.set;e.prototype.__test=function(){var d=new (h.import("lib/localStorage"));d.set("__TEST__","__TEST__");var a=d.get("__TEST__");if("__TEST__"!=a)throw d.className+"_cannot_fetch_key";for(var k in d.list())a=d.get(k),j&&i.log(k,a);d.remove("__TEST__");for(k in d.list())a=d.get(k),j&&i.log(k,a);return!0};e.prototype.__test=e.prototype.__test;h.export("lib/localStorage",e)})(window,graphit,console);(function(f,h,i){var j=10<h.debug?!0:!1,e=h.import("lib/object"),d=h.import("lib/exception"),f=function(a){this.PO=this.PO={en:{menu_new_surface:"New",menu_theme:"Theme",menu_about:"About",menu_toolbox:"Toolbox",menu_file:"File",menu_help:"Help",menu_edition:"Edition",menu_login:"Login",menu_logout:"Logout",foreground_color:"Foreground color",background_color:"Background color",layers:"Layers",switch_color:"Switch color",tool_pencil:"Pen",tool_paintbrush:"Brush",tool_eraser:"Eraser","tool_bucket-fill":"Fill",
"tool_color-picker":"Color picker",right_click_to_save:"Right click -> Save as",save_image:"Save image",save:"Save",open:"Open",load:"Load",load_image:"Load image (URL)",TEST_test:"TEST_test: Testing PO translation"},fr:{menu_new_surface:"Nouveau",menu_theme:"Theme",menu_about:"A propos",menu_file:"Fichier",menu_help:"Aide",menu_edition:"Edition",menu_toolbox:"Outils",foreground_color:"Couleur principal",background_color:"Couleur de fond",layers:"Calques",switch_color:"Echange de couleur",tool_pencil:"Crayon",
tool_paintbrush:"Pinceau",tool_eraser:"Gomme","tool_bucket-fill":"Remplir","tool_color-picker":"Selection de couleur",right_click_to_save:"Clique droit -> Enregistrer l'image sous",save:"Sauver",open:"Ouvrir",load:"Charger",load_image:"Charger image (URL)",TEST_test:"TEST_test: TEST des traductions PO "}};this.label=null;this.def="en";a=a||{};a.className="lib/po";a.label="po";a.def="en";a.lang=a.lang||a.def;e.call(this,a,["lang","def"])};f.prototype=Object.create(e.prototype);f.prototype.constructor=
new e;f.prototype.get=function(a){a||this.exception("undefined_parameter","label");var k=this.def,e=this.lang||k,f=null;if(e in this.PO&&a in this.PO[e])f=this.PO[e];else if(k in this.PO&&a in this.PO[k])f=this.PO[k];else throw new d({className:this.className,label:"no_trad_and_no_def",object:this,additional:a});f[a]||this.exception("translation_fail",{label:a,lang:e});return f[a]};f.prototype.get=f.prototype.get;f.prototype.to_s=function(a){var a=a||{},a=a.nl||"\n",d="["+this.className+"]"+a,d=d+
(" - label: "+this.label+a),e;for(e in this.PO){var d=d+("--- LANG "+e+a),f;for(f in this.PO[e])d+=" - "+f+" => "+this.PO[e][f]+a}return d};f.prototype.to_s=f.prototype.to_s;f.prototype.set_lang=function(a){this.lang=a};f.prototype.set_lang=f.prototype.set_lang;f.prototype.__test=function(){var a=new (h.import("lib/po"))({lang:"en"}),d;for(d in a.PO){j&&i.log("Lang <<<",d,">>>");for(var e in a.PO[d]){var f=a.get(e);j&&(i.log("Label to translate: "+e),i.log(" - Translate",f))}}j&&i.log("Setting lang to",
"fr");a.set_lang("fr");j&&i.log(a.to_s());return!0};f.prototype.__test=f.prototype.__test;h.export("lib/po",f)})(window,graphit,console);(function(f,h){h.export("lib/parameter/enum/type",{numeric:1,select:2,checkbox:3})})(window,graphit,console);(function(f,h,i,j){var e=h.import("lib/object"),d=h.import("lib/localStorage"),a=h.import("lib/parameter/enum/type"),k=function(a){a=a||{};a.className=a.className||"lib/parameter";a.autoSave="autoSave"in a&&a.autoSave?!0:!1;a.label=a.label||"parameter";"parameters"in a&&this.exception("no_parameter_for_me");e.call(this,a,["type","def","label","autoSave","parent"]);this.autoSave&&(this.store=new d);this.__post_init(a);return this};k.prototype=Object.create(e.prototype);k.prototype.constructor=new e;
k.prototype.__post_init=function(a){if(this.autoSave){var d=this.make_registry_key();0<f.graphit.debug&&i.log("Loading parameter",d);d=this.store.get(d);this.value=d!=j?this._set(d):this._set(this.def)}else this.value=this._set(this.def);this.rootElm=null;var d=/^callback_(.*)$/,e;for(e in a)d.exec(e)&&(a[e]&&"function"==typeof a[e])&&(10<f.graphit.debug&&i.log("Installing callback for parameter["+this.type+"]",e),this[e]=a[e])};k.prototype.__post_init=k.prototype.__post_init;k.prototype.set=function(a){if(this.value==
a)return!1;this.value=this._set(a);this.autoSave&&(a=this.make_registry_key(),this.store.set(a,this.value));return!0};k.prototype.set=k.prototype.set;k.prototype._set=function(a){return a};k.prototype._set=k.prototype._set;k.prototype.reset=function(){this.set(this.def);return this.get()};k.prototype.reset=k.prototype.reset;k.prototype.get=function(){return this._get(this.value)};k.prototype.get=k.prototype.get;k.prototype._get=function(a){return a};k.prototype._get=k.prototype._get;k.prototype.make_registry_key=
function(){var a=this.parent.className||this.className,d=this.parent.label;a||this.exception("no_classname_in_parent");d||this.exception("no_label_in_parent");return(a+"-"+d+"-"+this.label).toLowerCase()};k.prototype.make_registry_key=k.prototype.make_registry_key;k.prototype.to_s=function(a){a=a||{};nl=a.nl||"\n";a="["+this.className+"]"+nl;return a+=" - label: "+this.label+nl};k.prototype.to_s=k.prototype.to_s;k.prototype.__test=function(){(new (h.import("lib/parameter"))({autoSave:!0,parent:{className:"classTest",
label:"labelTest"},def:"Test",type:a.numeric})).set("__TEST__","__TEST__");return!0};k.prototype.__test=k.prototype.__test;h.export("lib/parameter",k)})(window,graphit,console,void 0);(function(f,h,i){var j=5<h.debug?!0:!1,e=h.import("lib/parameter"),d=h.import("lib/parameter/enum/type"),f=function(a){a=a||{};a.className="lib/parameter/select";a.parent=a.parent||{className:"fakeClassName",label:"fakeLabel"};a.autoSave="autoSave"in a&&!a.autoSave?!1:!0;e.call(this,a,"autoSave def label type choices parent".split(" "));this.type=d.select};f.prototype=Object.create(e.prototype);f.prototype.constructor=new e;f.prototype.init=function(a){this.choices={};this.def=a.def;this.label=a.label;
this.type=a.type;for(var d in a.choices)this.choices[d]=a.choices[d]};f.prototype.init=f.prototype.init;f.prototype.dom_build=function(){this.rootElm=this.rootElm;this.label=this.label;this.choices=this.choices;var a=this,d=$('<div title="'+this.className+'">');d.addClass("selected parameter");d.append("<h6>"+this.label+"</h6>");var e=$("<select />"),f;for(f in this.choices){j&&i.log("Option",this.choices[f]);var h=$("<option/>");h.attr("value",this.choices[f]);this.value==this.choices[f]&&h.attr("selected",
"selected");h.append(document.createTextNode(this.choices[f]));e.append(h)}e.change(function(){a.set(this.value);a.rootElm.find("option").each(function(){$(this)});"callback_change"in a&&a.callback_change.call(a,this.value)});d.append(e);this.rootElm=d;return this};f.prototype.dom_build=f.prototype.dom_build;f.prototype.__test=function(){var a=new (h.import("app/core/ui")),d=(new (h.import("lib/parameter/select"))({parent:{className:"lib/parameter/select",label:"lib/parameter/select"},label:"Test parameter select",
def:"test01",choices:["test01","test02","test03"]})).dom_get();a.widget_factory(d);return!0};f.prototype.__test=f.prototype.__test;h.export("lib/parameter/select",f)})(window,graphit,console);(function(f,h,i){var j=h.import("lib/localStorage"),f=function(e){this.className="app/core/themeInjector";this.key="cjquery-theme-chooser-name";this.name=e||"south-street";this.ls=new j;this.init(this.name);this.inject_script(this.name)};f.prototype.__test=function(){new (h.import("app/core/themeInjector"))};f.prototype.__test=f.prototype.__test;f.prototype.init=function(e){var d=this.ls.get(this.key);d?this.name=d:(this.ls.set(this.key,e),this.name=e)};f.prototype.init=f.prototype.init;f.prototype.inject_script=
function(e){var d=document.getElementById("ui-theme"),e=h.baseStaticContent+"js/plugin/jquery-ui/1.9.2/themes/"+e+"/jquery-ui.css";d?d.setAttribute("href",e):(d=document.createElement("link"),d.setAttribute("rel","stylesheet"),d.setAttribute("id","ui-theme"),d.setAttribute("href",e),i.log("[Injecting/css]",e),document.getElementsByTagName("head")[0].appendChild(d))};f.prototype.inject_script=f.prototype.inject_script;h.export("app/core/themeInjector",f)})(window,graphit,console);(function(f,h,i,j){function e(){var a=h.import("lib/parameter/select");this.className=d;this.label="chooser";this.key="shojs-jquery-theme";this.pTheme=this.pTheme=new a({parent:this,label:"name",choices:{base:"base",black_tie:"black-tie",blitzer:"blitzer",cupertino:"cupertino",dark_hive:"dark-hive",dot_luv:"dot-luv",eggplant:"eggplant",excite_bike:"excite-bike",flick:"flick",hot_sneaks:"hot-sneaks",humanity:"humanity",le_frog:"le-frog",mint_choc:"mint-choc",overcast:"overcast",pepper_grinder:"pepper-grinder",
redmond:"redmond",smoothness:"smoothness",south_street:"south-street",start:"start",sunny:"sunny",swanky_purse:"swanky-purse",trontastic:"trontastic",ui_darkness:"ui-darkness",ui_lightness:"ui-lightness",vader:"vader"},def:"base",callback_change:function(a){a=f.graphit.baseStaticContent+"js/plugin/jquery-ui/1.9.2/themes/"+a+"/jquery-ui.css";i.log("src",a);$("#ui-theme").attr("href",a)}});this.rootElm=null;return this}var d="app/core/theme";e.prototype.dom_build=function(){var a=$('<div title="Theme chooser"/>');
a.append(this.pTheme.dom_get());this.rootElm=a;return this};e.prototype.dom_build=e.prototype.dom_build;e.prototype.dom_get=function(a){return this.rootElm&&a!=j&&!a?this.rootElm:this.dom_build().rootElm};e.prototype.dom_get=e.prototype.dom_get;e.prototype.__test=function(){(new (h.import(d))).dom_get().dialog()};e.prototype.__test=e.prototype.__test;h.export(d,e)})(window,graphit,console);(function(f,h,i){function j(e){e=e||{};e.className=d;e.label="checkbox";e.autoSave="autoSave"in e&&!e.autoSave?!1:!0;a.call(this,e);this.type=k.checkbox}var e=10<h.debug?!0:!1,d="lib/parameter/checkbox",a=h.import("lib/parameter"),k=h.import("lib/parameter/enum/type");j.prototype=Object.create(a.prototype);j.prototype.constructor=new a;j.prototype.init=function(){this.choices={}};j.prototype._get=function(a){return"true"==a?!0:"false"==a?!1:a?!0:!1};j.prototype._set=function(a){(a="false"==a||!a?
!1:!0)?this.rootElm&&this.rootElm.find("input").attr("checked","checked"):(this.value=!1,this.rootElm&&this.rootElm.find("input").removeAttr("checked"));return a};j.prototype.dom_build=function(){var a=this,d=$("<div />");d.addClass("selectex parameter");d.append("<h6>"+this.label+"</h6>");var e=$("<input />");e.attr("type","checkbox");e.attr("title",label);this.value&&(e[0].checked="checked");e.change(function(){a.set(this.checked);"callback_change"in a&&a.callback_change.call(a,e[0].checked)});
d.append(e);this.rootElm=d;return a};j.prototype.__test=function(){e&&i.log("Overide Cparameter test ...")};j.prototype.__test=j.prototype.__test;h.export(d,j)})(window,graphit,console);(function(f,h,i,j){var e=h.import("lib/parameter"),d=h.import("lib/parameter/enum/type"),f=function(a){a.type=d.numeric;a.className="lib/parameter/numeric";a.autoSave="autoSave"in a&&!a.autoSave?!1:!0;e.call(this,a);return this};f.prototype=Object.create(e.prototype);f.prototype.constructor=new e;f.prototype.init=function(a){this.checks=Object({label:1,min:1,max:1,def:1,step:1});for(var d in this.checks){if(!(d in a)||a[d]===j)return i.error("Missing parameter key/value",a,d),null;this[d]="label"==
d?a[d]:parseFloat(a[d])}};f.prototype._get=function(a){return parseFloat(a)};f.prototype._set=function(a){return parseFloat(a)};f.prototype.dom_build=function(){var a=this,d=$("<div />");d.addClass("sliderex parameter "+this.label);d.attr("title",this.label);var e=$("<table />"),f=$("<tr />"),h=$("<td />");h.append("<h6>"+this.label+"</h6>");f.append(h);var i=$("<div />");i.addClass("slider");i.slider({min:this.min,max:this.max,value:this.value,step:this.step,slide:function(){var d=$(this),e=d.slider("option",
"value");a.set(e);d.parents(".sliderex").find("input.input").attr("value",e);"callback_slide"in a&&a.callback_slide.call(a,e)},change:function(){var d=$(this),e=d.slider("option","value");a.set(e);d.parents(".sliderex").find("input.input").attr("value",e);"callback_change"in a&&a.callback_change.call(a,e)}});h=$("<td />");h.append(i);f.append(h);i=$("<input />");i.addClass("input");i.attr("value",this.value);i.css("width: 2em");i.change(function(){var d=$(this),e=d.attr("value");d.parents(".sliderex").find(".slider").slider("option",
"value",e);a.set(e);"callback_change"in a&&a.callback_change.call(a,e)});i.spinner();h=$("<td />");h.append(i);f.append(h);e.append(f);d.append(e);this.rootElm=d;return this};h.export("lib/parameter/numeric",f)})(window,graphit,console);(function(f,h){h.export("lib/enum/loading",{none:1,loading:2,fail:3,ok:4})})(window,graphit,console);(function(f,h){h.export("lib/enum/cardinal",{nw:7,n:0,ne:1,w:6,e:2,sw:5,s:4,se:3})})(window,graphit,console);(function(f,h,i,j){function e(e){e=e||{};e.className=d;e.label=e.label||"image";a.call(this,e,"parent src width height title callback_click callback_success callback_error autoRelease".split(" "));this.options=e;this.data=null;this.status=k.none;this.errorMsg="";this.last_update=null;this.src||i.warn(this.className+" constructed without src argument");this.dom_get()}var d="lib/image",a=h.import("lib/object"),k=h.import("lib/enum/loading");e.prototype=Object.create(a.prototype);e.prototype.constructor=
new a;e.prototype.dom_build=function(){var a=this;if(this.rootElm&&!force)return i.warn("Image already loaded"),this;var d=$("<img />");d[0].onload=function(){return a.callback_onload.call(a)};d[0].onerror=function(){return a.callback_onerror.call(a)};d.click(function(){return a.callback_click.call(a)});"label"in this&&this.label!=j&&(d.attr("alt",this.label),d.attr("title",this.label));"width"in this&&this.width!=j&&d.attr("width",this.width);"height"in this&&this.height!=j&&d.attr("height",this.height);
"src"in this&&this.src&&d.attr("src",this.src);this.rootElm=d;return this};e.prototype.callback_onload=function(){this.status=k.ok;this.last_update=Date.now();if("replace_id"in this.options&&this.options.replace_id){var a=document.getElementById(this.options.replace_id);a?("label"in this.options&&a.setAttribute("alt"),a.width=this.data.width,a.height=this.data.height,a.src=this.data.src):(this.errorMsg="Replacing image failed",ret=!1)}return(a=this.callback_exists("success"))?a.call(this):!1};e.prototype.callback_onerror=
function(){this.status=k.fail;this.last_update=null;var a=this.callback_exists("error");return a?a.call(this):!1};e.prototype.callback_click=function(){var a=this.callback_exists("click");return a?a.call(this):!1};e.prototype.__test=function(){i.log("Overide Cobject.__test");return!0};e.prototype.__test=e.prototype.__test;h.export(d,e)})(window,graphit,console);(function(f,h,i){function j(a){a=a||{};a.className=e;a.size=a.size||22;a.type=a.type||"gimp";a.format=a.format||"png";a.label=a.label||"icon";a.path=a.path?"/"+a.path+"/":"/";a.name=a.name||"icon";a.src=this._build_src_path(a);d.call(this,a,["name","format","size","path"])}var e="lib/icon",d=h.import("lib/image");j.prototype=Object.create(d.prototype);j.prototype.constructor=new d;j.prototype._build_src_path=function(a){var d=f.graphit.baseStaticContent;a.name||this.exception("mandatory_parameter_missing",
"name",this);return d+"/images/"+a.type+a.path+a.name+"-"+a.size+"."+a.format};j.prototype.__test=function(){i.log("overide Cobject.__test");return!0};j.prototype.__test=j.prototype.__test;h.export(e,j)})(window,graphit,console);(function(f,h,i,j){function e(a){a=a||{};a.className="Module";a.label="color";"r"in a||(a.r=0);"g"in a||(a.g=0);"b"in a||(a.b=0);"a"in a||(a.a=0);d.call(this,a,["r","g","b","a","callback_change"])}var d=h.import("lib/object");e.prototype=Object.create(d.prototype);e.prototype.constructor=new d;e.prototype.to_rgba=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"};e.prototype.set_rgb=function(a){this.r=a.r;this.g=a.g;this.b=a.b;this.a=1;(callback=this.callback_exists("change"))&&
callback.call(this);return this};e.prototype.set=function(a,d){callback=this.callback_exists("change");if(a instanceof e)return this.r=a.r,this.g=a.g,this.b=a.b,this.a=a.a,callback&&callback.call(this),this;if(a&&d!=j){if(a in this)return this[a]=d,callback&&callback.call(this),this;this.exception("invalid_color_key",a)}this.exception("invalid_set_value",{key:a,value:d})};e.prototype.from_rgba=function(a){var d=RegExp(/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+(\.\d+)?)\s*\)$/).exec(a);if(!d)return i.error("Invalid rgba expression: "+
a),this;this.r=d[1];this.g=d[2];this.b=d[3];this.a=d[4];return this};e.prototype.inverse=function(){var a=1/255;this.r=Math.round(255*(1-this.r*a));this.g=Math.round(255*(1-this.g*a));this.b=Math.round(255*(1-this.b*a));return this};e.prototype.from_pixel=function(a,d){if(a==j||d==j)throw"invalid_argument";var e=d.y*4*a.width+4*d.x,f=a.data;this.r=f[e];this.g=f[e+1];this.b=f[e+2];this.a=f[e+3];this.a=Math.round(100*(this.a/255))/100;return this};e.prototype.clone=function(){return new e(this)};e.prototype.equal=
function(a,d){for(var e=d||["a","r","g","b"],f,h=0;h<e.length;h++)if(f=e[h],this[f]!=a[f])return!1;return!0};e.prototype.magnitude=function(){return Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b)};e.prototype.normalize=function(){var a=this.magnitude();this.r/=a;this.b/=b;this.g/=g;return this};e.prototype.to_s=function(){return this.className+"("+this.r+", "+this.g+", "+this.b+", "+this.a+")\n"};h.export("lib/color",e)})(window,graphit,console);(function(f,h,i,j){function e(a){a=a||{};a.className="Module";a.label="Module";d.call(this,a,["source_points","image_data"])}var d=h.import("lib/object"),a=h.import("lib/color");h.import("lib/enum/cardinal");e.prototype=Object.create(d.prototype);e.prototype.constructor=new d;e.prototype.get_cardinal_pixel=function(a,d,e){var f=d.x,d=d.y,h=a.width,i=h*a.height,p=[],a=function(a,d){var k=d*h+a;e[k]==j&&0<=k&&k<i&&p.push({x:a,y:d,index:k})};a(f,d-1);a(f+1,d-1);a(f+1,d);a(f+1,d+1);a(f,d+1);a(f-1,d+1);
a(f-1,d);a(f-1,d-1);return p};e.prototype.select_adjacent_pixel=function(a,d,e,f){a=this.get_cardinal_pixel(a,d,e);for(d=0;d<a.length;d++)f.call(this,a[d])};e.prototype.adjacent_by_color=function(d,e){for(var f=[],h=[],i=d.width*d.height,j=0;j<i;j++)f[j]=null;h.push({x:e.x,y:e.y,index:e.y*d.width+e.x});for(var p=0,i=0,r=(new a).from_pixel(d,e);0<h.length;)j=h.pop(),i++,this.select_adjacent_pixel(d,j,f,function(e){var i;i=(new a).from_pixel(d,e);i=r.equal(i,["r","g","b"])?!0:!1;i?(p++,f[e.index]=1,
h.push(e)):f[e.index]=0});return f};h.export("lib/image/analyse",e)})(window,graphit,console);(function(f,h){function i(d){d=d||{};d.className=j;d.label=d.label||"menu";d.type=d.type||"jquery";this.entries={};this.num_child=0;e.call(this,d,["type","parent","cssClass"])}var j="lib/menu",e=h.import("lib/object");i.prototype=Object.create(e.prototype);i.prototype.constructor=new e;i.prototype.init=function(d){for(var a in d.entries)d.entries[a].parent=this,d.entries[a].type=this.type,this.add(new i(d.entries[a]))};i.prototype.exists=function(d){return d.label in this.entries?!0:!1};i.prototype.add=
function(d){(!d||!(d instanceof i))&&this.exception("invalid_menu_entry",d);this.exists(d)&&this.exception("label_already_present",d.label);this.entries[d.label]=d;this.num_child++};i.prototype.dom_build=function(){var d;d=parent in this&&this.parent instanceof i?this.parent.rootElm:$("<ul />");for(var a in this.entries){var e=this.entries[a],f=$('<a href="#" title=""/>');f.attr("label",a);"click"in e.callback&&e.install_callback(f);var h=$("<li />"),m=$("<span>"+a+"</span>");m.addClass("menu-entry");
this.cssClass&&m.addClass(this.cssClass);f.append(m);h.append(f);e.has_child()&&(e=e.dom_get({noHeader:!0}),h.append(e));d.append(h)}if("jquery"==this.type&&(!this.parent||!(this.parent instanceof i)))d.menu({role:"listbox"}),d.menu("enable");if(!this.parent||!(this.parent instanceof i))a=$("<div />"),a.append(d),d=a;this.rootElm=d;return this};i.prototype.has_child=function(){return 0<this.num_child?!0:!1};i.prototype.install_callback=function(d){var a=this;d.click(function(){a.callback.click()})};
i.prototype.count_childs=function(){var d=0;for(c in this.entries)d++;return d};h.export(j,i)})(window,graphit,console);(function(f,h,i,j){function e(e){e=e||{};e.className=d;e.label="canvas";a.call(this,e,["width","height","bg_color","src"]);this.bg_color=this.bg_color||new k;(!this.width||0>this.width||1920<this.width)&&this.exception("invalid_width",this.width);(!this.height||0>this.height||1280<this.height)&&this.exception("invalid_height",this.height);this.data=document.createElement("canvas");this.data.setAttribute("width",this.width);this.data.setAttribute("height",this.height);this.ctx=this.data.getContext("2d");
this.clear(this.bg_color);this.src&&this.load(this.src)}var d="lib/canvas",a=h.import("lib/object"),k=h.import("lib/color");e.prototype=Object.create(a.prototype);e.prototype.constructor=new a;e.prototype.clone=function(){var a=new e({width:this.width,height:this.height,bg_color:this.bg_color});a.copy({src:this});return a};e.prototype.get_width=function(){return this.data.width};e.prototype.get_height=function(){return this.data.height};e.prototype.getImageData=function(a,d,e,f){return this.data.getContext("2d").getImageData(a,
d,e,f)};e.prototype.copy=function(a){!a.src&&(!(a.src instanceof e)||!(a.src instanceof Cimage))&&this.exception("invalid_copy_source");var d=null,f,k,h,p=null;f=this.get_width();k=this.get_height();a.src instanceof e?(d=a.src.data,h=a.src.get_width(),p=a.src.get_height()):(d=a.src,h=d.width,p=d.height,i.log("sw, dw",h,p));a.resize=a.resize!=j?a.resize:!1;var r=this.data.getContext("2d");r.save();"undefined"!=a.resize&&a.resize?r.drawImage(d,0,0,h,p,0,0,f,k):a.keepRatio?(d=this.data.width,k=a.src.get_width()/
a.src.get_height()/d,k*=this.data.height,r.drawImage(a.src.data,0,0,a.src.get_width(),a.src.get_height(),0,0,d,k)):(a=h>f?f:h,p=p>k?k:p,f=f>a?(f-a)/2:0,k=k>p?(k-p)/2:0,f=k=0,r.drawImage(d,0,0,a,p,f,k,a,p));r.restore()};e.prototype.get_pixel_color=function(a,d,e,f){return a.data[d*4*a.width+4*e+f]};e.prototype.getCanvas=function(){return this.data};a.prototype.getContext=function(a){a=a||"2d";if("data"in this)return this.data.getContext(a);i.error("Cannot return context for this object... no cCanvas");
return null};e.prototype.clear=function(a){var a=a||new k,d=this.getContext();0==a.a?d.clearRect(0,0,this.data.width,this.data.height):(d.save(),d.fillStyle=a.to_rgba(),d.fillRect(0,0,this.data.width,this.data.height),d.restore())};e.prototype.save=function(){var a=this.data.toDataURL("image/png");f.open(a)||(document.location.href=a)};e.prototype.load=function(a){var d=this;this.image_loading=new Cimage({src:a,callback_onload:function(){i.log("Image loaded",this);var a=cMath.clamp(1,this.rootElm.width,
d.data.width),e=cMath.clamp(1,this.rootElm.height,d.data.height);d.data.getContext("2d").drawImage(this.rootElm,0,0,a,e);d.image_loading=null},callback_onerror:function(){i.log("Failed to load image",this);d.image_loading=null}})};e.prototype.dom_build=function(){this.rootElm=this.data;return this};h.export(d,e)})(window,graphit,console);(function(f,h,i){function j(d){d=d||{};d.className="Module";d.label="Module";d.position=d.position||new Cpoint({x:0,y:0});d.width=d.width||0;d.height=d.height||0;e.call(this,d,["position","width","height"])}var e=h.import("lib/object");j.prototype=Object.create(e.prototype);j.prototype.constructor=new e;j.prototype.add_point=function(d){var a=d.x-this.position.x;a>this.width&&(this.width=a);d=d.y-this.position.y;d>this.height&&(this.height=d);i.log("Bounding",this)};h.export("lib/bounding/rectangle",
j)})(window,graphit,console);(function(f,h,i,j){f=function(e){if(e!=j&&(!("x"in e)||!("y"in e)))throw new Cexception_message({className:"lib/math/point2d",error:"invalid_component",additional:e});e=e||{x:0,y:0};Object.defineProperty(this,"x",{value:e.x,writable:!0,enumerable:!0,configurable:!1});Object.defineProperty(this,"y",{value:e.y,writable:!0,enumerable:!0,configurable:!1})};f.prototype.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y)};h.export("lib/math/point2d",f)})(window,graphit,console);(function(f,h){function i(d){this.className=j;e.call(this,d)}var j="lib/math/vector2d",e=h.import("lib/math/point2d");i.prototype=Object.create(e.prototype);i.prototype.constructor=new e;i.prototype.magnitude=function(){return 0==this.x&&0==this.y?0:Math.sqrt(this.x*this.x+this.y*this.y)};i.prototype.normalize=function(){var d=this.magnitude();if(0==d)return this;this.x/=d;this.y/=d;return this};i.prototype.from_point=function(d,a){this.x=a.x-d.x;this.y=a.y-d.y;return this};i.prototype.smul=function(d){this.x*=
d;this.y*=d;return this};i.prototype.vadd=function(d){this.x+=d.x;this.y+=d.y;return this};i.prototype.clone=function(){return new i(this)};h.export(j,i)})(window,graphit,console);(function(f,h,i,j){var e=function(d){this.className="lib/math/matrix33";m11=0;m12=1;m13=2;m21=3;m22=4;m23=5;m31=6;m32=7;m33=8;this.data=[];d=d!=j?d:[1,0,0,0,1,0,0,0,1];this.set(d)};e.prototype.init=function(){};e.prototype.clone=function(){return new e(this)};e.prototype._is_valid_array=function(d){return 9==d.length?!0:!1};e.prototype.translate=function(d){d=new e([1,0,0,0,1,0,d.x,d.y,1]);this.mul(d);return this};e.prototype.scale=function(d){d=new e([d.x,0,0,0,d.y,0,0,0,1]);this.mul(d);return this};
e.prototype.rotate=function(d){var a=Math.cos(d),d=Math.sin(d),a=new e([a,d,0,-d,a,0,0,0,1]);this.mul(a);return this};e.prototype.set=function(d){i.log(d);if(d==j)return this;if(d instanceof Array){if(!this._is_valid_array(d))throw"matrix33_invalid_array";for(var a=0;a<=m33;a++)this.data[a]=d[a]}else if(d instanceof e)for(a=0;a<=m33;a++)this.data[a]=d.data[a];else if("number"==typeof d){d=parseFloat(d);for(a=0;a<=m33;a++)this.data[a]=d}else throw"matrix33_invalid_value";return this};e.prototype.add=
function(d){if(!d)return this;if(d instanceof Array){if(!this._is_valid_array(d))throw"matrix33_invalid_array";for(var a=0;a<=m33;a++)this.data[a]+=d[a]}else if(d instanceof e)for(a=0;a<=m33;a++)this.data[a]+=d.data[a];else if("number"==typeof d){d=parseFloat(d);for(a=0;a<=m33;a++)this.data[a]+=d}else throw"matrix33_invalid_value";return this};e.prototype.round=function(){for(var d=0;d<=m33;d++)this.data[d]=Math.round(this.data[d]);return this};e.prototype.floor=function(){for(var d=0;d<=m33;d++)this.data[d]=
Math.floor(this.data[d]);return this};e.prototype.random=function(d){for(var d=d||1,a=0;a<=m33;a++)this.data[a]=Math.random(d);return this};e.prototype.identity=function(){this.data=[1,0,0,0,1,0,0,0,1];return this};e.prototype.mul=function(d){i.log(d);if(!d)return this;if(d instanceof e||d instanceof Array&&9==d.length){var a=this.data,f=[],h=null,h=d instanceof e?d.data:d;i.log(a,h);f[m11]=a[m11]*h[m11]+a[m12]*h[m21]+a[m13]*h[m31];f[m12]=a[m11]*h[m12]+a[m12]*h[m22]+a[m13]*h[m32];f[m13]=a[m11]*h[m13]+
a[m12]*h[m23]+a[m13]*h[m33];f[m21]=a[m21]*h[m11]+a[m22]*h[m21]+a[m23]*h[m31];f[m22]=a[m21]*h[m12]+a[m22]*h[m22]+a[m23]*h[m32];f[m23]=a[m21]*h[m13]+a[m22]*h[m23]+a[m23]*h[m33];f[m31]=a[m31]*h[m11]+a[m32]*h[m21]+a[m33]*h[m31];f[m32]=a[m31]*h[m12]+a[m32]*h[m22]+a[m33]*h[m32];f[m33]=a[m31]*h[m13]+a[m32]*h[m23]+a[m33]*h[m33];i.log("m",f);this.data=f}else if("number"==typeof d){i.log(typeof d);d=parseFloat(d);for(a=0;a<=m33;a++)this.data[a]*=d}else throw"matrix33_invalid_value";return this};e.prototype.minor=
function(){var d=[],a=this.data;d[m11]=a[m22]*a[m33]-a[m32]*a[m23];d[m12]=a[m21]*a[m33]-a[m31]*a[m23];d[m13]=a[m21]*a[m32]-a[m31]*a[m22];d[m21]=a[m12]*a[m33]-a[m32]*a[m13];d[m22]=a[m11]*a[m33]-a[m31]*a[m13];d[m23]=a[m11]*a[m32]-a[m31]*a[m12];d[m31]=a[m12]*a[m23]-a[m22]*a[m13];d[m32]=a[m11]*a[m23]-a[m21]*a[m13];d[m33]=a[m11]*a[m22]-a[m21]*a[m12];this.data=d;return this};e.prototype.to_s=function(d){var a="\n";d&&("format"in d&&"html"==d.format)&&(a="<br>\n");for(var d="Module"+a+" ",e=0;e<=m33;e++)d+=
this.data[e]+",",0==(e+1)%3&&(d+=a+" ");return d};h.export("lib/math/matrix33",e)})(window,graphit,console);(function(){var f=graphit.import("lib/math/vector2d"),h=graphit.import("lib/math/point2d");graphit.export("lib/math",{className:"lib/math",distance:function(f,h){var e=h.x-f.x,d=h.y-f.y;return Math.sqrt(e*e)+d*d},isint:function(f){return"number"===typeof f&&0==f%1},linear_interpolation:function(i,j,e){var e=1,d=[],a=new f;a.from_point(i,j);var k=a.magnitude();if(0==k)return d;a.normalize();var l=i.clone();a.smul(e);d.push(i);for(i=0;i<=k;i+=e)l.vadd(a),d.push(new h(l));d.push(j);return d},clamp:function(f,
h,e){return f<h?h:f>e?e:f}})})(window,graphit,console);(function(f,h){function i(f){f=f||{};f.className=j;f.label=j;e.call(this,f,[]);this.matrix=new d;this.matrix.identity();this.position=new a;this.u=new a;this.v=new a}var j="lib/transform/2d",e=h.import("lib/object"),d=h.import("lib/math/matrix33"),a=h.import("lib/math/vector2d");i.prototype=Object.create(e.prototype);i.prototype.constructor=new e;i.prototype.translate=function(a){(!("x"in a)||!1 in a)&&this.exception("camel_camouflage_failed");this.matrix.translate(a)};i.prototype.rotate=function(a){(!("x"in
a)||!1 in a)&&this.exception("camel_camouflage_failed");this.matrix.translate(a)};i.prototype.translate=function(a){a||this.exception("camel_camouflage_failed");this.matrix.translate(point)};h.export(j,i)})(window,graphit,console);(function(f,h,i,j){function e(a,d){this.min=a;this.max=d;this.last=null}function d(a){l.call(this,a);this.time=Date.now()}function a(a){a.className="Module";a.label="mousetracker";k.call(this,a,["parent","callback_move","callback_track"]);this.y=this.x=0;this.cMinmaxX=new e(0,this.parent.width);this.cMinmaxY=new e(0,this.parent.height);this.minmax=Object({minx:0,maxx:this.parent.width,miny:0,maxy:this.parent.height});this.minx=this.minmax.maxx;this.maxx=0;this.miny=this.minmax.maxy;this.maxy=0;this.pushed=
null;this.paused=!1;this.interval=null;this.points=[];this.rootElm=null;return this}var k=h.import("lib/object"),l=h.import("lib/math/vector2d"),q=h.import("lib/math");e.prototype.init=function(a){this.min=this.max=this.last=a};e.prototype.cmp=function(a){if(a==j)return i.warn("MinMax: Comparing with null value"),!1;a<this.min&&(this.min=a);a>max&&(this.max=a);this.last=a;return!0};d.prototype=Object.create(l.prototype);d.prototype.constructor=new l({x:0,y:0});a.prototype=Object.create(k.prototype);
a.prototype.constructor=new k;a.prototype.reset=function(){this.minx=this.minmax.maxx;this.maxx=0;this.miny=this.minmax.maxy;this.maxy=0;this.points=[]};a.prototype.move=function(a,d){a=q.clamp(Math.round(a),this.minmax.minx,this.minmax.maxx);d=q.clamp(Math.round(d),this.minmax.miny,this.minmax.maxy);this.x=a;this.y=d;var e=this.callback_exists("track");e&&e.call(this,a,d);return this};a.prototype.push=function(){this.pushed=Date.now();var a=this;this.interval=setInterval(function(){if(!a.is_pushed())return clearInterval(a.interval),
null;if(this.paused)return null;var e=new d(a);a.points.push(e);a.minx=Math.min(a.minx,e.x);a.maxx=Math.max(a.maxx,e.x);a.miny=Math.min(a.miny,e.y);a.maxy=Math.max(a.maxy,e.y)},1E3/120);this.func_push&&this.func_push(this)};a.prototype.dom_build=function(){var a=$("<div />");a.attr("title","Mouse tracker");a.addClass("mousetracker");var d=document.createElement("div"),d=$(d);d.addClass("ui-widget-content");d.append('<div class="hold-var"><h6>x:&nbsp;</h6><span class="var-x">'+this.x+"</span></div>");
d.append('<div class="hold-var"><h6>y:&nbsp;</h6><span class="var-y">'+this.y+"</span></div>");a.append(d);this.rootElm=a;return this};a.prototype.release=function(){this.pushed=null;this.func_release&&this.func_release(this);this.reset()};a.prototype.is_pushed=function(){return this.pushed};a.prototype.to_s=function(){return"Module: "+this.x+" / "+this.y};h.export("lib/mouse/tracker",a)})(window,graphit,console);(function(f,h){h.export("app/enum/compositeOperation",{"source-over":"source-over","source-in":"source-in","source-out":"source-out","source-atop":"source-atop",lighter:"lighter",xor:"xor","destination-over":"destination-over","destination-in":"destination-in","destination-out":"destination-out","destination-atop":"destination-atop",darker:"darker"})})(window,graphit,console);(function(f,h,i){var j=h.import("lib/object"),e=h.import("lib/icon"),d=h.import("lib/canvas"),a=new (h.import("lib/po")),f=function(a){var d=this,a=a||{};a.className="app/tool";a.label=a.label||"tool";this.cCanvas=this.brush=null;this.need_update=!0;this.optElm=this.rootElm=null;this.changeCursor=!0;for(var e in a.parameters)a.parameters[e].parent=this;j.call(this,a,"parent brush label _pregraph _graph _postgraph _update compositeOperation".split(" "));for(e in this.parameters)this.bind_trigger(this.parameters[e],
"update",function(){d.update()});return this};f.prototype=Object.create(j.prototype);f.prototype.constructor=new j;f.prototype.canvas_create=function(a,d){if(!a||0>a||1920<a)return i.error("Width not in range",a),null;if(!d||0>d||1080<d)return i.error("Height not in range",d),null;this.set_parameter("width",a);this.set_parameter("height",d)};f.prototype.set_options=function(a){if(!a.brush)return i.error("No brush in Module options"),!1};f.prototype.update=function(){this.need_update=!0;if(!this.need_update)return i.log("Doesn't need update"),
!1;var a=this.get_parameter("size");a||this.exception("no_size_parameter",this.label);this.cCanvas=new d({width:a,height:a});this.ctx=this.cCanvas.getContext("2d");a=this.parent.brush_manager.selected.cCanvas.data;this.ctx.drawImage(a,0,0,a.width,a.height,0,0,this.cCanvas.get_width(),this.cCanvas.get_height());this.need_update=!1;this.send_trigger("update")};f.prototype.drawImage=function(a,d,e){var f=a.getContext("2d"),h=this.cCanvas.canvas;if(!f)return i.error("Cannot acquire context"),!1;if(d>
a.width||0>d)return i.error("x not in canvas destination range",d),!1;if(e>a.height||0>e)return i.error("y not in canvas destination range",e),!1;f.drawImage(h,0,0,h.width,h.height,d,e,h.width,h.height);return!0};f.prototype.onclick=function(){"callback_onclick"in this.options&&"function"===typeof this.options.callback_onclick&&this.options.callback_onclick(this)};f.prototype.dom_build=function(a){if(this.rootElm&&!a)return this;a=$("<div />");a.append(this.dom_build_tool());this.rootElm=a;return this};
f.prototype.dom_build_tool=function(){var d=this,f=new e({path:"tools",name:"stock-tool-"+this.label,callback_click:function(){d.send_trigger("tool_selected",d)},label:a.get("tool_"+this.label)});return $(f.dom_get().addClass("group tool"))};f.prototype.dom_build_options=function(){if(this.optElm)return this.optElm;var a=$(document.createElement("div"));a.addClass("not-draggable");for(var d in this.parameters)a.append(this.parameters[d].dom_get());return this.optElm=a};f.prototype.callback_click=
function(){this.parent&&this.parent.select_tool(this)};f.prototype.graph=function(){this.exceptions("method_must_be_overidden")};f.prototype.pre_graph=function(){};f.prototype.post_graph=function(){};h.export("app/tool",f)})(window,graphit,console);(function(f,h){function i(a){a=a||{};a.className=j;a.label="pencil";a.parameters={size:{label:"size",min:1,max:100,def:20,step:1},opacity:{label:"opacity",min:0,max:1,def:1,step:0.01},linecap:{type:d.select,label:"linecap",choices:{round:"round",butt:"butt",square:"square"},def:"round"}};e.call(this,a,[])}var j="app/tool/pencil",e=h.import("app/tool"),d=h.import("lib/parameter/enum/type");i.prototype=Object.create(e.prototype);i.prototype.constructor=new e;i.prototype.graph=function(a){var d=a.cSurface.layer_manager.special_layers.prefrag.cCanvas.data.getContext("2d");
d.save();d.lineWidth=Math.round(this.parameters.size.value);var e=a.fgColor.color.clone();e.a=this.parameters.opacity.value;d.strokeStyle=e.to_rgba();d.lineCap=this.parameters.linecap.value;d.beginPath();d.moveTo(a.A.x,a.A.y);d.lineTo(a.B.x,a.B.y);d.stroke();d.closePath();d.restore();return!0};h.export(j,i)})(window,graphit,console);(function(f,h){function i(a){a=a||{};a.className=j;a.label="paintbrush";a.parameters={size:{label:"size",min:1,max:100,def:20,step:1},opacity:{label:"opacity",min:0,max:1,def:1,step:0.01},pression:{label:"pression",min:0.1,max:100,def:100,step:0.01}};e.call(this,a,[])}var j="app/tool/paintbrush",e=h.import("app/tool"),d=h.import("lib/math");i.prototype=Object.create(e.prototype);i.prototype.constructor=new e;i.prototype.graph=function(a){var e=a.cSurface.layer_manager.special_layers.prefrag.cCanvas.data.getContext("2d"),
f=this.cCanvas.data,h=f.width/2,i=f.height/2,j=this.get_parameter("pression"),a=d.linear_interpolation(a.A,a.B,100/j);if(0>=a.length)return!1;for(j=0;j<a.length;j++)e.save(),a[j].round(),e.translate(a[j].x-h,a[j].y-i),e.drawImage(f,0,0,f.width,f.height),e.restore();return!0};h.export(j,i)})(window,graphit,console);(function(f,h){function i(a){a=a||{};a.className=j;a.label="eraser";a.compositeOperation=d.xor;a.parameters={size:{label:"size",min:1,max:100,def:20,step:1},pression:{label:"pression",min:0.1,max:100,def:100,step:0.01}};e.call(this,a,[])}var j="app/tool/eraser",e=h.import("app/tool"),d=h.import("app/enum/compositeOperation"),a=h.import("lib/math");i.prototype=Object.create(e.prototype);i.prototype.constructor=new e;i.prototype.pre_graph=function(a){var d=a.cSurface.layer_manager.special_layers.prefrag.cCanvas.data.getContext("2d"),
a=a.cSurface.layer_manager,e;a.special_layers.stack_down&&(e=a.special_layers.stack_down.cCanvas.data,d.drawImage(e,0,0,e.width,e.height));e=a.selected.cCanvas.data;d.drawImage(e,0,0,e.width,e.height)};i.prototype.post_graph=function(a,d,e,f,h){var i=a.cSurface.layer_manager.selected,a=a.cSurface.layer_manager.special_layers.prefrag,j=a.clone(),r=j.cCanvas.getContext("2d");r.save();r.clearRect(0,0,j.cCanvas.data.width,j.cCanvas.data.height);r.globalCompositeOption="xor";r.drawImage(a.cCanvas.data,
0,0,a.cCanvas.data.width,a.cCanvas.data.height);i.drawImage(j.cCanvas.data,d,e,f,h,0,0,"source-in");r.restore()};i.prototype.graph=function(e){var f=e.cSurface.layer_manager.special_layers.prefrag.cCanvas.data.getContext("2d");e.cSurface.layer_manager.special_layers.prefrag.down_composite_operation=d["source-in"];f.globalCompositeOperation=d["destination-out"];for(var h=this.cCanvas.data,i=h.width/2,j=h.height/2,n=this.get_parameter("pression")||100,e=a.linear_interpolation(e.A,e.B,100/n),n=0;n<e.length;n++)f.save(),
f.translate(e[n].x-i,e[n].y-j),f.drawImage(h,0,0,h.width,h.height),f.restore();f.restore();return!0};h.export(j,i)})(window,graphit,console);(function(f,h,i){function j(a){a=a||{};a.className=e;a.label="bucket-fill";a.parameters={size:{label:"size",min:1,max:100,def:20,step:1}};d.call(this,a,[])}var e="app/tool/fill",d=h.import("app/tool"),a=h.import("lib/image/analyse");j.prototype=Object.create(d.prototype);j.prototype.constructor=new d;j.prototype.graph=function(d){var e=d.cSurface.layer_manager.special_layers.prefrag.cCanvas.data.getContext("2d"),f=d.cSurface.layer_manager.get();if(!f)return i.error("No layer selected"),!1;for(var f=
f.getImageData(0,0,f.get_width(),f.get_height()),h=(new a).adjacent_by_color(f,d.A),j=d.cToolbox.fg_color.color,n=0;n<h.length;n++)if(1==h[n]){var p=4*n;f.data[p]=j.r;f.data[p+1]=j.g;f.data[p+2]=j.b;f.data[p+3]=255}d.cMouse.minx=0;d.cMouse.miny=0;d.cMouse.maxx=f.width;d.cMouse.maxy=f.height;e.putImageData(f,0,0);d.cGrapher.stop();return!0};h.export(e,j)})(window,graphit,console);(function(f,h,i){function j(f){f=f||{};f.className=e;f.label="color-picker";f.compositeOperation=a.xor;f.parameters={size:{label:"size",min:1,max:100,def:20,step:1}};d.call(this,f,[])}var e="app/tool/colorPicker",d=h.import("app/tool"),a=h.import("app/enum/compositeOperation"),k=h.import("lib/color");j.prototype=Object.create(d.prototype);j.prototype.constructor=new d;j.prototype.graph=function(a){var d=a.cSurface.layer_manager.get();d||this.exception("no_layer_selected");d=d.getImageData(0,0,d.get_width(),
d.get_height());d=(new k).from_pixel(d,a.A);i.log("Selected color",d.to_s());a.cToolbox.fg_color.color.set(d);a.cGrapher.stop();return!0};h.export(e,j)})(window,graphit,console);(function(f,h,i){function j(d){d=d||{};d.className="graphit/message";d.label="message";a.call(this,d,"cSurface cMouse cTool cToolbox points fgColor bgColor cGrapher index".split(" "))}function e(e){e=e||{};e.className=d;e.label="grapher";a.call(this,e,["parent"])}var d="app/grapher",a=h.import("lib/object");j.prototype=Object.create(a.prototype);j.prototype.constructor=new a;h.export("graphit/message",j);e.prototype=Object.create(a.prototype);e.prototype.constructor=new a;e.prototype.init=function(){this.parent||
this.exception("no_parent_argument");this.reset_index();this.timer=null;this.mode=1};e.prototype.reset_index=function(){this.index=0};e.prototype._graph=function(a){var d=a.points.length;if(2>=d||this.index>=d-1)return!1;d=a.points[this.index+1];a.A=a.points[this.index];a.B=d;a.index=this.index;if(a.cTool.graph(a)&&(!this.last_redraw||Date.now()-this.last_redraw>1E3/60))this.last_redraw=Date.now(),a.cSurface.redraw(!0);this.index++};e.prototype.stop=function(){var a=h.import("app/layer");try{if(!this.timer)return i.warn("Grapher is not started"),
!1;clearInterval(this.timer);this.timer=null;var d=this.parent.selected,e=d.cMouse,f=d.layer_manager.selected,s=d.layer_manager.special_layers.prefrag,n=f.cCanvas.data,p=this.parent.cToolbox.selected,r=this.parent.cToolbox.selected.parameters.size.value,x=r/2,u=e.maxx-e.minx+r,v=e.maxy-e.miny+r,t=e.minx-x;0>t&&(t=0);t+u>n.width&&(u=n.width-t);var w=e.miny-x;0>w&&(w=0);w+v>n.height&&(v=n.height-w);var z=new j({cSurface:d,cMouse:d.cMouse});p.post_graph(z,t,w,u,v,0,0,u,v)||f.drawImage(s.cCanvas.data,
t,w,u,v,0,0);d.layer_manager.special_layers.prefrag=new a({parent:d.layer_manager,label:"_prefrag",width:d.get_width(),height:d.get_height()});this.index=0;return!0}catch(A){return i.error(A),!1}};e.prototype.start=function(){if(this.timer)return i.error("Grapher already started"),!1;var a=this;if(!this.parent.cToolbox||!this.parent.cToolbox.selected)return this.send_trigger("error","no-tool-selectionned"),i.error("No tool selectionned!"),!1;var d=this.parent,e=new j({cSurface:d.selected,cMouse:d.selected.cMouse,
cTool:d.cToolbox.selected,cToolbox:d.cToolbox,points:d.selected.cMouse.points,fgColor:d.cToolbox.fg_color,bgColor:d.cToolbox.bg_color,cGrapher:this,index:this.index});e.cTool.pre_graph(e);this.timer=f.setInterval(function(){a._graph(e)},5);return!0};e.prototype.__test=function(){i.log("Overide Cobject.__test");return!0};e.prototype.__test=e.prototype.__test;h.export(d,e)})(window,graphit,console);(function(f,h,i){function j(){this.className=e;this.logo=f.graphit.baseStaticContent+"images/badge-gplv3-32.png";this.text="license-gpl3.txt";this.rootElm=null;this.dialog_options={width:400}}var e="app/license";j.prototype.dom_build=function(){if(this.rootElm)return this;var d=$('<div title="License"/>');d.addClass("about ");var a=$("<div />");a.addClass("group-license");var e=$("<img />");e[0].src=this.logo;a.append(e);a.append('<p>Source code: <a href="#code" onclick="window.open(\'http://github.com/shojs/graphit/\'); return false;">github</a></p>');
a.append('<p>Documentation: <a href="#doc" onclick="window.open(\'http://github.com/shojs/graphit/wiki\');return false;">Wiki</a></p>');a.append('<p><img src="'+f.graphit.baseStaticContent+'images/gimp/stock-wilber-eek-64.png">&nbsp;All icons comes from the <a href="http://www.gimp.org">Gimp</a> project.</p>');a.append("<h6>License</h6>");e=$("<p />");e.addClass("text");e.append("                    GNU GENERAL PUBLIC LICENSE                       Version 3, 29 June 2007\n\n Copyright (C) 2007 Free Software Foundation, Inc. <http://fsf.org/> Everyone is permitted to copy and distribute verbatim copies of this license document, but changing it is not allowed.");
a.append(e);try{e.load(this.text)}catch(h){throw i.error("Cannot load full license",h),h;}e=document.createElement("button");$(e).append("Close");$(e).button();$(e).click(function(){d.dialog("close")});a.append(e);d.append(a);this.rootElm=d;return this};j.prototype.dom_get=function(){return this.dom_build().rootElm};h.export(e,j)})(window,graphit,console);(function(f,h,i){function j(f){f.className=e;f.label="frag";d.call(this,f,["parent","position","width","height","color"]);this.color||(this.color=new a);this.cCanvas=new k({width:this.width,height:this.height,bg_color:this.color});(!this.position||!(this.position instanceof l))&&this.exception("invalid_position")}var e="app/frag",d=h.import("lib/object"),a=h.import("lib/color"),k=h.import("lib/canvas"),l=h.import("lib/math/vector2d");j.prototype=Object.create(d.prototype);j.prototype.constructor=
new d;j.prototype.drawImage=function(a,d,e,f,h){var j=this.cCanvas.data,k=this.cCanvas.data.getContext("2d");try{k.drawImage(a,d,e,f,h,0,0,j.width,j.height)}catch(l){return i.error("Cannot draw to fragment",l),!1}return!0};h.export(e,j)})(window,graphit,console);(function(f,h,i,j){function e(e){e=e||{};e.className=d;e.label=e.label||"layer";e.position=e.position||new k({x:0,y:0});e.composite_operation=e.composite_operation||l["source-over"];e.visible=e.visible!=j?e.visible:!1;e.need_redraw=!0;a.call(this,e,"parent width height composite_operation need_redraw visible".split(" "))}var d="app/layer",a=h.import("lib/object"),k=h.import("lib/math/vector2d"),l=h.import("app/enum/compositeOperation"),q=h.import("lib/canvas"),m=h.import("lib/icon"),s=h.import("lib/image"),
n=h.import("app/frag");e.prototype=Object.create(a.prototype);e.prototype.constructor=new a;e.prototype.init=function(){var a=this;if(!this.width||0>this.width||1920<this.width)i.error("gabou",this),this.exception("invalid_width",this.width);(!this.height||0>this.height||1280<this.height)&&this.exception("invalid_height",this.height);this.frags=[];this.cCanvas=new q({width:this.width,height:this.height});this.bind_trigger(this,"redraw_preview",function(d){4<f.graphit.debug&&i.debug("[Trigger/received]",
d.type);a.redraw_preview()})};e.prototype.get_width=function(){return this.cCanvas.get_width()};e.prototype.get_height=function(){return this.cCanvas.get_height()};e.prototype.getImageData=function(a,d,e,f){return this.cCanvas.getImageData(a,d,e,f)};e.prototype.clone=function(){var a=this.cCanvas.data,d=new e({parent:this.parent,label:this.label,composite_operation:this.composite_operation,width:this.width,height:this.height});d.visible=this.visible;d.cCanvas.getContext().drawImage(a,0,0,a.width,
a.height);d.need_redraw=!1;d.rootElm=this.rootElm;return d};e.prototype.discard_frag=function(){this.need_redraw=!0;return this.frags.pop()};e.prototype.dom_get=function(){this.dom_build();return this.rootElm};e.prototype.set_visibility=function(a){this.visibility=a?!0:!1};e.prototype.toggle_visibility=function(){return!0==this.visibility?this.set_visibility(!1):this.set_visibility(!0)};e.prototype.dom_build=function(){if(this.rootElm)return this;var a=this,d=document.createElement("li"),e=$(d);e.attr("id",
this.uid);e.addClass("layer");d=$("<div/>");d.attr("id",this.uid);var h=$("<ul />");h.append('<li><a href="#'+this.guid(1)+'">layer</a></li>');h.append('<li><a href="#'+this.guid(2)+'">option</a></li>');h.append('<li><a href="#'+this.guid(3)+'">stats</a></li>');d.append(h);var h=$('<div id="'+this.guid(1)+'"/>'),j=new m({name:"stock-eye",size:20,callback_click:function(){a.toggle_visibility();a.send_trigger("update")}}),k=document.createElement("table"),k=$(k),q=$(document.createElement("tr")),l=
$(document.createElement("td"));l.append(j.dom_get());q.append(l);l=$(document.createElement("td"));j="<span>Layer - "+this.label+"</span>";l.css("width","100px");l.css("text-overflow","ellipsis");l.append(j);l.editInPlace({callback:function(d,e){return a.label=e}});l.addClass("label");q.append(l);l=$(document.createElement("td"));l.addClass("preview");this.canvas_preview=j=document.createElement("canvas");var n=100*(this.cCanvas.data.height/this.cCanvas.data.width);j.width=100;j.height=n;j=$(j);
l.click(function(){$(this).parents(".group-layers").find(".layer").removeClass("selected");$(this).parents(".layer").addClass("selected");a.parent.select(a)});l.append(j);q.append(l);l=$(document.createElement("td"));j=f.graphit.baseStaticContent+"/";n=new m({name:"stock-gravity-north",size:24,width:16,height:16,callback_click:function(){a.parent.move_up(a.uid)}});l.append(n.dom_get());n=new m({name:"stock-gravity-south",size:24,width:16,height:16,callback_click:function(){a.parent.move_down(a.uid)}});
l.append(n.dom_get());j=new s({src:j+"images/16x16_trash.png",width:16,height:16,callback_click:function(){$(this).parents("li.layer")?(e.remove(),a.parent.remove(a)):i.error("Cannot remove layer element")}});q.append(l);l=$(document.createElement("td"));l.addClass("options");l.append(j.dom_get());q.append(l);k.append(q);h.append(k);d.append(h);h=$('<div id="'+this.guid(2)+'"/>');h.append("<p>Layer option</p>");d.append(h);var y=$('<div id="'+this.guid(3)+'"/>');y.append('<p>Total fragment: <span id="'+
this.guid("total-fragment")+'">'+this.frags.length+"</span></p>");this.bind_trigger(this,"redraw_preview",function(){y.find("span").empty().append(a.frags.length)});d.append(y);e.append(d);d.tabs();this.rootElm=e;return this};e.prototype.redraw_preview=function(){var a=this.canvas_preview.getContext("2d"),d=this.cCanvas.data;a.clearRect(0,0,d.width,d.height);a.drawImage(d,0,0,d.width,d.height,0,0,this.canvas_preview.width,this.canvas_preview.height)};e.prototype.redraw=function(a){"boolean"===typeof a&&
(this.need_redraw=a);if(!this.need_redraw)return!1;a=this.cCanvas.getContext();a.clearRect(0,0,this.cCanvas.data.width,this.cCanvas.data.height);"compositeOperation"in this&&(a.compositeOperation=this.compositeOperation);for(var d=this.cCanvas.data.width,e=this.cCanvas.data.height,f=0;f<this.frags.length;f++){var h=this.frags[f],i=h.cCanvas.data,j=i.height,k=i.width,m=h.position.x;0>m?m=0:m+k>d&&(k=d-m);var q=h.position.y;0>q?q=0:q+j>e&&(j=e-q);a.save();a.beginPath();a.rect(m,q,k,j);a.clip();a.globalCompositeOperation=
h.downCompositeOperation?h.downCompositeOperation:"source-over";a.drawImage(i,0,0,k,j,m,q,k,j);a.restore()}this.send_trigger("redraw_preview");this.need_redraw=!1;return!0};e.prototype.clear=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.frags=[]};e.prototype.drawImage=function(a,d,e,f,h,i,j,m){i=new n({parent:this,position:new k({x:d,y:e}),width:f,height:h});i.drawImage(a,d,e,f,h,0,0);this.frags.push(i);m&&(i.downCompositeOperation=m)};e.prototype.copy=function(a){this.drawImage(a.src,
0,0,a.src.width,a.src.height,0,0)};e.prototype.to_json=function(){return{label:this.data,data:this.cCanvas.data.toDataURL()}};h.export(d,e)})(window,graphit,console);(function(f,h,i,j){function e(e){var f=this,e=e||{};e.className=d;e.label="layermanager";a.call(this,e,["parent"]);this.parent||this.exception("no_parent_parameter");this.layers=[];this.special_layers={};this.selected=null;this.dom_build();this.bind_trigger(this,"update",function(){f.redraw()});var e=this.parent.get_width(),h=this.parent.get_height();this.add(new l({parent:this,label:"_stack_up",width:e,height:h}));this.add(new l({parent:this,label:"_stack_down",width:e,height:h}));this.add(new l({parent:this,
label:"_grid",width:e,height:h}));this.add(new l({parent:this,label:"background",width:e,height:h}))}var d="app/layer/manager",a=h.import("lib/object"),k=h.import("lib/icon"),l=h.import("app/layer"),q=h.import("lib/math");e.prototype=Object.create(a.prototype);e.prototype.constructor=new a;e.prototype.build_layer_stack=function(a){this.special_layers.stack_down=this.layer_stack(0,a-1);this.special_layers.stack_up=this.layer_stack(a+1,this.layers.length-1)};e.prototype.add=function(a){a.parent=this;
var d=this;if(!(a instanceof l))return i.error("Layer manager need Clayer object"),null;var e=RegExp(/^_(.*)/).exec(a.label);e?(a.label="layer-"+e[1],this.special_layers[e[1]]=a):this.layers.push(a);if(!e&&this.rootElm){var e=this.rootElm.find(".group-layers"),f=$(a.dom_get(this.layers.length-1));e.prepend(f)}this.selected||(this.selected=a);this.bind_trigger(a,"update",function(){d.redraw()});this.send_trigger("update");return a};e.prototype.layer_stack=function(a,d){if(a>d)return null;for(var e=
this.parent.get_width(),f=this.parent.get_height(),e=new l({parent:this,label:"stack",width:e,height:f}),f=e.cCanvas.getContext(),h,i=a;i<=d;i++)h=this.layers[i].cCanvas.data,f.drawImage(h,0,0,h.width,h.height);return e};e.prototype.exists=function(a){for(var d=0,e=!1,d=0;d<this.layers.length;d++)if(this.layers[d]==a){e=!0;break}return e?d:null};e.prototype.remove=function(a){var d=this.selected,e=this.exists(a);d==a&&1<e&&(d=this.layers[e-1]);e===j&&i.error("Cannot remove undefined element");this.layers.splice(e,
1);this.select(d);this.parent.redraw(!0)};e.prototype.get=function(a){return!a||"__selected__"==a?this.selected:q.isint(a)?this.layers[a]:this.special_layers[a]};e.prototype.get_index_by_uid=function(a){for(var d=0;d<this.layers.length;d++)if(this.layers[d].uid==a)return d;return null};e.prototype.move_down=function(a){a=this.get_index_by_uid(a);if(a===j||1>=this.layers.length||1>a)return i.error("Can't move layer up"),!1;var d=this.layers[a-1];this.layers[a-1]=this.layers[a];this.layers[a]=d;this.select(this.selected);
this._build_layer_preview(".group-layers");this.send_trigger("update");return!0};e.prototype.move_up=function(a){if(1==this.layers.length)return!1;a=this.get_index_by_uid(a);if(a===j||a>=this.layers.length-1||1>=this.layers.length)return i.error("Can't move layer up"),!1;var d=this.layers[a+1];this.layers[a+1]=this.layers[a];this.layers[a]=d;this.select(this.selected);this._build_layer_preview(".group-layers");this.send_trigger("update");return!0};e.prototype.select=function(a){a=this.exists(a);if(a===
j||0>a||a>this.layers.length)return i.error("Layer index out of range: "+a),!1;this.build_layer_stack(a);this.selected=this.layers[a];this.send_trigger("update");return!0};e.prototype.dom_build=function(){var a=this,d=$("<div />");d.attr("title","Layer manager");var e=$("<div />");$("<div />");var f=new k({name:"stock-layer",size:24,width:16,height:16,title:"Create new layer",callback_click:function(){a.add(new l({parent:a,width:a.parent.get_width(),height:a.parent.get_height()}))}});d.append(f.dom_get());
f=$("<ul />");f.addClass("group-layers ui-widget-content");d.append(f);d.append(e);this.rootElm=d;return this};e.prototype._build_layer_preview=function(a){a=$(a);a.find(".layer").detach();for(var d=this.layers.length-1;0<=d;d--)this.layers[d].redraw(!0),a.append(this.layers[d].dom_get(1))};e.prototype.dom_exists=function(a){var d=!1,e;for(e=0;e<this.layers.length;e++)if(this.layers[e].rootElm=a){d=!0;break}return d?e:null};e.prototype.redraw=function(a){for(var d=0;d<this.layers.length;d++)this.layers[d].redraw(a)};
h.export(d,e)})(window,graphit,console);(function(f,h){function i(a){a.className=j;a.label="grid";e.call(this,a,["parent","callback_slide","callback_change","label"])}var j="app/grid",e=h.import("lib/object"),d=h.import("lib/color"),a=h.import("lib/parameter/numeric"),k=h.import("lib/parameter/checkbox"),l=h.import("lib/parameter/enum/type");i.prototype=Object.create(e.prototype);i.prototype.constructor=new e;i.prototype.init=function(){this.color=this.color||new d({a:1});this.isVisible=this.isVisible||!0;var e=this,f=function(){e.send_trigger("update")};
this.parameters={width:new a({parent:this,label:"width",min:1,max:100,def:100,step:1,callback_change:f,callback_slide:f}),height:new a({parent:this,label:"height",min:1,max:100,def:100,step:1,callback_change:f,callback_slide:f}),lineWidth:new a({parent:this,label:"lineWidth",min:1,max:10,def:1,step:1,callback_change:f,callback_slide:f}),visibility:new k({parent:this,type:l.checkbox,label:"visibility",def:!1,callback_change:f})};this.label="grid";this.rootElm=null};i.prototype.draw=function(a,d,e,
f,h){d=a.getContext("2d");d.save();d.beginPath();f=this.get_parameter("width");h=this.get_parameter("height");for(e=f+1;e<a.width;e+=f)d.moveTo(e,0),d.lineTo(e,a.height);for(f=h+1;f<a.height;f+=h)d.moveTo(0,f),d.lineTo(a.width,f);d.closePath();d.strokeStyle=this.color.to_rgba();d.lineWidth=this.get_parameter("lineWidth");d.stroke();d.restore()};i.prototype.dom_build=function(){var a=$("<div />");a.attr("title",this.label);a.addClass("grid");var d=$("<div />");d.addClass("ui-widget-content");for(label in this.parameters)a.append(this.parameters[label].dom_get());
a.append(d);this.rootElm=a;return this};h.export(j,i)})(window,graphit,console);(function(f,h,i,j){function e(e){var h=this,e=e||{};e.className=d;e.label="surface";e.parameters={zoom:{label:"zoom",min:-100,max:100,def:0,step:1,autoSave:!1,callback_slide:function(){i.log("sliding",this)}}};a.call(this,e,["width","height","label"]);e=this.width||0;e=k.clamp(1,e,1920);this.width!=e&&this.exception("invalid_width",this.width);e=this.height||0;e=k.clamp(1,this.height,1920);this.height!=e&&this.exception("invalid_height",this.height);this.need_redraw=!1;this.cCanvas=new l({width:this.width,
height:this.height});this.cCanvas.clear(new q);this.layer_manager=new m({parent:this});this.layer_manager.add(new s({parent:this.layer_manager,label:E_LAYERLABEL.mouse,width:this.width,height:this.height}));this.layer_manager.add(new s({parent:this.layer_manager,label:E_LAYERLABEL.prefrag,width:this.width,height:this.height}));this.layer_manager.add(new s({parent:this.layer_manager,width:this.width,height:this.height}));this.layer_manager.select(this.layer_manager.layers[0]);this.bind_trigger(this.layer_manager,
"update",function(a){4<f.graphit.debug&&i.log("[Trigger/received]",a.type);h.redraw(1)});this.cMouse=new n({parent:this,callback_move:function(){i.log("mouse move")},callback_track:function(a,d){$(h.cMouse.rootElm).find(".var-x").empty().append(a);$(h.cMouse.rootElm).find(".var-y").empty().append(d)}});this.cGrid=new p({parent:this,callback_slide:function(a){this.set(a);i.log("slide");this.send_trigger("update")},callback_change:function(a){this.set(a);i.log("Change");this.send_trigger("update")}});
this.bind_trigger(this.cGrid,"update",function(a){4<f.graphit.debug&&i.log("[Trigger/received]",a.type);h.update_grid()});this.bind_trigger(this,"update",function(){h.redraw(1)});this.bind_trigger(this,"show",function(a,d){d||widget_factory(h.dom_get(),{width:h.cCanvas.get_width()+100,zIndex:0,stack:!0}).show()});this.update_grid();return this}var d="app/surface",a=h.import("lib/object"),k=h.import("lib/math"),l=h.import("lib/canvas"),q=h.import("lib/color"),m=h.import("app/layer/manager"),s=h.import("app/layer"),
n=h.import("lib/mouse/tracker"),p=h.import("app/grid");e.prototype=Object.create(a.prototype);e.prototype.constructor=new a;e.prototype.set_current_layer=function(a){this.layer_manager.select(a)};e.prototype.update_grid=function(){var a=this.layer_manager.get("grid");a.cCanvas.getContext().clearRect(0,0,a.cCanvas.data.width,a.cCanvas.data.height);this.cGrid.get_parameter("visibility")&&this.cGrid.draw(a.cCanvas.data,0,0,this.cCanvas.data.width,this.cCanvas.data.height);this.need_redraw=!0;this.send_trigger("update")};
e.prototype.dom_build=function(){var a=this,d=$('<div title="(Ctrl-z) Undo"/>');d.addClass("surface");var e=$("<div/>"),f=$(this.cCanvas.data);f.width=this.width;f.height=this.height;f.addClass("canvas");f.attr("tabindex",0);f.mousedown(function(d){a.callback_mousedown(d,a)});f.mouseup(function(d){a.callback_mouseup(d,a)});f.mousemove(function(d){a.callback_mousemove(d,a)});f.mouseout(function(){a.cMouse.is_pushed()&&(a.cMouse.paused=!0)});f.mouseover(function(){a.cMouse.is_pushed()&&(a.cMouse.paused=
!1)});f.mouseenter(function(){a.send_trigger("surface_selected",a)});e.append(f);d.append(e);d.append(e);this.rootElm=d;return this};e.prototype.undo=function(){this.layer_manager.selected.discard_frag();this.layer_manager.selected.redraw();this.redraw(!0)};e.prototype.redraw=function(a){if(!this.need_redraw&&!a)return!1;if(!this.layer_manager.get())return i.warn("No layer selected"),!1;var d=this.cCanvas.data,e=d.getContext("2d");e.save();var f=this.get_parameter("zoom");0!=f&&(e.translate(d.width/
2,d.height/2),e.scale(f,f));e.clearRect(0,0,d.width,d.height);this.layer_manager.special_layers.stack_down!=j&&e.drawImage(this.layer_manager.special_layers.stack_down.cCanvas.data,0,0,d.width,d.height);this.layer_manager.selected.redraw(a);e.drawImage(this.layer_manager.selected.cCanvas.data,0,0,d.width,d.height);"down_composite_operation"in this.layer_manager.special_layers.prefrag&&(e.globalCompositeOperation=this.layer_manager.special_layers.prefrag.down_composite_operation);e.drawImage(this.layer_manager.special_layers.prefrag.cCanvas.data,
0,0,d.width,d.height);"down_composite_operation"in this.layer_manager.special_layers.prefrag&&(e.globalCompositeOperation="source-over");this.layer_manager.special_layers.stack_up!=j&&e.drawImage(this.layer_manager.special_layers.stack_up.cCanvas.data,0,0,d.width,d.height);"cGrid"in this&&this.cGrid.isVisible&&e.drawImage(this.layer_manager.special_layers.grid.cCanvas.data,0,0,d.width,d.height);e.restore();this.send_trigger("redraw_preview",this);this.need_redraw=!1;return!0};e.prototype.clear=function(){for(var a=
0;a<this.layer_manager.layers.length;a++)this.layer_manager.layers[a].clear();this.need_redraw=!0;this.send_trigger("update")};e.prototype.get_width=function(){return this.cCanvas.data.width};e.prototype.get_height=function(){return this.cCanvas.data.height};e.prototype.callback_mousedown=function(){if(this.cMouse.is_pushed())return i.warn("Mouse already pushed"),!1;this.cMouse.push();this.cGraphit.cGrapher.start();return!0};e.prototype.callback_mouseup=function(){if(!this.cMouse.is_pushed())return i.warn("Mouse not pushed"),
!1;this.cGraphit.cGrapher.stop();this.redraw(!0);this.cMouse.release();return!0};e.prototype.callback_mousemove=function(a,d){var e=$(d.cCanvas.data).offset();this.cMouse.move(a.pageX-e.left,a.pageY-e.top)};e.prototype.attach_graphit=function(a){var d=h.import("app/graphit");if(!a||!(a instanceof d))return i.error("Can't attach null or none Ctoolbox instance"),!1;this.cGraphit=a};e.prototype.save_as_json=function(){f.open(this.cCanvas.data.toDataURL());return data};h.export(d,e)})(window,graphit,
console);(function(f,h,i){function j(a){a=a||{};a.className=e;a.label="Workspace";d.call(this,a,[])}var e="app/surface/workspace",d=h.import("lib/object"),a=h.import("app/surface"),k=h.import("lib/icon"),l=new (h.import("lib/po"));j.prototype=Object.create(d.prototype);j.prototype.constructor=new d;j.prototype.init=function(d){var e=this;try{this.cSurface=new a(d)}catch(f){throw i.error("Cannot create surface"),f;}this.bind_trigger(this,"show",function(){e.show()})};j.prototype.dom_build=function(){this.cSurface||
this.exception("surface_is_null");var a=this,d=$('<div class="graphit-workspace"/>'),e=$('<div class="navbar"/>');e.append((new k({name:"stock-layers",size:24,width:32,height:32,label:l.get("layers"),callback_click:function(){a.cSurface.layer_manager.dom_get().dialog({autoOpen:!0});return!1}})).dom_get());e.append((new k({name:"stock-image",size:24,width:32,height:32,label:l.get("save"),callback_click:function(){a.__save_dialog();return!1}})).dom_get());"auth"in f.graphit&&!f.graphit.auth.is_disable()&&
e.append((new k({path:"preferences",name:"folders",width:32,height:32,label:l.get("open"),callback_click:function(){a.__load_dialog();return!1}})).dom_get());d.append(e);d.append(this.cSurface.dom_get());e=$("<div />");d.append(e);this.rootElm=d;return this};j.prototype.__save_dialog=function(){$("<div />").attr("title","save");var a=this.cSurface.cCanvas.clone(),d=f.open(null,"graphit-save","resizable=yes, scrollbars=yes, titlebar=yes, width=300, height=300 top=10, left=10",!1),e=$(d.document.head);
0==e.find("title").length&&e.append("<title>GraphIt - "+l.get("save_image")+"</title>");var h=$('<link id="id-graphit-css" type="text/css" rel="stylesheet" href="css/style.css"/>');0==e.find("#id-graphit-css").length&&e.append(h);d=$(d.document.body);d.empty();e=$('<div class="graphit-window group" />');e.append("<h3>"+l.get("right_click_to_save")+"<h3/>");h=new $("<img />");h.attr("src",a.data.toDataURL());h.attr("width",200);h.attr("title","graphit-image");h.attr("alt","graphit-image");h.css("background-image",
'url("img/grid-40x40.png")');e.append(h);d.append(e)};j.prototype.__load_dialog=function(){var a=this;try{return this.get_widget("load").dialog("open")}catch(d){i.warn("Can't get <<load>> widget")}var e=$("<div />"),j=$('<input type="url" width="200" value="http://1.bp.blogspot.com/_cmrGYcwOHPE/TLXcloz0rFI/AAAAAAAAAas/Tv98tJD7qO0/s1600/plop1.gif"/>'),k=$("<button>"+l.get("load")+"</button>");k.click(function(){$(this).parent().dialog("close");var d=$(this).parent().find("input");loc=f.location;var e=
loc.pathname.split("/"),e=e.slice(0,e.length-1).join("/"),e=loc.protocol+"//"+loc.hostname+"/"+e+"php/DataURL/";i.log("server",e);try{h.auth.get("verifiedEmail"),$.getImageData({url:d.attr("value"),server:e,callback:"?",success:function(d){var e=new Clayer({width:a.cSurface.cCanvas.data.width,height:a.cSurface.cCanvas.data.height,label:"Web Image"});e.copy({src:d});a.cSurface.layer_manager.add(e)},error:function(e,f){i.error("Cannot load image",d.attr("value"));a.exception("cannot_load_image",f,{dialog:!0})}})}catch(j){widget_exception(j)}});
e.append(j);e.append(k);e.attr("title",l.get("load_image"));this.add_widget("load",e);e.dialog()};j.prototype.show=function(){this.dom_get()};h.export(e,j)})(window,graphit,console);(function(f,h,i){f=function(){var f={js:1,gbr:2},e;for(e in f)this[e]=f[e]};f.prototype.key_by_value=function(f){for(var e in this["enum"])if(this["enum"][e]==f)return e;return null};f.prototype.key_by_value=f.prototype.key_by_value;i.log("app/brush/enum/type",f);h.export("app/brush/enum/type",new f)})(window,graphit,console);(function(f,h,i){var j=h.import("lib/canvas"),e=h.import("lib/color");h.export("app/brush/tools",{circle:{width:100,height:100,callback_update:function(){var d=h.import("app/toolbox"),a=this.parent.parent;if(!(a instanceof d))return i.error("Brush parent of parent must be a toolbox"),!1;d=a.fg_color.color.clone();a=a.selected;"opacity"in a.parameters&&(d.a=a.parameters.opacity.value);a=this.cCanvas.data.width/2;this.cCursor=new j({width:this.cCanvas.width,height:this.cCanvas.height});cDraw.circle({dcanvas:this.cCursor.data,
x:a,y:a,r:a,fillStyle:new e({r:255,a:1}),strokeStyle:new e({r:255,a:1}),lineWidth:1});cDraw.circle({dcanvas:this.cCanvas.data,x:a,y:a,r:a,fillStyle:d})}},scircle:{width:100,height:100,callback_update:function(){var d=this.parent.parent;if(!(d instanceof Ctoolbox))return i.error("Brush parent of parent must be a toolbox"),!1;var a=d.fg_color.color.clone();if((d=d.selected)&&"opacity"in d.parameters)a.a=d.parameters.opacity.value;d=this.cCanvas.data.width/2;this.cCursor=new j({width:this.cCanvas.width,
height:this.cCanvas.height});cDraw.circle({dcanvas:this.cCursor.data,x:d,y:d,r:d,fillStyle:new e({r:255,a:1}),strokeStyle:new e({r:255,a:1}),lineWidth:1});cDraw.circle({dcanvas:this.cCanvas.data,x:d,y:d,r:d,strokeStyle:a})}},rectangle:{width:100,height:100,callback_update:function(){var d=this.parent.parent;if(!(d instanceof Ctoolbox))return i.error("Brush parent of parent must be a toolbox"),!1;var a=d.fg_color.color.clone();if((d=d.selected)&&"opacity"in d.parameters)a.a=d.parameters.opacity.value;
d=this.cCanvas.data.width;this.cCursor=new j({width:this.cCanvas.width,height:this.cCanvas.height});var e=this.cCursor.getContext();e.save();e.clearRect(0,0,d,d);e.strokeStyle=a.to_rgba();e.strokeRect(0,0,d,d);e.restore();e=this.cCanvas.getContext();e.save();e.clearRect(0,0,d,d);e.fillStyle=a.to_rgba();e.fillRect(0,0,d,d);e.restore()}}})})(window,graphit,console);(function(f,h,i){function j(a){a.className=e;a.label="brush";d.call(this,a,["parent","name","type"])}var e="app/brush",d=h.import("lib/object"),a=h.import("app/brush/enum/type"),k=h.import("lib/canvas"),l=h.import("lib/color");j.prototype=Object.create(d.prototype);j.prototype.constructor=new d;j.prototype.init=function(d){if(!this.type||!this.name)return i.error("Module need <<type>> and <<name>> parameter"),!1;if(this.type==a.js)this._load_js(d);else if(this.type==a.gbr)i.log("Parsing Gimp Brush"),
this._load_gbr(d);else return thix.exception("unknown_brush_type",this.type),!1;return this.init_canvas(d)};j.prototype.init_canvas=function(a){a=new k({width:a.data.width,height:a.data.height});a.clear(new l);this.cCanvas=a};j.prototype.update=function(){this.callback.update.call(this,this.parent)};j.prototype._load_js=function(a){if(!("callback_update"in a.data))return i.error("Javascript brush must contain a callback_update function"),!1;this.callback.update=a.data.callback_update;return!("width"in
a.data)||!("height"in a.data)?(i.error("Javascript brush need width and height property"),!1):!0};j.prototype._load_gbr=function(){};j.prototype.dom_build=function(){var d=this,e=$("<div />"),f=$("<div />");f.addClass("group-brush group");f.append("<label>"+a.key_by_value(this.type)+" / "+this.name+"</label>");i.log("Ccanvas",this.cCanvas);f.append(this.cCanvas.dom_get());e.append(f);e.click(function(){d.send_trigger("brush_selected",d);$(this).parents(".group-brushmanager").find(".group-brush").removeClass("selected");
$(this).children(".group-brush").addClass("selected")});this.rootElm=e;return this};h.export(e,j)})(window,graphit,console);(function(f,h,i){function j(a){a=a||{};a.className=e;a.label="brushmanager";this.brushes=[];this.selected=null;d.call(this,a,["parent"])}var e="app/brush/manager",d=h.import("lib/object"),a=h.import("app/brush"),k=h.import("app/brush/enum/type"),l=h.import("app/brush/tools");j.prototype=Object.create(d.prototype);j.prototype.constructor=new d;j.prototype.init=function(){this.add(new a({parent:this,type:k.js,name:"circle",data:l.circle}));this.add(new a({parent:this,type:k.js,name:"rectangle",data:l.rectangle}));
this.add(new a({parent:this,type:k.js,name:"scircle",data:l.scircle}))};j.prototype.dom_build=function(){var a=this,d=$("<div />");d.attr("id",this.guid());d.attr("title",this.label);var e=$("<div />");cEach(this.brushes,function(d,f){var h=f.dom_get();a.selected==f&&h.find(".group-brush").addClass("selected");e.append(h)});d.append(e);this.rootElm=d;return this};j.prototype.add=function(d){var e=this;if(this.exists(d))return i.error("This brush is already present"),!1;this.selected||(this.selected=
d);this.bind_trigger(d,"brush_selected",function(d,f){if(!(f instanceof a))return i.error("Trigger brush_selected must reture a brush",d,f),!1;e.selected=f;e.selected.update();e.send_trigger("update")});this.brushes.push(d);this.send_trigger("update");return!0};j.prototype.exists=function(a){cEach(this.brushes,function(d){if(d.type==a.type&&d.name==a.name)return!0});return!1};h.export(e,j)})(window,graphit,console);(function(f,h,i){function j(a){var h=this;a.className=e;a.label="toolboxpreview";d.call(this,a,["parent"]);this.bind_trigger(this,"update",function(a){4<f.graphit.debug&&i.log("[Trigger/received]",a.type);a=h.parent.fg_color.color.clone().inverse();a.a=1;h.cCanvas.clear(a);a=h.cCanvas.getContext();h.cCanvas.clear();var d=h.parent.brush_manager.selected.cCanvas.data,e=h.parent.selected.get_parameter("size"),j=e>h.cCanvas.get_width()?h.cCanvas.get_width():e,k=e>h.cCanvas.get_height()?h.cCanvas.get_height():
e,e=(h.cCanvas.get_width()-e)/2;a.drawImage(d,0,0,d.width,d.height,e,e,j,k)})}var e="app/toolbox/preview",d=h.import("lib/object"),a=h.import("lib/canvas");j.prototype=Object.create(d.prototype);j.prototype.constructor=new d;j.prototype.init=function(){this.cCanvas=new a({parent:this,width:100,height:100})};j.prototype.dom_build=function(){var a=$("<div />");a.addClass("toolbox-preview");var d=$("<div />");d.append(this.cCanvas.dom_get());a.append(d);this.rootElm=a;return this};h.export(e,j)})(window,
graphit,console);(function(f,h,i){function j(f,h){var j=this;h.className=e;h.label=h.label||"toolbox_colorpicker";d.call(this,h,["parent","label","callback_onchange"]);if(f&&!(f instanceof a))return i.error("color parameter is not an instance of Ccolor"),null;this.color=f?f:new a;this.color.install_callback({name:"change",callback:function(){j.update()}});this.rootElm=null;this.cCanvas=new k({width:32,height:32});this.ctx=this.cCanvas.getContext();this.clear(this.color)}var e="app/toolbox/colorPicker",d=h.import("lib/object"),
a=h.import("lib/color"),k=h.import("lib/canvas");j.prototype=Object.create(d.prototype);j.prototype.constructor=new d;j.prototype.clear=function(a){this.cCanvas.clear(a)};j.prototype.to_rgba=function(){return this.color.to_rgba()};j.prototype.update=function(){this.clear(this.color);this.elmImage.getContext("2d").drawImage(this.cCanvas.data,0,0,this.cCanvas.get_width(),this.cCanvas.get_height());this.send_trigger("color_selected")};j.prototype.dom_build=function(){var a=this;if(this.rootElm)return this;
var d=document.createElement("div"),d=$(d),e=document.createElement("canvas");e.setAttribute("width",32);e.setAttribute("height",32);e.setAttribute("alt",this.label);e.setAttribute("title",this.label);this.elmImage=e;d.append(e);var f=e.getContext("2d"),h=this.cCanvas.data;f.drawImage(h,0,0,h.width,h.height);$(e).ColorPicker({onChange:function(d,e,f){a.color.set_rgb(f)},onSubmit:function(d,e,f){a.color.set_rgb(f)},zIndex:10});this.rootElm=d;return this};h.export(e,j)})(window,graphit,console);(function(f,h,i,j){function e(e){var h=this;e.className=d;e.label="toolbox";a.call(this,e,["parent"]);this.elmOptions=this.elmPreview=null;this.dialog_options={modal:!1,width:250,position:"right top",stack:!0};this.bind_trigger(this.fg_color,"color_selected",function(a){4<f.graphit.debug&&i.log("[Trigger/received]",a.type);h.update()});this.bind_trigger(this.bg_color,"color_selected",function(a){4<f.graphit.debug&&i.log("[Trigger/received]",a.type);h.update()});this.bind_trigger(this,"switch_color",
function(){h.switch_color()})}var d="app/toolbox",a=h.import("lib/object"),k=h.import("app/toolbox/preview"),l=h.import("app/toolbox/colorPicker"),q=h.import("app/tool"),m=h.import("app/tool/pencil"),s=h.import("app/tool/paintbrush"),n=h.import("app/tool/fill"),p=h.import("app/tool/eraser"),r=h.import("app/tool/colorPicker"),x=h.import("lib/color"),u=h.import("app/brush/manager"),v=h.import("lib/icon"),t=new (h.import("lib/po"));e.prototype=Object.create(a.prototype);e.prototype.constructor=new a;
e.prototype.init=function(){var a=this;this.selected=null;this.tools=[];this.preview=new k({parent:this});this.fg_color=new l(new x({r:255,g:255,b:255,a:1}),{parent:this,callback_onchange:function(){this.send_trigger("update",a)},label:t.get("foreground_color")});this.bind_trigger(this.fg_color,"update",function(){a.update()});this.bg_color=new l(new x({r:0,g:0,b:0,a:1}),{parent:this,callback_onchange:function(){this.send_trigger("update",a)},label:t.get("background_color")});this.bind_trigger(this.bg_color,
"update",function(){a.update()});this.brush_manager=new u({parent:this});this.bind_trigger(this.brush_manager,"update",function(){a.update()});this.load(this.olist);this.dom_build()};e.prototype.select_tool_by_name=function(a){var d=this;return cEach(this.tools,function(e,f){f.label==a&&(d.select_tool(f),this.stop(),this.ret=!0);return!1})};e.prototype.load=function(){var a=this,d=function(d){a.bind_trigger(d,"update",function(){a.preview.send_trigger("update")});a.tools.push(d)},e=new m({parent:this});
d.call(this,e);this.selected=e;e=new s({parent:this});d.call(this,e);e=new p({parent:this});d.call(this,e);e=new n({parent:this});d.call(this,e);e=new r({parent:this});d.call(this,e)};e.prototype.update=function(){this.brush_manager.selected.callback.update.call(this.brush_manager.selected);this.selected.update();this.preview.send_trigger("update")};e.prototype.select_tool=function(a){if(a==j)return i.warn("Can't select undefined tool"),!1;var d=$(a.rootElm);d.parents(".group-tools").find(".tool").removeClass("selected");
d.children(".tool").addClass("selected");d=d.parents(".toolbox").find(".group-options");d.children("div").detach();d.append(a.dom_build_options());this.selected=a;this.update();return!0};e.prototype.switch_color=function(){var a=this.fg_color;this.fg_color=this.bg_color;this.bg_color=a;a=this.rootElm.find(".colorpicker-colors");a.children(".colorpicker").detach();this.dom_build_colorpickers(a);this.send_trigger("update_foreground_color")};e.prototype.dom_build_colorpickers=function(a){a.append(this.fg_color.dom_get());
a.append(this.bg_color.dom_get())};e.prototype.dom_build=function(){var a=this,d=$('<div title="Toolbox"/>');d.addClass("toolbox");var e=$("<div />");e.addClass("group group-tools ui-widget-content");for(var f=0;f<this.tools.length;f++){var h=this.tools[f];h.bind_trigger(h,"tool_selected",function(d,e){if(!(e instanceof q))return i.error("Trigger tool_selected must pass a Ctool argument"),!1;a.select_tool(e);return!0});var j=h.dom_get();this.selected==h&&h.rootElm.children(".tool").addClass("selected");
e.append(j)}d.append(e);e=$("<div/>");e.addClass("ui-widget-content group-colorpicker");f=$("<div/>");f.addClass("ui-widget-content colorpicker-colors");this.dom_build_colorpickers(f);e.append(f);e.append($((new v({name:"stock-default-colors",size:12,callback_click:function(){a.send_trigger("switch_color");a.update()},label:t.get("switch_color")})).dom_get().addClass("switch")));d.append(e);e=$("<div/>");e.addClass("group-preview ui-widget-content");e.append(this.preview.dom_get());d.append(e);e=
$("<div />");e.addClass("group-options ui-widget-content");d.append(e);e=$("<div />");e.addClass("group-brushmanager ui-widget-content");e.append(this.brush_manager.dom_get());d.append(e);this.rootElm=d;return this};h.export(d,e)})(window,graphit,console);(function(f,h,i){function j(a){a=a||{};a.className=e;a.label="binaryfile";this.headers=[];this.FH={};d.call(this,a,["src","callback_success","callback_error","responseType"]);this.responseType=this.responseType||"arraybuffer";this.response=null;this.loaded=!1;this.error="";this.src&&this.load(this.src)}var e="lib/binaryFile",d=h.import("lib/object");j.prototype=Object.create(d.prototype);j.prototype.constructor=new d;j.prototype.set_src=function(){};j.prototype.load=function(a){if(!a)return i.error("Trying to load undefined src"),
null;4<f.graphit.debug&&i.log("Loading file: "+a);this.src=a;var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="arraybuffer";var e=this;d.onload=function(){e.response=this;"success"in e.callback&&e.callback.success.call(e,this)};d.onerror=function(){i.error(this.className+" failed to load file",this.src);"error"in e.callback&&e.callback.error(e,this)};d.send()};j.prototype.header=function(a){return!(a in this.FH)?(i.error("No property <<",a,">> in header"),""):this.headers[this.FH[a]].value};
h.export(e,j)})(window,graphit,console);(function(f,h,i){function j(a){this.className=e;this.label="GBR file";d.call(this,a);"success"in this.callback&&(this.callback._success=this.callback.success);"error"in this.callback&&(this.callback._error=this.callback.error);this.callback.success=this._success;this.callback.error=this._error}var e="lib/binaryFile/GBR",d=h.import("lib/binaryFile");j.prototype=Object.create(d.prototype);j.prototype.constructor=new d;j.prototype.init=function(){this.loaded=!1;this.magic_number=1195986256;this.cCanvas=
null;this.headers=[{type:"uint32",label:"header_size"},{type:"uint32",label:"version"},{type:"uint32",label:"width"},{type:"uint32",label:"height"},{type:"uint32",label:"bytes"},{type:"uint32",label:"magic_number"},{type:"uint32",label:"spacing"}];this.FH={header_size:0,version:1,width:2,height:3,bytes:4,magic_number:5,spacing:6}};j.prototype._success=function(a){this.loaded=!1;if(this.parse_response(a))return this.loaded=!0,"_success"in this.callback&&this.callback._success.call(this,a),!0;this.init();
return!1};j.prototype.parse_response=function(a){var d=this.FH;10<f.graphit.debug&&i.log("[File/GBR] Parsing header",this.src);for(var a=new DataView(a.response,0),e=0,h=0;h<this.headers.length;h++)this.headers[h].value=a.getInt32(e),10<f.graphit.debug&&i.log(this.headers[h].label,this.headers[h].value),e+=4;if(this.headers[d.magic_number].value!=this.magic_number)return i.error("Trying to load file that is not a GIMP GBR (Brush)"),!1;for(var h=this.headers[d.header_size].value,j="",s=0;s<h;s++)j+=
String.fromCharCode(a.getInt8(e)),e+=1;this.name=j;h=null;h=this.headers[d.bytes].value;if(4==h)label_type="RGBA",h=this._canvas_store_rgba;else if(1==h)label_type="GRAYSCALE",h=this._canvas_store_grayscale;else return i.log("Dunnot know how parsing format with bytes => ",h),!1;d=new Ccanvas({width:this.headers[d.width].value,height:this.headers[d.height].value});d.clear(new Ccolor({a:1}));for(var j=d.getContext("2d"),s=j.getImageData(0,0,d.width,d.height),n=0;e<a.byteLength;e++)n+=h(s,a,n,e);j.putImageData(s,
0,0);this.cCanvas=d;return!0};j.prototype._canvas_store_rgba=function(a,d,e,f){a.data[e]=d.getUint8(f);return 1};j.prototype._canvas_store_grayscale=function(a,d,e,f){a.data[e]=d.getUint8(f);a.data[e+1]=d.getUint8(f);a.data[e+2]=d.getUint8(f);a.data[e+3]=255;return 4};j.prototype.dom_build=function(){var a=$("<div />");this.loaded?a.append(this.cCanvas.dom_get()):a.append("<p>Failed to load Gimp gbr file: "+this.src+"</p>");this.rootElm=a;return this};j.prototype._error=function(){this.init();"_error"in
this.callback&&this.callback._error.call(this)};h.export(e,j)})(window,graphit,console);(function(f,h,i){var j=h.import("lib/object"),e=h.import("lib/menu"),d=h.import("app/toolbox"),a=h.import("app/core/theme"),k=h.import("app/license"),l=h.import("app/grapher"),q=h.import("lib/parameter/numeric"),m=h.import("app/surface/workspace"),s=h.import("app/surface"),n=h.import("lib/canvas"),p=new (h.import("lib/po")),r=function(a){a=a||{};a.className="app/graphit";a.label="graphit";a.widgets={};this.surfaces=[];this.selected=null;j.call(this,a,["widgets"]);this.dialog_options={position:"right top"};
this.dom_get();this.surface_create({parent:this,width:400,height:400})};r.prototype=Object.create(j.prototype);r.prototype.constructor=new j;r.prototype.init=function(){var h=this;this.bind_trigger(this,"create_surface",function(a,d){h.surface_create(d)});this.bind_trigger(this,"display_new_surface",function(){h.dialog_new_surface().dialog("open").dialog("moveToTop")});this.bind_trigger(this,"display_widget",function(a,d){h.get_widget(d).dialog("open").dialog("moveToTop")});this.wJquerytheme=new a;
this.wAbout=new k;this.wLogin=f.graphit.auth;var j=f.graphit.baseRestContent,m={cssClass:"disable",label:p.get("menu_login"),callback_click:function(){var a="",a=f.graphit.auth?j+"gi/login":f.graphit.baseStaticContent+"pages/no-authentication.htm";try{f.open(a,"graphit_oauth","width=900,height=600").focus()}catch(d){this.exception("cant_talk_to_opener",d)}}};this.cMenu=new e({parent:null,type:"jquery",label:"graphit_menu",entries:{files:{label:p.get("menu_file"),entries:{new_surface:{label:p.get("menu_new_surface"),
callback_click:function(){h.send_trigger("display_new_surface")}}}},edition:{label:p.get("menu_edition"),entries:{toolbox:{label:p.get("menu_toolbox"),callback_click:function(){h.send_trigger("display_widget",h.cToolbox)}}}},login:m,help:{label:p.get("menu_help"),entries:{theme:{label:p.get("menu_theme"),callback_click:function(){h.send_trigger("display_widget",h.wJquerytheme)}},about:{label:p.get("menu_about"),callback_click:function(){h.send_trigger("display_widget",h.wAbout)}}}}}});this.cToolbox=
new d({parent:this});this.bind_trigger(this.cToolbox,"update",function(){});this.cGrapher=new l({parent:this});this.bind_trigger(this.cGrapher,"update",function(){});this.keybindings={n:{label:"pen",callback:function(){h.cToolbox.select_tool_by_name("pen");return!1}},p:{label:"brush",callback:function(){h.cToolbox.select_tool_by_name("brush");return!1}},"Shift+e":{label:"eraser",callback:function(){h.cToolbox.select_tool_by_name("eraser");return!1}},"Ctrl+z":{label:"undo",callback:function(a){a.preventDefault();
a.stopPropagation();a.stopImmediatePropagation();if(!h.selected)return i.warn("No surface selected to call undo"),!1;h.selected.undo();return!1}}};for(var q in this.keybindings)$(document).bind("keydown",q,this.keybindings[q].callback);this.send_trigger("display_widget",this.cToolbox)};r.prototype.get_widget=function(a){"dom_get"in a||this.exception("method_object_missing","dom_get");if(a.label in this.widgets)return this.widgets[a.label];var d={closeOnEscape:!0,modal:!0};if("dialog_options"in a)for(var e in a.dialog_options)d[e]=
a.dialog_options[e];d=a.dom_get().dialog(d);return this.widgets[a.label]=d};r.prototype.dialog_new_surface=function(){if("new_surface"in this.widgets)return this.widgets.new_surface;var a=this,d=$("<div />").attr("title","New Csurface"),e=$("<div />").addClass("group group-new-surface"),f=new q({label:"width",bAutosave:!1,parent:this,min:1,max:1920,step:1,def:400}),h=new q({label:"height",parent:this,bAutosave:!1,min:1,max:1280,step:1,def:400});e.append(f.dom_get(),h.dom_get());d.append(e);d.dialog({modal:!1,
closeOnEscape:!0,stack:!0,zIndex:10,buttons:{Ok:function(){var d=$(this).parent();a.send_trigger("create_surface",{width:d.find(".width input").attr("value"),height:d.find(".height input").attr("value")})},Cancel:function(){$(this).dialog("close")}}});return this.widgets.new_surface=d};r.prototype.surface_create=function(a){var d=this;a.parent=this;var e=null;try{e=new m(a)}catch(f){return i.error("Cannot create surface, Exception <<< ",f," >>>"),!1}if(!e)return!1;this.bind_trigger(e.cSurface,"surface_selected",
function(a,e){e instanceof s||d.exception("invalid_surface_selected_parameter");e.attach_graphit(d);d.selected=e});widget_factory(e.dom_get(),{width:parseInt(a.width)+100});this.surfaces.push(e);this.selected||(this.selected=e);this.dom_build_add_surface(e);return!0};r.prototype.dom_build_add_surface=function(a){var d=this,e=$('<div class="group group-graphit-surface" />'),f=new n({width:50,height:50}),h=a.cSurface;h.canvas_preview=f;f.copy({src:h.cCanvas});e.append(f.dom_get());this.rootElm.find(".group-graphit-surfaces").append(e);
h.bind_trigger(h,"redraw_preview",function(a,d){h.canvas_preview.copy({src:d.cCanvas,resize:!0})});e.click(function(){h.send_trigger("surface_selected",h);cEach(d.surfaces,function(a,d){d.cSurface==h&&d.rootElm.parent().dialog("open").dialog("moveToTop")});$(this).parent().find(".group-graphit-surface").removeClass("selected");$(this).addClass("selected")});return this};r.prototype.dom_build=function(){var a=$("<div />"),d=$('<div class="group group-menu" />');d.append(this.cMenu.dom_get());a.append(d);
d=$('<div class="group group-graphit-surfaces"/>');cEach(this.surfaces,function(a,e){var f=$('<div class="graphit-surface" />'),h=new n({width:50,height:50});h.copy(e.cCanvas,!0);f.append(h.dom_get());d.append(f)});a.append(d);for(var e=f.graphit.baseStaticContent+"/",h=$('<div class="group group-badge">'),i=["html5","vcss","zf2","gplv3"],j=0;j<i.length;j++){var k=$('<img class="badge" />');k.attr("width",32);k.attr("src",e+"images/badge-"+i[j]+"-32.png");h.append(k)}a.append(h);this.rootElm=a;return this};
r.prototype.list=function(a){for(var d=0;d<this.surfaces.length;d++)a.call(this,d,this.surfaces[d]);return this.surfaces.length};h.export("app/graphit",r)})(window,graphit,console);(function(f,h,i,j){var e=h.import("lib/object"),d=function(a){var d=this,a=a||{};a.className="app/auth";a.label="app/auth";a.disable=a.disable!=j?a.disable:!1;this.selected=null;a.dialog_options=a.dialog_options||{modal:!1,width:200};this.__init_singleton(a);e.call(this,a,["dialog_options"]);this.hasValidAccount();this.bind_trigger(this,"update",function(){d.update()})};d.prototype=Object.create(e.prototype);d.prototype.constructor=new e;d.prototype.hasValidAccount=function(){var a=f.graphit;if(!("storage"in
a))return null;a=a.storage.get("chooserAccounts");return!a?null:a=JSON.parse(a)};d.prototype.__init_singleton=function(a){"__data"in d||(d.__data={});"__disable"in d||(d.__disable=a.disable)};d.prototype.copy=function(a){for(key in a.get_data())i.log("Copy",key),this.set(key,a.get(key))};d.prototype.get_data=function(){return d.__data};d.prototype.is_logged=function(){return this.get("verifiedEmail")};d.prototype.is_disable=function(){return d.__disable};d.prototype.set=function(a,e){i.log("Auth",
a,e);d.__data[a]=e};d.prototype.get=function(a){return!(a in d.__data)?(i.warn("key doesn't exists",a),null):d.__data[a]};d.prototype.each=function(a){if(!a||"function"!=typeof a)throw"invalid_callback";for(var e in d.__data)a.call(d.__data,e,this.get(e))};d.prototype.dom_get=function(a){return this.rootElm&&(a==j||!a)?this.rootElm:this.dom_build().rootElm};d.prototype.__replace_accounts=function(){var a=this,d=this.rootElm.children(".group-graphit-authentication").empty(),e=this.hasValidAccount();
cEach(e,function(e,f){var h=$("<div />"),j=$("<img />");j.addClass("photoUrl");j.attr("src",f.photoUrl);j.attr("alt","photoUrl");h.append(j);h.append('<b class="displayName">'+f.displayName+"</b>");h.append('<b class="email">'+f.email);a.ajax_is_logged({email:f.email,callback_error:function(){i.warn("removing email",f.email)}});d.append(h)});if(e&&0<e.length){var e=$('<div class="logout" />'),h=$("<button />");h.append(T("menu_logout"));h.button({});h.click(function(){f.graphit.storage.remove("chooserAccounts");
deleteAllCookies();a.ajax_logout({email:"",callback_success:function(){i.log("logout");d.empty()}});a.send_trigger("update")});e.append(h);d.append(e)}};d.prototype.update=function(){this.__replace_accounts()};d.prototype.dom_build=function(){var a=$('<div title="Graphit Authentication"/>'),d=$("<div  />");d.addClass("group group-graphit-authentication");a.append(d);this.rootElm=a;this.__replace_accounts();return this};d.prototype.ajax_is_logged=function(a){var d=this,e=$.ajax({type:"POST",url:f.graphit.baseRestContent+
"gi/logged",data:{email:a.email}});"callback_succces"in a?e.done(function(e){a.callback_succes.call(d,e)}):"callback_error"in a&&e.error(function(e,f){a.callback_error.call(d,e,f)})};d.prototype.ajax_logout=function(a){var d=this,e=$.ajax({type:"POST",url:f.graphit.baseRestContent+"gi/logout",data:{email:a.email}});"callback_success"in a?e.done(function(e){a.callback_success.call(d,e)}):"callback_error"in a&&e.error(function(e,f){a.callback_error.call(d,e,f)})};h.export("app/auth",d)})(window,graphit,
console);(function(f,h,i){var j=h.debug,e=h.import("lib/object"),d=function(a){a=a||{};a.className="app/browser";a.label="app/browser";e.call(this,a,[])};d.prototype=Object.create(e.prototype);d.prototype.constructor=new e;d.prototype.get_language=function(){var a=navigator.language?navigator.language:navigator.userLanguage,d=/^\s*([^-]*)-([^\s]*)\s*$/.exec(a);return d?d[1]:a};d.prototype.get_language=d.prototype.get_language;d.prototype.is_file_supported=function(){if(f.File&&f.FileReader&&f.FileList&&f.Blob)return!0;
i.error("The File APIs are not fully supported in this browser.");return!1};d.prototype.is_file_supported=d.prototype.is_file_supported;d.prototype.is_canvas_supported=function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))};d.prototype.is_canvas_supported=d.prototype.is_canvas_supported;d.prototype.__test=function(){var a=new (h.import("app/browser")),d="File supported: ",d=a.is_file_supported()?d+"yes":d+"no",d=d+"\nCanvas supported: ",d=a.is_canvas_supported()?
d+"yes":d+"no";j&&i.log(d);return!0};d.prototype.__test=d.prototype.__test;h.export("app/browser",d)})(window,graphit,console);(function(f,h,i){var j=h.import("lib/object"),f=function(e){e=e||{};e.className="app/core/object";e.label="app/core/object";j.call(this,e,[])};f.prototype=Object.create(j.prototype);f.prototype.constructor=new j;f.prototype.add_component=function(e,d){var a=(e+"").split("/"),f=a.pop();i.log("root/xpath",f,a);if(0==a.length)this[f]=d;else{if(!this[f])throw"invalid_component_path__"+e+"-"+f;this[f].add_component(a.join("/"),d)}};f.prototype.add_component=f.prototype.add_component;f.prototype.__test=
function(){new (h.import("app/core/object"))};f.prototype.__test=f.prototype.__test;h.add_component=f.add_component;h.export("app/core/object",f)})(window,graphit,console);(function(f,h,i){var j=h.import("app/core/object"),f=function(e){e=e||{};e.className="app/core/ui";e.label="app/core/ui";j.call(this,e,[])};f.prototype=Object.create(j.prototype);f.prototype.constructor=new j;f.prototype.widget_factory=function(e,d){d=d||{};if(!e)throw"func_widget_factory_need_dom";i.log("Widget factory",e,d);var a={autoOpen:!0,resizable:!0,draggable:!0,width:250,zIndex:10,dialogClass:"shojs-dialog",stack:!0},f;for(f in a)f in d||(d[f]=a[f]);e.dialog(d);return e};f.prototype.widget_factory=
f.prototype.widget_factory;f.prototype.widget_exception=function(e){var d=graphit.import("lib/exception");i.error("Widget",e);var a=e,f="[Error] ";e instanceof d&&(a=e.to_s({format:"html"}),f=f+e.className+"/"+e.label);d=$('<div title="'+f+'" />');d.append($("<p>"+a+"<p/>"));d.dialog({modal:!0});throw e;};f.prototype.widget_exception=f.prototype.widget_exception;f.prototype.__test=function(){new (h.import("app/core/ui"))};f.prototype.__test=f.prototype.__test;h.export("app/core/ui",f)})(window,graphit,
console);(function(f,h,i){var j=h.import("lib/object"),f=function(e){e=e||{};e.className="lib/ui/content";j.call(this,e,["label"]);this.content=null;this.childs=[];this.dom_get();var d=this;this.bind_trigger(this,"graphit-refresh-ui",function(){d.refresh()})};f.prototype=Object.create(j.prototype);f.prototype.constructor=new j;f.prototype.set_content=function(e){this.content=e;this.refresh()};f.prototype.set_content=f.prototype.set_content;f.prototype.get_content=function(){return this.content};f.prototype.get_content=
f.prototype.get_content;f.prototype.refresh=function(){i.log("Refresh content");var e=this.get_content();e||(e=$("<div />"));"object"===typeof e&&"dom_get"in e&&(e=e.dom_get());i.log(e);for(var d=0;d<this.childs.length;d++){i.log("CHILD            ??????");var a=this.childs[d];i.log("Child",a);a.refresh();i.log("Child",a);e.append(this.childs[d].dom_get())}this.rootElm.empty().append(e);return this};f.prototype.refresh=f.prototype.refresh;f.prototype.add_child=function(e){i.log("Add child",e.to_s());
this.childs.push(e);this.refresh()};f.prototype.add_child=f.prototype.add_child;f.prototype.set_index=function(e){this.index=e};f.prototype.set_index=f.prototype.set_index;f.prototype.get_index=function(){return this.index};f.prototype.get_index=f.prototype.get_index;f.prototype.dom_build=function(){var e=$("<div />");e.attr("id",this.get_dom_id());e.addClass(this.get_dom_class());this.rootElm=e;return this};f.prototype.dom_build=f.prototype.dom_build;f.prototype.to_s=function(){var e="["+this.className+
"]\n",d=this.get_content();"object"===typeof d&&"to_s"in d&&(d=d.to_s());e=e+("Content: "+d+"\n")+"Childs:\n";for(d=0;d<this.childs.length;d++)e+=" - "+this.childs[d].to_s()+"\n";return e};f.prototype.to_s=f.prototype.to_s;f.prototype.__test=function(){new (h.import("lib/ui/content"))};f.prototype.__test=f.prototype.__test;h.export("lib/ui/content",f)})(window,graphit,console);(function(f,h,i){var j=h.import("lib/ui/content"),f=function(e){var d=this,e=e||{};e.className="lib/ui/rollout";j.call(this,e,[]);this.bind_trigger(this,"graphit-refresh-ui",function(){d.refresh()});this.dom_get()};f.prototype=Object.create(j.prototype);f.prototype.constructor=new j;f.prototype.__test=function(){var e=new (h.import("lib/ui/rollout"))({label:"TEST_test"}),d=h.import("lib/ui/content"),a=new d({label:"content01"});a.set_content("Content 01");var f=new d({label:"content02"});f.set_content("Content 02");
var j=new d({label:"content03"});j.set_content("Content 03");d=new d({label:"refresh-button"});d.get_content=function(){var a=$("<button >Refresh</button>").button();a.click(function(){i.log("PLOP");e.send_trigger("graphit-refresh-ui")});return a};e.add_child(a);e.add_child(f);e.add_child(j);e.add_child(d);e.dom_get().dialog();a.set_content("Content 01 Modified")};f.prototype.__test=f.prototype.__test;h.export("lib/ui/rollout",f)})(window,graphit,console);(function(f,h,i){var j=h.import("lib/object"),e=new (graphit.import("lib/po")),d={autoOpen:1,buttons:1,closeOnEscape:1,closeText:1,dialogClass:1,draggable:1,height:1,hide:1,maxHeight:1,maxWidth:1,minHeight:1,minWidth:1,modal:1,position:1,resizable:1,show:1,stack:1,title:1,width:1,zIndex:1},f=function(a,d){d=d?d:[];a=a?a:{};a.className="lib/widget";a.label=a.label||"lib/widget";j.call(this,a,d);this.options={};this.updatable=[]};f.prototype=Object.create(j.prototype);f.prototype.constructor=new j;
f.prototype.init=function(a){try{e.get(a.label)}catch(f){i.warn("Missing translation for label",a.label)}for(var h in d)h in a&&(this.options[h]=a.label);this._get_updatable_id("main-title");this.dom_build()};f.prototype.init=f.prototype.init;f.prototype._get_updatable_id=function(a){a||this.exception("undefined name");return"widget-"+this.uid+"-"+a};f.prototype._get_updatable_id=f.prototype._get_updatable_id;f.prototype.set=function(a,e){a in d||this.exception("unauthorized_key",a);this[a]=e};f.prototype.set=
f.prototype.set;f.prototype.get=function(a){a in d||this.exception("unauthorized_key",a);return this[a]};f.prototype.get=f.prototype.get;f.prototype.dom_build=function(){var a=$("<div />");a.attr("id",this.uid);this._widget=a;var d=$("<div />");d.addClass("group group-widget-content");this._content=d;a.append(d);this.rootElm=a;return this};f.prototype.dom_build=f.prototype.dom_build;f.prototype.set_content=function(a){this._content.empty();this._content.append(a)};f.prototype.set_content=f.prototype.set_content;
f.prototype.get_content=function(){return this._content};f.prototype.get_content=f.prototype.get_content;f.prototype.refresh=function(){var a="#"+this.uid;i.log("refresh");a=$(document).find(a).parent().find(".ui-dialog-title");i.log("Title",a);a.empty();a.append("PLOP"+e.get(this.label));var d=this.get_content();"object"==typeof d&&"dom_get"in d&&(d=d.dom_get({force:!0}));a.append(d)};f.prototype.refresh=f.prototype.refresh;f.prototype.show=function(){this.dom_get().dialog(this.options).dialog("open")};
f.prototype.show=f.prototype.show;f.prototype.hide=function(){this.dom_get().dialog("close")};f.prototype.hide=f.prototype.hide;f.prototype.__test=function(){i.log("Testing widget");var a=new (h.import("lib/widget"))({label:"TEST_test"});a.set("autoOpen",!0);a.set_content("Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec ac felis dui, sodales mattis urna. In eros quam, tristique et varius at, faucibus ac sapien. Aenean vel augue eu tortor pretium sollicitudin. In tristique ipsum volutpat lectus tempor ut pulvinar massa ultrices. Donec tincidunt dui vitae leo fringilla tristique. Nulla tempor enim in lacus faucibus non laoreet elit pretium. Donec eget dapibus diam. Vivamus adipiscing iaculis mauris ultrices convallis. Nunc ultrices nibh euismod arcu fringilla a semper nulla sollicitudin. Curabitur commodo libero felis. Vivamus facilisis leo id felis molestie varius tempus erat dignissim. Praesent aliquam, urna ac dictum commodo, augue est rhoncus nisi, eu ultricies diam purus vitae mauris. Curabitur in lectus enim.");
e.set_lang("fr");a.refresh();a.show()};f.prototype.__test=f.prototype.__test;h.export("lib/widget",f)})(window,graphit,console);(function(f,h){var i=h.import("lib/widget"),j=function(e){e=e||{};e.className="app/ui/toolbox";e.label="widget_toolbox";i.call(this,e,[])};j.prototype=Object.create(i.prototype);j.prototype.constructor=new i;j.prototype.get_content=function(){};j.prototype.get_content=j.prototype.get_content;j.prototype.__test=function(){var e=new (h.import("app/ui/toolbox")),d=new (h.import("lib/ui/content"))({label:"TEST_test"});d.set_content("Gabou");e.set_content(d);e.show()};j.prototype.__test=j.prototype.__test;
h.export("app/ui/toolbox",j)})(window,graphit,console);(function(f,h,i){f=function(){i.log("[ Starting ]");var f=0,e=0,d;for(d in h.egg){f++;var a=null,k="[ Testing ] "+f+" / "+d+" / ",l=h.egg[d].prototype;if(l){var q=!1;if("__test"in l){try{h.import(d),q=l.__test.call(this),q=!0,e++}catch(m){a={original:m,message:m.message},"object"===typeof m&&"to_s"in m&&(a.to_s=m.to_s())}q?i.log(k+"Ok"):(i.log(k+"Fail"),i.error("Error in <<< ",d," >>>"),i.error(a,a.original),"shojs-exception"==a.original.type&&widget_exception(a.original))}else i.log(k+" NO TEST"),
e++}else i.log(k,h.egg[d]),e++}i.log("Test ",e," / ",f)};f.prototype.__test=function(){return!0};h.export("app/boot/test",f)})(window,graphit,console);(function(f,h){var i=function(){var f=new (h.import("app/core/ui"));h.add_component=f.add_component;h.add_component("ui",f);h.import("app/boot/test")()};i.prototype.__test=function(){return!0};h.export("app/boot",i)})(window,graphit,console);
